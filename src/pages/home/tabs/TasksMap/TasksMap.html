<mcm-header></mcm-header>
<ion-content class="has-header map">
    <div id="tasks-map" class="map-view"></div>

    <div *ngIf="(!gamificationIsDisabled && currentScore && currentScore > 0) || (sessionInfo != null && this.showCountdownOrTimer)" id="ranking" class="detail-box ranking">
        <ion-grid no-padding class="ranking">
            <ion-row class="current" *ngIf="sessionInfo != null && this.showCountdownOrTimer">
                <ion-col>
                    <ion-label *ngIf="this.countdownBeforeSession">{{'a_private_session_countdown' | translate}}</ion-label>
                    <ion-label *ngIf="this.countdownBeforeSession == false">{{'a_private_session_timer' | translate}}</ion-label>
                    <ion-label *ngIf="this.showSessionEnds">{{'a_private_session_ends' | translate}}</ion-label>
                </ion-col>
                <ion-col>
                    <ion-label>{{ countdownOrTimerForSession }} Min</ion-label>
                </ion-col>
            </ion-row>
            <ion-row class="current" *ngIf="!gamificationIsDisabled && currentScore && currentScore > 0 && (sessionInfo==null || !sessionInfo.session.has_leaderboard)">
                <ion-col>
                    <ion-label *ngIf="!sessionInfo">{{user.name}}</ion-label>
                    <ion-label *ngIf="sessionInfo">{{sessionInfo.sessionUser.team_name}}</ion-label>
                </ion-col>
                <ion-col>
                    <ion-label>{{currentScore}} MP</ion-label>
                </ion-col>
            </ion-row>
            <div *ngIf="sessionInfo !=null && sessionInfo.session.has_leaderboard">
                <ion-row [ngClass]="{'self' : user.self}" *ngFor="let user of chatAndSessionService.getLeaderboard(); let i = index">

                    <ion-col col-2>
                        <ion-label *ngIf="chatAndSessionService.getLeaderboard().length > 1 && i == 0 && !user.self">▲</ion-label>
                        <ion-label *ngIf="chatAndSessionService.getLeaderboard().length > 1 && i != 0 && !user.self">▼</ion-label>
                    </ion-col>

                    <ion-col col-7>
                        <ion-label>{{user.team_name}}</ion-label>
                    </ion-col>
                    <ion-col col-3>
                        <ion-label>{{user.score}} MP</ion-label>
                    </ion-col>
                </ion-row>
            </div>
        </ion-grid>
    </div>

    <div id="details" class="detail-box" [ngClass]="{'open': state.selectedTask}">

        <div class="fab-container">
            <ion-fab right bottom>
                <button ion-fab color="primary" (click)="fabListOpen = !fabListOpen"><ion-icon name="more"></ion-icon></button>
                <ion-fab-list side="top">
                    <button [hidden]="sessionInfo != null" color="danger" ion-fab (click)="resetTasks()" *ngIf="sessionInfo == null">
                        <ion-icon name="icon-restart"></ion-icon>
                    </button>
                    <button [hidden]="!state.isShowingAllTasks || assignedTask()" ion-fab (click)="selectStartPoint()">
                        <ion-icon name="icon-starting-point"></ion-icon>
                    </button>
                    <button color="danger" [hidden]="state.isShowingAllTasks || assignedTask()" ion-fab (click)="showAllTasks()">
                        <ion-icon name="icon-visibility"></ion-icon>
                    </button>
                    <button color="danger" ion-fab (click)="sessionFinished()" *ngIf="sessionInfo != null">
                        <ion-icon name="log-out"></ion-icon>
                    </button>
                    <button ion-fab (click)="navigateToChat()" *ngIf="sessionInfo != null">
                        <ion-icon name="chatbubbles"></ion-icon>
                    </button>
                    <span [ngClass]="{'badge-no-show': chatAndSessionService.getNewMsgNumber() == 0}" class="badge-top-right" *ngIf="sessionInfo != null && fabListOpen">{{chatAndSessionService.getNewMsgNumber()}}</span>
                </ion-fab-list>
                <span [ngClass]="{'badge-no-show': chatAndSessionService.getNewMsgNumber() == 0}" class="badge-top-right" *ngIf="sessionInfo != null && !fabListOpen">{{chatAndSessionService.getNewMsgNumber()}}</span>
            </ion-fab>
        </div>

        <div tappable class="image-container" *ngIf="state.selectedTask" (click)="gototask(state.selectedTask.id, state.selectedTask.title)" [ngStyle]="{'background-image' : 'url('+ state.selectedTask.getSingleQuotedImageURL() +')'}"></div>
        <div class="text-container" *ngIf="state.selectedTask">
            <div class="segmented-box">
                <div class="title segement">
                    <span tappable (click)="gototask(state.selectedTask.id, state.selectedTask.title)">#{{state.selectedTask.position}}</span>
                    <h2 tappable (click)="gototask(state.selectedTask.id, state.selectedTask.title)">{{state.selectedTask.title}}</h2>
                </div>
            </div>
            <div class="segmented-box bottom">
                <!--TODO FUTUTRE GAMIFICATION INTEGRATION-->
                <!--<span class="segement">??? {{ "a_g_max_points" | translate }}</span>-->
                <div class="segement buttons">
                    <div class="text-right">
                        <button ion-button small round (click)="gototask(state.selectedTask.id, state.selectedTask.title)">{{ 'a_alert_show_task' | translate }}</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</ion-content>
