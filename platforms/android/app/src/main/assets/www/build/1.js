webpackJsonp([1],{948:function(n,e,t){"use strict";function l(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,3,"ion-label",[],null,null,null,null,null)),I["ɵdid"](16384,null,0,on.a,[an.a,I.ElementRef,I.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),I["ɵted"](null,["",""])),I["ɵpid"](131072,rn.a,[un.a,I.ChangeDetectorRef])],null,function(n,e){n(e,2,0,I["ɵunv"](e,2,0,I["ɵnov"](e,3).transform("a_private_session_countdown")))})}function s(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,3,"ion-label",[],null,null,null,null,null)),I["ɵdid"](16384,null,0,on.a,[an.a,I.ElementRef,I.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),I["ɵted"](null,["",""])),I["ɵpid"](131072,rn.a,[un.a,I.ChangeDetectorRef])],null,function(n,e){n(e,2,0,I["ɵunv"](e,2,0,I["ɵnov"](e,3).transform("a_private_session_timer")))})}function i(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,3,"ion-label",[],null,null,null,null,null)),I["ɵdid"](16384,null,0,on.a,[an.a,I.ElementRef,I.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),I["ɵted"](null,["",""])),I["ɵpid"](131072,rn.a,[un.a,I.ChangeDetectorRef])],null,function(n,e){n(e,2,0,I["ɵunv"](e,2,0,I["ɵnov"](e,3).transform("a_private_session_ends")))})}function o(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,29,"ion-row",[["class","session row"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,cn.a,[],null,null),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵeld"](0,null,null,4,"ion-col",[["class","countdown col"],["col",""]],null,null,null,null,null)),I["ɵdid"](16384,null,0,dn.a,[],null,null),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵeld"](0,null,null,0,"img",[["class","icon countdown"],["src","./assets/icons/countdown.svg"]],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵeld"](0,null,null,11,"ion-col",[["class","col"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,dn.a,[],null,null),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵand"](16777216,null,null,1,null,l)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵand"](16777216,null,null,1,null,s)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵand"](16777216,null,null,1,null,i)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵeld"](0,null,null,6,"ion-col",[["class","col"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,dn.a,[],null,null),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵeld"](0,null,null,2,"ion-label",[],null,null,null,null,null)),I["ɵdid"](16384,null,0,on.a,[an.a,I.ElementRef,I.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),I["ɵted"](null,[""," Min"])),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵted"](null,["\n                "]))],function(n,e){var t=e.component;n(e,13,0,t.countdownBeforeSession);n(e,16,0,0==t.countdownBeforeSession);n(e,19,0,t.showSessionEnds)},function(n,e){n(e,27,0,e.component.countdownOrTimerForSession)})}function a(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,2,"ion-label",[],null,null,null,null,null)),I["ɵdid"](16384,null,0,on.a,[an.a,I.ElementRef,I.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),I["ɵted"](null,["",""]))],null,function(n,e){n(e,2,0,e.component.user.name)})}function r(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,2,"ion-label",[],null,null,null,null,null)),I["ɵdid"](16384,null,0,on.a,[an.a,I.ElementRef,I.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),I["ɵted"](null,["",""]))],null,function(n,e){n(e,2,0,e.component.sessionInfo.sessionUser.team_name)})}function u(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,20,"ion-row",[["class","current row"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,cn.a,[],null,null),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵeld"](0,null,null,8,"ion-col",[["class","col"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,dn.a,[],null,null),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵand"](16777216,null,null,1,null,a)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵand"](16777216,null,null,1,null,r)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵeld"](0,null,null,6,"ion-col",[["class","col"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,dn.a,[],null,null),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵeld"](0,null,null,2,"ion-label",[["class","score"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,on.a,[an.a,I.ElementRef,I.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),I["ɵted"](null,["",""])),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵted"](null,["\n                "]))],function(n,e){var t=e.component;n(e,7,0,!t.sessionInfo);n(e,10,0,t.sessionInfo)},function(n,e){n(e,18,0,e.component.currentScore)})}function c(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,0,"img",[["class","icon arrow"],["src","./assets/icons/up.svg"]],null,null,null,null,null))],null,null)}function d(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,0,"img",[["class","icon arrow"],["src","./assets/icons/down.svg"]],null,null,null,null,null))],null,null)}function h(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,30,"ion-row",[["class","row"]],null,null,null,null,null)),I["ɵdid"](278528,null,0,hn.i,[I.IterableDiffers,I.KeyValueDiffers,I.ElementRef,I.Renderer],{ngClass:[0,"ngClass"]},null),I["ɵpod"]({self:0}),I["ɵdid"](16384,null,0,cn.a,[],null,null),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵeld"](0,null,null,8,"ion-col",[["class","chart col"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,dn.a,[],null,null),(n()(),I["ɵted"](null,["\n                            "])),(n()(),I["ɵand"](16777216,null,null,1,null,c)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                            "])),(n()(),I["ɵand"](16777216,null,null,1,null,d)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵted"](null,["\n\n                        "])),(n()(),I["ɵeld"](0,null,null,6,"ion-col",[["class","col"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,dn.a,[],null,null),(n()(),I["ɵted"](null,["\n                            "])),(n()(),I["ɵeld"](0,null,null,2,"ion-label",[],null,null,null,null,null)),I["ɵdid"](16384,null,0,on.a,[an.a,I.ElementRef,I.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),I["ɵted"](null,["",""])),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵeld"](0,null,null,6,"ion-col",[["class","col"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,dn.a,[],null,null),(n()(),I["ɵted"](null,["\n                            "])),(n()(),I["ɵeld"](0,null,null,2,"ion-label",[["class","score"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,on.a,[an.a,I.ElementRef,I.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(n()(),I["ɵted"](null,["",""])),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵted"](null,["\n                    "]))],function(n,e){var t=e.component;n(e,1,0,n(e,2,0,e.context.$implicit.self));n(e,9,0,t.chatAndSessionService.getLeaderboard().length>1&&0==e.context.index&&!e.context.$implicit.self);n(e,12,0,t.chatAndSessionService.getLeaderboard().length>1&&0!=e.context.index&&!e.context.$implicit.self)},function(n,e){n(e,20,0,e.context.$implicit.team_name);n(e,28,0,e.context.$implicit.score)})}function p(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,4,"div",[],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵand"](16777216,null,null,1,null,h)),I["ɵdid"](802816,null,0,hn.j,[I.ViewContainerRef,I.TemplateRef,I.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(n()(),I["ɵted"](null,["\n                "]))],function(n,e){n(e,3,0,e.component.chatAndSessionService.getLeaderboard())},null)}function f(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,14,"div",[["class","detail-box"],["id","ranking"]],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n            "])),(n()(),I["ɵeld"](0,null,null,11,"ion-grid",[["class","table grid"]],null,null,null,null,null)),I["ɵdid"](16384,null,0,pn.a,[],null,null),(n()(),I["ɵted"](null,["\n                "])),(n()(),I["ɵand"](16777216,null,null,1,null,o)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                "])),(n()(),I["ɵand"](16777216,null,null,1,null,u)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                "])),(n()(),I["ɵand"](16777216,null,null,1,null,p)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n            "])),(n()(),I["ɵted"](null,["\n        "]))],function(n,e){var t=e.component;n(e,6,0,null!=t.sessionInfo&&t.showCountdownOrTimer);n(e,9,0,t.route.isAnswerFeedbackEnabled()&&!t.gamificationIsDisabled&&t.currentScore&&t.currentScore>0&&(null==t.sessionInfo||!t.sessionInfo.session.has_leaderboard));n(e,12,0,null!=t.sessionInfo&&t.sessionInfo.session.has_leaderboard&&t.route.isAnswerFeedbackEnabled())},null)}function m(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,5,"button",[["color","danger"],["ion-fab",""]],[[8,"hidden",0]],[[null,"click"]],function(n,e,t){var l=!0;if("click"===e){l=!1!==n.component.displayResetTasksModal()&&l}return l},fn.b,fn.a)),I["ɵdid"](49152,[[4,4],[2,4]],0,mn.a,[an.a,I.ElementRef,I.Renderer],{color:[0,"color"]},null),(n()(),I["ɵted"](0,["\n                        "])),(n()(),I["ɵeld"](0,null,0,1,"ion-icon",[["name","icon-restart"],["role","img"]],[[2,"hide",null]],null,null,null,null)),I["ɵdid"](147456,null,0,vn.a,[an.a,I.ElementRef,I.Renderer],{name:[0,"name"]},null),(n()(),I["ɵted"](0,["\n                    "]))],function(n,e){n(e,1,0,"danger");n(e,4,0,"icon-restart")},function(n,e){n(e,0,0,null!=e.component.sessionInfo);n(e,3,0,I["ɵnov"](e,4)._hidden)})}function v(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,5,"button",[["color","danger"],["ion-fab",""]],null,[[null,"click"]],function(n,e,t){var l=!0;if("click"===e){l=!1!==n.component.sessionFinished()&&l}return l},fn.b,fn.a)),I["ɵdid"](49152,[[4,4],[2,4]],0,mn.a,[an.a,I.ElementRef,I.Renderer],{color:[0,"color"]},null),(n()(),I["ɵted"](0,["\n                        "])),(n()(),I["ɵeld"](0,null,0,1,"ion-icon",[["name","icon-exit"],["role","img"]],[[2,"hide",null]],null,null,null,null)),I["ɵdid"](147456,null,0,vn.a,[an.a,I.ElementRef,I.Renderer],{name:[0,"name"]},null),(n()(),I["ɵted"](0,["\n                    "]))],function(n,e){n(e,1,0,"danger");n(e,4,0,"icon-exit")},function(n,e){n(e,3,0,I["ɵnov"](e,4)._hidden)})}function g(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,5,"button",[["color","primary"],["ion-fab",""]],null,[[null,"click"]],function(n,e,t){var l=!0;if("click"===e){l=!1!==n.component.navigateToChat()&&l}return l},fn.b,fn.a)),I["ɵdid"](49152,[[4,4],[2,4]],0,mn.a,[an.a,I.ElementRef,I.Renderer],{color:[0,"color"]},null),(n()(),I["ɵted"](0,["\n                        "])),(n()(),I["ɵeld"](0,null,0,1,"ion-icon",[["name","icon-chat"],["role","img"]],[[2,"hide",null]],null,null,null,null)),I["ɵdid"](147456,null,0,vn.a,[an.a,I.ElementRef,I.Renderer],{name:[0,"name"]},null),(n()(),I["ɵted"](0,["\n                    "]))],function(n,e){n(e,1,0,"primary");n(e,4,0,"icon-chat")},function(n,e){n(e,3,0,I["ɵnov"](e,4)._hidden)})}function k(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,3,"span",[["class","badge-top-right"]],null,null,null,null,null)),I["ɵdid"](278528,null,0,hn.i,[I.IterableDiffers,I.KeyValueDiffers,I.ElementRef,I.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),I["ɵpod"]({"badge-no-show":0}),(n()(),I["ɵted"](null,["",""]))],function(n,e){n(e,1,0,"badge-top-right",n(e,2,0,0==e.component.chatAndSessionService.getNewMsgNumber()))},function(n,e){n(e,3,0,e.component.chatAndSessionService.getNewMsgNumber())})}function b(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,3,"span",[["class","badge-top-right"]],null,null,null,null,null)),I["ɵdid"](278528,null,0,hn.i,[I.IterableDiffers,I.KeyValueDiffers,I.ElementRef,I.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),I["ɵpod"]({"badge-no-show":0}),(n()(),I["ɵted"](null,["",""]))],function(n,e){n(e,1,0,"badge-top-right",n(e,2,0,0==e.component.chatAndSessionService.getNewMsgNumber()))},function(n,e){n(e,3,0,e.component.chatAndSessionService.getNewMsgNumber())})}function T(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,6,"div",[["class","image-container"],["tappable",""]],null,[[null,"click"]],function(n,e,t){var l=!0,s=n.component;if("click"===e){l=!1!==s.gototask(s.state.selectedTask.id,s.state.selectedTask.title)&&l}return l},null,null)),(n()(),I["ɵted"](null,["\n                "])),(n()(),I["ɵeld"](0,null,null,3,"div",[["class","cover"]],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵeld"](0,null,null,0,"img",[["class","thumb"]],[[8,"src",4]],null,null,null,null)),(n()(),I["ɵted"](null,["\n                "])),(n()(),I["ɵted"](null,["\n            "]))],null,function(n,e){n(e,4,0,e.component.state.selectedTask.getImageURL())})}function S(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,29,"div",[["class","text-container"]],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n                "])),(n()(),I["ɵeld"](0,null,null,10,"div",[["class","segmented-box"]],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵeld"](0,null,null,7,"div",[["class","title segement"]],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵeld"](0,null,null,1,"span",[["tappable",""]],null,[[null,"click"]],function(n,e,t){var l=!0,s=n.component;if("click"===e){l=!1!==s.gototask(s.state.selectedTask.id,s.state.selectedTask.title)&&l}return l},null,null)),(n()(),I["ɵted"](null,["#",""])),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵeld"](0,null,null,1,"h2",[["tappable",""]],null,[[null,"click"]],function(n,e,t){var l=!0,s=n.component;if("click"===e){l=!1!==s.gototask(s.state.selectedTask.id,s.state.selectedTask.title)&&l}return l},null,null)),(n()(),I["ɵted"](null,["",""])),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵted"](null,["\n                "])),(n()(),I["ɵted"](null,["\n                "])),(n()(),I["ɵeld"](0,null,null,14,"div",[["class","segmented-box bottom"]],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵeld"](0,null,null,9,"div",[["class","segement buttons"]],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵeld"](0,null,null,6,"div",[["class","text-right"]],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n                            "])),(n()(),I["ɵeld"](0,null,null,3,"button",[["ion-button",""],["round",""],["small",""]],null,[[null,"click"]],function(n,e,t){var l=!0,s=n.component;if("click"===e){l=!1!==s.gototask(s.state.selectedTask.id,s.state.selectedTask.title)&&l}return l},gn.b,gn.a)),I["ɵdid"](1097728,null,0,kn.a,[[8,""],an.a,I.ElementRef,I.Renderer],{small:[0,"small"],round:[1,"round"]},null),(n()(),I["ɵted"](0,["",""])),I["ɵpid"](131072,rn.a,[un.a,I.ChangeDetectorRef]),(n()(),I["ɵted"](null,["\n                        "])),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵted"](null,["\n                "])),(n()(),I["ɵted"](null,["\n            "]))],function(n,e){n(e,23,0,"","")},function(n,e){var t=e.component;n(e,7,0,t.state.selectedTask.position);n(e,10,0,t.state.selectedTask.title);n(e,24,0,I["ɵunv"](e,24,0,I["ɵnov"](e,25).transform("a_alert_show_task")))})}function w(n){return I["ɵvid"](0,[I["ɵqud"](402653184,1,{mapContainer:0}),(n()(),I["ɵeld"](0,null,null,1,"mcm-header",[],null,null,null,bn.b,bn.a)),I["ɵdid"](114688,null,0,Tn.a,[Sn.a,wn.a,In.a,E.a,P.a,x.a],null,null),(n()(),I["ɵted"](null,["\n"])),(n()(),I["ɵeld"](0,null,null,66,"ion-content",[["class","has-header map tasks"]],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,yn.b,yn.a)),I["ɵdid"](4374528,null,0,_n.a,[an.a,Rn.a,Cn.a,I.ElementRef,I.Renderer,Mn.a,Ln.a,I.NgZone,[2,In.a],[2,Sn.a]],null,null),(n()(),I["ɵted"](1,["\n    "])),(n()(),I["ɵeld"](0,null,0,62,"div",[["ion-fixed",""]],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n        "])),(n()(),I["ɵeld"](0,null,null,0,"div",[["class","map-view"],["id","tasks-map"]],null,null,null,null,null)),(n()(),I["ɵted"](null,["\n\n        "])),(n()(),I["ɵand"](16777216,null,null,1,null,f)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n\n        "])),(n()(),I["ɵeld"](0,null,null,54,"div",[["class","detail-box"],["id","details"]],null,null,null,null,null)),I["ɵdid"](278528,null,0,hn.i,[I.IterableDiffers,I.KeyValueDiffers,I.ElementRef,I.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),I["ɵpod"]({open:0}),(n()(),I["ɵted"](null,["\n\n            "])),(n()(),I["ɵeld"](0,null,null,43,"ion-fab",[["right",""],["top",""]],null,null,null,xn.b,xn.a)),I["ɵdid"](1228800,null,2,An.a,[Rn.a],null,null),I["ɵqud"](603979776,2,{_mainButton:0}),I["ɵqud"](603979776,3,{_fabLists:1}),(n()(),I["ɵted"](0,["\n                "])),(n()(),I["ɵeld"](0,null,0,3,"button",[["color","primary"],["ion-fab",""]],null,[[null,"click"]],function(n,e,t){var l=!0,s=n.component;if("click"===e){l=!1!=(s.fabListOpen=!s.fabListOpen)&&l}return l},fn.b,fn.a)),I["ɵdid"](49152,[[2,4]],0,mn.a,[an.a,I.ElementRef,I.Renderer],{color:[0,"color"]},null),(n()(),I["ɵeld"](0,null,0,1,"ion-icon",[["name","more"],["role","img"]],[[2,"hide",null]],null,null,null,null)),I["ɵdid"](147456,null,0,vn.a,[an.a,I.ElementRef,I.Renderer],{name:[0,"name"]},null),(n()(),I["ɵted"](0,["\n                "])),(n()(),I["ɵeld"](0,null,0,29,"ion-fab-list",[["side","top"]],null,null,null,null,null)),I["ɵdid"](16384,[[3,4]],1,En.a,[I.ElementRef,I.Renderer,an.a,Rn.a],null,null),I["ɵqud"](603979776,4,{_setbuttons:1}),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵand"](16777216,null,null,1,null,m)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵeld"](0,null,null,5,"button",[["color","primary"],["ion-fab",""]],[[8,"hidden",0]],[[null,"click"]],function(n,e,t){var l=!0;if("click"===e){l=!1!==n.component.selectStartPoint()&&l}return l},fn.b,fn.a)),I["ɵdid"](49152,[[4,4],[2,4]],0,mn.a,[an.a,I.ElementRef,I.Renderer],{color:[0,"color"]},null),(n()(),I["ɵted"](0,["\n                        "])),(n()(),I["ɵeld"](0,null,0,1,"ion-icon",[["name","icon-starting-point"],["role","img"]],[[2,"hide",null]],null,null,null,null)),I["ɵdid"](147456,null,0,vn.a,[an.a,I.ElementRef,I.Renderer],{name:[0,"name"]},null),(n()(),I["ɵted"](0,["\n                    "])),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵeld"](0,null,null,5,"button",[["color","danger"],["ion-fab",""]],[[8,"hidden",0]],[[null,"click"]],function(n,e,t){var l=!0;if("click"===e){l=!1!==n.component.showAllTasks()&&l}return l},fn.b,fn.a)),I["ɵdid"](49152,[[4,4],[2,4]],0,mn.a,[an.a,I.ElementRef,I.Renderer],{color:[0,"color"]},null),(n()(),I["ɵted"](0,["\n                        "])),(n()(),I["ɵeld"](0,null,0,1,"ion-icon",[["name","icon-visibility"],["role","img"]],[[2,"hide",null]],null,null,null,null)),I["ɵdid"](147456,null,0,vn.a,[an.a,I.ElementRef,I.Renderer],{name:[0,"name"]},null),(n()(),I["ɵted"](0,["\n                    "])),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵand"](16777216,null,null,1,null,v)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵand"](16777216,null,null,1,null,g)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                    "])),(n()(),I["ɵand"](16777216,null,null,1,null,k)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n                "])),(n()(),I["ɵted"](0,["\n                "])),(n()(),I["ɵand"](16777216,null,0,1,null,b)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](0,["\n            "])),(n()(),I["ɵted"](null,["\n\n            "])),(n()(),I["ɵand"](16777216,null,null,1,null,T)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n            "])),(n()(),I["ɵand"](16777216,null,null,1,null,S)),I["ɵdid"](16384,null,0,hn.k,[I.ViewContainerRef,I.TemplateRef],{ngIf:[0,"ngIf"]},null),(n()(),I["ɵted"](null,["\n        "])),(n()(),I["ɵted"](null,["\n    "])),(n()(),I["ɵted"](1,["\n"])),(n()(),I["ɵted"](null,["\n"]))],function(n,e){var t=e.component;n(e,2,0);n(e,12,0,!t.gamificationIsDisabled&&t.currentScore&&t.currentScore>0||null!=t.sessionInfo&&t.showCountdownOrTimer);n(e,15,0,"detail-box",n(e,16,0,t.state.selectedTask));n(e,24,0,"primary");n(e,26,0,"more");n(e,33,0,null==t.sessionInfo);n(e,36,0,"primary");n(e,39,0,"icon-starting-point");n(e,43,0,"danger");n(e,46,0,"icon-visibility");n(e,50,0,null!=t.sessionInfo);n(e,53,0,null!=t.sessionInfo);n(e,56,0,null!=t.sessionInfo&&t.fabListOpen);n(e,60,0,null!=t.sessionInfo&&!t.fabListOpen);n(e,64,0,t.state.selectedTask);n(e,67,0,t.state.selectedTask)},function(n,e){var t=e.component;n(e,4,0,I["ɵnov"](e,5).statusbarPadding,I["ɵnov"](e,5)._hasRefresher);n(e,25,0,I["ɵnov"](e,26)._hidden);n(e,35,0,!t.state.isShowingAllTasks||t.assignedTask());n(e,38,0,I["ɵnov"](e,39)._hidden);n(e,42,0,t.state.isShowingAllTasks||t.assignedTask());n(e,45,0,I["ɵnov"](e,46)._hidden)})}Object.defineProperty(e,"__esModule",{value:!0});var I=t(1),y=(t(0),t(17),t(38)),_=t(139),R=(t(634),t(955),t(21)),C=t(632),M=t(35),L=t(294),x=t(27),A=t(78),E=t(43),N=(t(958),t(960),t(42)),O=(t(57),t(49)),U=t(140),D=t(280),B=t(299),P=t(50),z=t(300),F=t(198),G=t(62),V=t(3),j=t(296),K=t(301),W=this&&this.__awaiter||function(n,e,t,l){return new(t||(t=Promise))(function(s,i){function o(n){try{r(l.next(n))}catch(n){i(n)}}function a(n){try{r(l.throw(n))}catch(n){i(n)}}function r(n){n.done?s(n.value):new t(function(e){e(n.value)}).then(o,a)}r((l=l.apply(n,e||[])).next())})},Z=this&&this.__generator||function(n,e){function t(t){return function(o){return function(t){if(l)throw new TypeError("Generator is already executing.");for(;a;)try{if(l=1,s&&(i=s[2&t[0]?"return":t[0]?"throw":"next"])&&!(i=i.call(s,t[1])).done)return i;switch(s=0,i&&(t=[0,i.value]),t[0]){case 0:case 1:i=t;break;case 4:return a.label++,{value:t[1],done:!1};case 5:a.label++,s=t[1],t=[0];continue;case 7:t=a.ops.pop(),a.trys.pop();continue;default:if(i=a.trys,!(i=i.length>0&&i[i.length-1])&&(6===t[0]||2===t[0])){a=0;continue}if(3===t[0]&&(!i||t[1]>i[0]&&t[1]<i[3])){a.label=t[1];break}if(6===t[0]&&a.label<i[1]){a.label=i[1],i=t;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(t);break}i[2]&&a.ops.pop(),a.trys.pop();continue}t=e.call(n,a)}catch(n){t=[6,n],s=0}finally{l=i=0}if(5&t[0])throw t[1];return{value:t[0]?t[1]:void 0,done:!0}}([t,o])}}var l,s,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:t(0),throw:t(1),return:t(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o},J=function(){function TasksMap(e,t,l,s,i,o,a,r,u,c,d,h,p,f){var m=this;this.navCtrl=e,this.navParams=t,this.events=l,this.ormService=s,this.deepLinker=i,this.gpsService=o,this.modalsService=a,this.imagesService=r,this.storage=u,this.spinner=c,this.modalCtrl=d,this.chatAndSessionService=h,this.app=p,this.helper=f,this.state={selectedTask:null,isShowingAllTasks:!1,visibleTasks:{},skippedTaskIds:[],selectedStartTask:!1,showIntroModal:!1,showGuidedTrailModal:!1},this.stateKey="savedMapStateByRoute",this.taskToSkip=null,this.gamificationIsDisabled=!1,this.isUserInsideMap=!0,this.user=null,this.countdownBeforeSession=!1,this.startInterval=!1,this.showCountdownOrTimer=!1,this.showSessionEnds=!1,this.taskBlocked=!1,this.sessionTimeTimer=j.Observable.interval(1e3*n.UPDATE_SESSION_TIME_INTERVAL_IN_SECS),this.redrawingMarkers=!1,this.markerGroup=null,this.pathGroup=null,this.chatAndSessionService.init(),this.events.subscribe("user:kicked",function(n){"self"==n?(console.log("userKicked"),m.sessionKicked(),m.events.unsubscribe("user:kicked",null)):console.log("Someone else was kicked.")}),this.events.subscribe("session:updated",function(n){console.log("Session has been updated"),m.updateSession(n)}),this.events.subscribe("user:assigned_task",function(n){console.log("User has been assigned task with id: "+n),m.sessionInfo.sessionUser.assigned_task_id=n,m.forceStartFromTask(n),m.redrawMarker()})}return n=TasksMap,TasksMap.prototype.isTrailCompleted=function(){return this.route.isAnswerFeedbackEnabled()?this.taskList&&this.score.getTasksSolved().length+this.score.getTasksSolvedLow().length+this.score.getTasksFailed().length==this.taskList.length:this.score.getTasksSaved()&&this.score.getTasksSaved().length==this.taskList.length},TasksMap.prototype.showTrailCompletedAlert=function(){var n=this,e=this.modalCtrl.create(K.a,{score:this.score,tasks:this.taskList,narrative:this.app.activeNarrative,callback:function(){e.dismiss().then(function(){n.route.completed=!0,n.route.completedDate=(new Date).toDateString().split(" ").slice(1).join(" "),n.ormService.saveAndFireChangedEvent(n.route)})}},{cssClass:this.app.activeNarrative});e.present()},TasksMap.prototype.ionViewWillEnter=function(){return W(this,void 0,void 0,function(){var n,e,t,l=this;return Z(this,function(s){switch(s.label){case 0:return console.log("TasksMap ionViewWillEnter()"),console.log(this.navCtrl),this.routeId=this.navParams.get("routeId"),console.log(this.routeId),n=this,[4,this.ormService.findRouteById(this.routeId)];case 1:return n.route=s.sent(),this.gamificationIsDisabled=this.route.isGamificationDisabled(),e=this,[4,this.ormService.getActiveUser()];case 2:return e.user=s.sent(),this.score=this.route.getScoreForUser(this.user),t=this.chatAndSessionService.getSessionInfo(),this.updateSession(t),this.events.publish("narrativeChange",this.route.getNarrativeName()),this.updateIcons(),[4,this.loadMap()];case 3:return s.sent(),setTimeout(function(){return W(l,void 0,void 0,function(){return Z(this,function(n){switch(n.label){case 0:return[4,this.initializeMap()];case 1:return n.sent(),this.spinner.hide(),this.isTrailCompleted()&&!this.route.completed&&this.showTrailCompletedAlert(),[2]}})})},100),[2]}})})},TasksMap.prototype.ionViewDidEnter=function(){return W(this,void 0,void 0,function(){var n,e,t,l=this;return Z(this,function(s){switch(s.label){case 0:return console.log("TasksMap ionViewDidEnter()"),null==this.sessionInfo?[3,6]:(n=JSON.stringify({}),this.chatAndSessionService.addUserEvent("event_trail_opened",n,"0"),!1!==this.sessionInfo.started?[3,6]:(this.showAllTasks(),this.resetTasks(),0==this.sessionInfo.sessionUser.assigned_task_id?[3,2]:(e=this,[4,this.route.getTasks()])));case 1:return e.taskList=s.sent(),this.forceStartFromTask(this.sessionInfo.sessionUser.assigned_task_id),this.route.isNarrativeEnabled()&&this.showIntroModal().then(function(){l.state.showIntroModal=!1}),[3,3];case 2:this.route.isNarrativeEnabled()&&this.showIntroModal().then(function(){l.state.showIntroModal=!1,l.showGuidedTrailModalWithDelay(500)}),s.label=3;case 3:return this.saveMapStateToLocalStorage(),this.sessionInfo.started=!0,[4,this.chatAndSessionService.updateSession(this.sessionInfo)];case 4:return s.sent(),[4,this.redrawMarker()];case 5:return s.sent(),[2];case 6:return this.navParams.data.tasksMapState?(console.log("3"),this.state=this.navParams.data.tasksMapState,(this.taskToSkip||this.state.selectedStartTask&&(this.score.getTasksSolved().indexOf(this.state.selectedTask.id)>-1||this.score.getTasksSolvedLow().indexOf(this.state.selectedTask.id)>-1))&&this.goToNextTask(this.state.selectedTask,!0),[3,9]):[3,7];case 7:return t=this,[4,this.getMapStateFromLocalStorage()];case 8:t.state=s.sent(),console.log(this.state),this.taskToSkip&&(this.goToNextTask(this.taskToSkip,!0),this.taskToSkip=null),this.state?this.state.showIntroModal&&this.route.isNarrativeEnabled()?this.showIntroModal().then(function(){l.state.showIntroModal=!1,l.saveMapStateToLocalStorage(),l.state.showGuidedTrailModal&&l.showGuidedTrailModalWithDelay(500)}):this.state.showGuidedTrailModal&&this.showGuidedTrailModalWithDelay(500):(this.state=this.navParams.data.tasksMapState={selectedTask:this.navParams.get("selectedTask"),isShowingAllTasks:!1,visibleTasks:{},skippedTaskIds:[],selectedStartTask:!1,showIntroModal:!1,showGuidedTrailModal:!1},this.state.isShowingAllTasks=!this.state.selectedTask,this.state.selectedTask?this.state.visibleTasks[this.state.selectedTask.position]=!0:this.route.isNarrativeEnabled()?this.showIntroModal().then(function(){l.showGuidedTrailModalWithDelay(500)}):this.showGuidedTrailModalWithDelay(500)),s.label=9;case 9:return[4,this.redrawMarker()];case 10:return s.sent(),[2]}})})},TasksMap.prototype.showGuidedTrailModalWithDelay=function(n){var e=this;this.state.showGuidedTrailModal=!1,setTimeout(function(){var n=this;e.modalsService.showDialog("a_guided_trail_title","a_guided_trail","no",function(){},"yes",function(){return W(n,void 0,void 0,function(){return Z(this,function(n){return e.selectStartPoint(),e.state.selectedStartTask=!0,[2]})})},e.app.activeNarrative)},n)},TasksMap.prototype.forceStartFromTask=function(n){var e=this.taskList.filter(function(e){return e.id==n}).pop();this.state.selectedTask=e,console.debug("forceStartFromTask"),this.state.visibleTasks={},this.state.visibleTasks[e.position]=!0,this.state.isShowingAllTasks=!1,this.state.showGuidedTrailModal=!1,this.centerSelectedTask()},TasksMap.prototype.ngOnInit=function(){},TasksMap.prototype.ngOnDestroy=function(){this.sessionSubscription&&(this.sessionSubscription.unsubscribe(),this.sessionSubscription=null),this.watchSubscription&&(this.watchSubscription.unsubscribe(),this.watchSubscription=null),this.events.unsubscribe("user:kicked"),this.events.unsubscribe("session:updated"),this.events.unsubscribe("user:assigned_task"),this.events.publish("narrativeChange","default")},TasksMap.prototype.initializeMap=function(){return W(this,void 0,void 0,function(){return Z(this,function(n){return this.currentScore=this.score.score,this.gpsService.isLocationOn(),null!=this.map&&this.map.invalidateSize(),[2]})})},TasksMap.prototype.updateSession=function(n){var e=this;console.log(this.routeId),console.log(n),n&&n.session?this.routeId!=n.session.trail_id?(console.log("active session belongs to different trail"),this.sessionInfo=null):(this.sessionInfo=n,console.log("active session: "+n.session.code),this.sessionTimeSubscription&&this.sessionTimeSubscription.unsubscribe(),this.sessionTime(),this.sessionTimeSubscription=this.sessionTimeTimer.subscribe(function(n){e.sessionTime()})):(console.log("no active session"),this.sessionInfo=null)},TasksMap.prototype.getMapStateFromLocalStorage=function(){return W(this,void 0,void 0,function(){var n,e;return Z(this,function(t){switch(t.label){case 0:return[4,this.storage.get(this.stateKey)];case 1:return(n=t.sent())&&n[this.routeId]?(e=n[this.routeId],console.log(this.navParams),e.selectedTask=this.navParams.get("selectedTask"),[2,e]):[2,null]}})})},TasksMap.prototype.saveMapStateToLocalStorage=function(){return W(this,void 0,void 0,function(){var n;return Z(this,function(e){switch(e.label){case 0:return[4,this.storage.get(this.stateKey)];case 1:return(n=e.sent())||(n={}),n[this.routeId]=this.state,[2,this.storage.set(this.stateKey,n)]}})})},TasksMap.prototype.ionViewWillLeave=function(){return W(this,void 0,void 0,function(){return Z(this,function(n){return this.saveMapStateToLocalStorage(),[2]})})},TasksMap.prototype.assignedTask=function(){return null!=this.sessionInfo&&this.sessionInfo.session.assign_tasks},TasksMap.prototype.redrawMarker=function(){return W(this,void 0,void 0,function(){var n,e,t,l,s,i,o,a,r,u=this;return Z(this,function(c){switch(c.label){case 0:if(this.redrawingMarkers)return[2];if(this.redrawingMarkers=!0,!this.map)return[2];if(null!=this.markerGroup&&(console.warn("removing markerGroup"),this.map.removeLayer(this.markerGroup),this.markerGroup=null),null!=this.pathGroup){for(console.warn("removing pathGroup"),n=0,e=this.pathGroup;n<e.length;n++)this.map.removeLayer(e[n]);this.pathGroup=null}return t=_.markerClusterGroup({maxClusterRadius:30,iconCreateFunction:function(n){var e=n.getChildCount(),t=n.getAllChildMarkers(),l="marker-cluster marker-cluster-";l+=e<10?"small":e<100?"medium":"large";var s={},i=0;t.map(function(n){n.options.icon.clusterColor&&(i++,s[n.options.icon.clusterColor]?s[n.options.icon.clusterColor]+=1:s[n.options.icon.clusterColor]=1)});var o="",a="",r=Object.keys(s);if(1==r.length)o="background-color: "+r[0];else{var u="",c=0;r.map(function(n){var e=s[n],t=Math.round(e/i*100);c>0&&(u+=", "),u+=n+" 0 "+(c+=t)+"%"});a='<img src="'+new ConicGradient({stops:u,size:24}).png+'"></img>'}return new _.DivIcon({html:'<div style="'+o+'">'+a+"<span>"+e+"</span></div>",className:l,iconSize:new _.Point(40,40)})}}),l=this,[4,this.route.getTasks()];case 1:for(l.taskList=c.sent(),s=this.route.getPathGeoJson(),i=[],o=function(n){var e=a.taskList[n];if(!a.state.isShowingAllTasks&&!a.state.visibleTasks[e.position])return"continue";var l=a.taskOpenIcon,o=!0;if(a.score.getTasksSaved().indexOf(e.id)>-1?l=a.taskSavedIcon:a.score.getTasksSolved().indexOf(e.id)>-1?l=a.taskDonePerfectIcon:a.score.getTasksSolvedLow().indexOf(e.id)>-1?l=a.taskDoneIcon:a.score.getTasksFailed().indexOf(e.id)>-1?l=a.taskFailedIcon:a.state.skippedTaskIds.indexOf(e.id)>-1&&(l=a.taskSkippedIcon,o=!1),o&&a.state.skippedTaskIds.indexOf(e.id)>-1&&a.state.skippedTaskIds.splice(a.state.skippedTaskIds.indexOf(e.id),1),s){var r=s.data.features.filter(function(n){return n.properties.task_id==e.id});if(console.log("GEO JSON",r,e),r)for(var c=0,d=r;c<d.length;c++){var h=_.geoJSON(d[c],{style:function(n){return{color:n.properties.color,dashArray:"10 10"}}});a.map.addLayer(h),i.push(h)}}t.addLayer(_.marker([e.lat,e.lon],{icon:l}).on("click",function(){if(u.state.selectedTask==e)u.gototask(e.id,e.title);else{if(null!=u.sessionInfo){var n=JSON.stringify({});u.chatAndSessionService.addUserEvent("event_task_previewed",n,e.id.toString())}u.state.selectedTask=e,u.map.panTo([e.lat,e.lon])}}))},a=this,r=0;r<this.taskList.length;r++)o(r);return this.map.addLayer(t),console.log("MAP AFTER UPDATE",this.map),this.markerGroup=t,this.pathGroup=i,this.redrawingMarkers=!1,[2]}})})},TasksMap.prototype.loadMap=function(){return W(this,void 0,void 0,function(){var n,e,t,l,s,i,o,a,r=this;return Z(this,function(u){switch(u.label){case 0:return n=this.route.getTilesMap(this.app.activeNarrative),e=this.route.getTilesServerSubdomains(this.app.activeNarrative),null!=this.map?[3,2]:(this.map=_.map("tasks-map",{attributionControl:!1,zoom:18,trackResize:!1,maxBounds:this.route.getBoundingBoxLatLng()}),_.control.attribution({position:"bottomleft",prefix:"Leaflet"}).addTo(this.map),this.map.fitBounds(this.route.getViewBoundingBoxLatLng()),this.map.on("click",function(n){r.state.selectedTask=null}),t=this.map,[4,C.a.initialize()]);case 1:u.sent(),l=R.b.calculateZoom(this.route.getViewBoundingBoxLatLng()),s=_.tileLayer.offline(n,C.a,{attribution:"&copy; mapbox.com",subdomains:e,minZoom:l.min_zoom,maxZoom:l.max_zoom,tileSize:256,crossOrigin:!0,detectRetina:!0,bounds:this.route.getBoundingBoxLatLng()}),this.gpsService.getCurrentPosition().then(function(n){n&&n.coords&&(console.debug("found you"),r.userMarker=_.marker([n.coords.latitude,n.coords.longitude],{icon:r.userPositionIcon}).on("click",function(){}),r.userMarker.setRotationOrigin("center center"),r.userMarker.addTo(r.map),r.watchSubscription&&r.watchSubscription.unsubscribe(),r.watchSubscription=r.gpsService.watchPosition().subscribe(function(n){if(n&&n.coords){var e=new _.LatLng(n.coords.latitude,n.coords.longitude);if(r.map.getBounds().contains(e)){if(r.isUserInsideMap||r.userMarker.setIcon(r.userPositionIcon),r.userMarker.setLatLng(e),null!=r.prevPos){var t=R.b.getAngle(r.prevPos,n.coords);r.userMarker.setRotationAngle(t)}r.isUserInsideMap=!0}else r.isUserInsideMap&&r.userMarker.setIcon(r.userPositionArrow),r.updateUserLocationArrow(e),r.isUserInsideMap=!1;r.prevPos=n.coords}}),r.map.on("moveend",function(n){r.isUserInsideMap||r.updateUserLocationArrow(new _.LatLng(r.prevPos.latitude,r.prevPos.longitude))}))}).catch(function(n){console.error("Location error: "+JSON.stringify(n))}),i=this.ormService.getTileURLsAsObject(this.route),o=!this.route.isNarrativeEnabled(),a=this,s.getTileUrl=function(n){var e=_.TileLayer.prototype.getTileUrl.call(this,n),t=this._getStorageKey(e);return i[t]?Promise.resolve(a.imagesService.getOfflineURL(t,!1,o)):Promise.resolve(e)},s.addTo(t),this.map.fitBounds(this.route.getViewBoundingBoxLatLng()),s.on("offline:below-min-zoom-error",function(){alert("Can not save tiles below minimum zoom level.")}),s.on("offline:save-start",function(n){console.debug(n),console.debug("Saving "+n.nTilesToSave+" tiles.")}),s.on("offline:save-end",function(){alert("All the tiles were saved.")}),s.on("offline:save-error",function(n){console.error("Error when saving tiles: "+n)}),s.on("offline:remove-start",function(){console.debug("Removing tiles.")}),s.on("offline:remove-end",function(){alert("All the tiles were removed.")}),s.on("offline:remove-error",function(n){console.error("Error when removing tiles: "+n)}),null!=this.state.selectedTask&&this.centerSelectedTask(),u.label=2;case 2:return[2]}})})},TasksMap.prototype.updateUserLocationArrow=function(n){if(n){var e=this.map.getBounds(),t=_.GeometryUtil.bearing(this.map.getCenter(),n),l=_.GeometryUtil.bearing(this.map.getCenter(),e.getNorthEast()),s=_.GeometryUtil.length([e.getNorthWest(),e.getNorthEast()])/2,i=_.GeometryUtil.length([e.getSouthWest(),e.getNorthWest()])/2,o=0;t<0&&(t+=360),o=t>=l&&t<=180-l||t>=180+l&&t<=360-l?Math.abs(s/Math.sin(t*(Math.PI/180))):Math.abs(i/Math.cos(t*(Math.PI/180)));var a=_.GeometryUtil.destination(this.map.getCenter(),t,.9*o);this.userMarker.setLatLng(a),this.userMarker.setRotationAngle(t)}},TasksMap.prototype.centerSelectedTask=function(){this.map.panTo([this.state.selectedTask.lat,this.state.selectedTask.lon])},TasksMap.prototype.goToNextTaskById=function(n,e){var t=this;this.taskList.forEach(function(l){l.id!=n||t.goToNextTask(l,e)})},TasksMap.prototype.goToNextTask=function(n,e){e&&this.state.skippedTaskIds.push(n.id),console.debug("goToNextTask"),this.state.selectedTask=this.taskList[n.position%this.taskList.length],this.state.visibleTasks[this.state.selectedTask.position]=!0,this.centerSelectedTask(),this.saveMapStateToLocalStorage()},TasksMap.prototype.selectStartPoint=function(){return W(this,void 0,void 0,function(){var n;return Z(this,function(e){return n=this,console.log("Active Narrative is: "+this.app.activeNarrative),[2,this.modalsService.presentTaskListModal(this.route,this.score,this.state,this.app.activeNarrative,this.navCtrl,function(e){if(console.debug("back in tasksMap"),n.state.selectedTask=e,n.state.visibleTasks={},n.state.visibleTasks[e.position]=!0,n.state.isShowingAllTasks=!1,n.centerSelectedTask(),n.redrawMarker(),null!=n.sessionInfo){var t=JSON.stringify({title:n.state.selectedTask.title});n.chatAndSessionService.addUserEvent("event_trail_start_from_task",t,n.state.selectedTask.id.toString())}})]})})},TasksMap.prototype.showAllTasks=function(){this.state.isShowingAllTasks=!0,this.redrawMarker()},TasksMap.prototype.displayResetTasksModal=function(){var n=this;this.modalsService.showDialog("a_route_detail_settings_resetTasks","a_route_detail_settings_resetTasks_msg","no",function(){},"yes",function(){return W(n,void 0,void 0,function(){return Z(this,function(n){switch(n.label){case 0:return[4,this.resetTasks()];case 1:return n.sent(),this.showGuidedTrailModalWithDelay(50),[2]}})})},this.app.activeNarrative)},TasksMap.prototype.resetTasks=function(){var n=this;return new Promise(function(e){n.ormService.deleteUserScore(n.score).then(function(){return W(n,void 0,void 0,function(){var n;return Z(this,function(t){switch(t.label){case 0:return this.score=new L.a,this.state=this.navParams.data.tasksMapState={selectedTask:null,isShowingAllTasks:!0,visibleTasks:{},skippedTaskIds:[],selectedStartTask:!1,showIntroModal:!0,showGuidedTrailModal:!0},this.taskList?[3,2]:(n=this,[4,this.route.getTasks()]);case 1:n.taskList=t.sent(),t.label=2;case 2:return null!=this.sessionInfo&&0!=this.sessionInfo.sessionUser.assigned_task_id&&this.forceStartFromTask(this.sessionInfo.sessionUser.assigned_task_id),this.route.completed=!1,this.route.completedDate=null,[4,this.saveMapStateToLocalStorage()];case 3:return t.sent(),[4,this.ormService.saveAndFireChangedEvent(this.route)];case 4:return t.sent(),[4,this.redrawMarker()];case 5:return t.sent(),e(),[2]}})})})})},TasksMap.prototype.sessionFinished=function(){return W(this,void 0,void 0,function(){var n=this;return Z(this,function(e){return this.modalsService.showDialog("a_private_session_quit","a_private_session_quit_text","no",function(){},"yes",function(){if(n.modalCtrl.create(z.a,{session:n.sessionInfo.session,score:n.score,tasks:n.taskList,narrative:n.app.activeNarrative},{cssClass:n.app.activeNarrative}).present(),null!=n.sessionInfo){var e=JSON.stringify({});n.chatAndSessionService.addUserEvent("event_session_leave",e,"0")}n.chatAndSessionService.exitActiveSession(),n.sessionTimeSubscription&&n.sessionTimeSubscription.unsubscribe()},this.app.activeNarrative),[2]})})},TasksMap.prototype.sessionKicked=function(){return W(this,void 0,void 0,function(){var n,e;return Z(this,function(t){return n=this,(e=this.modalCtrl.create(D.a,{title:"a_private_session_kicked",message:"a_private_session_kicked_text",modalType:U.a.hint,type:"text",gamificationEnabled:!1,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[{title:"a_g_ok",callback:function(){e.dismiss();var t=n.modalCtrl.create(z.a,{session:n.sessionInfo.session,score:n.score,tasks:n.taskList,narrative:this.app.activeNarrative},{showBackdrop:!0,enableBackdropDismiss:!1});null!=n.sessionInfo&&n.chatAndSessionService.exitActiveSession(),n.sessionTimeSubscription&&n.sessionTimeSubscription.unsubscribe(),t.present()}}]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})).present(),[2]})})},TasksMap.prototype.gototask=function(n,e){return W(this,void 0,void 0,function(){var t,l=this;return Z(this,function(s){return this.taskBlocked?(console.log("session in preparation."),[2]):(console.debug("taskId",n),t=this,this.navCtrl.push("TaskDetail",{taskId:n,headerTitle:e,routeId:this.routeId,goToNextTaskById:function(n,e){t.goToNextTaskById(n,e)}},{},function(){l.deepLinker.navChange("forward")}),[2])})})},TasksMap.prototype.navigateToChat=function(){return W(this,void 0,void 0,function(){var n;return Z(this,function(e){return console.debug("showChat"),null!=this.sessionInfo&&(n=JSON.stringify({}),this.chatAndSessionService.addUserEvent("event_trail_chat_open",n,"0")),this.navCtrl.push(F.a,{val:"chatseite",headerTitle:this.sessionInfo.session.name}),[2]})})},TasksMap.prototype.sessionTime=function(){if(null==this.sessionInfo)return this.startInterval=!1,void(this.sessionTimeSubscription&&this.sessionTimeSubscription.unsubscribe());var n=this.sessionInfo.session,e=V().unix(),t=V(n.starts_at).unix(),l=V(n.ends_at).unix(),s=t-e,i=Math.floor(s/60),o=Math.floor((l-e)/60);if(e>t-3600&&e<l)this.startInterval=!0,e<t&&e<l&&(this.showCountdownOrTimer=!0,this.countdownBeforeSession=!0,this.countdownOrTimerForSession=i,this.taskBlocked=!0),e>t&&e<l&&(this.showCountdownOrTimer=!0,this.countdownOrTimerForSession=o,this.countdownBeforeSession=!1,this.taskBlocked=!1);else{this.startInterval=!1,this.sessionTimeSubscription&&this.sessionTimeSubscription.unsubscribe(),this.showSessionEnds=!0,this.taskBlocked=!1;this.modalCtrl.create(z.a,{session:this.sessionInfo.session,score:this.score,tasks:this.taskList,narrative:this.app.activeNarrative},{cssClass:this.app.activeNarrative}).present()}},TasksMap.prototype.showIntroModal=function(){var n=this;return new Promise(function(e){var t="a_alert_welcome",l="a_alert_welcome_msg";n.route.isNarrativeEnabled()&&(t=n.route.getNarrativeString(t),l=n.route.getNarrativeString(l));var s=n.modalCtrl.create(B.a,{title:t,message:l,modalType:U.a.hint,narrative:n.app.activeNarrative,routeTitle:n.route.title,buttons:[{title:"a_alert_close",callback:function(){s.dismiss(),e()}}]},{cssClass:n.app.activeNarrative});s.present()})},TasksMap.prototype.updateIcons=function(){switch(this.app.activeNarrative){case"pirates":this.userPositionIcon=_.icon({iconUrl:"./assets/icons/pirates/mapposition.png",iconSize:[100,100],iconAnchor:[50,50],className:"marker userPosition"}),this.userPositionArrow=_.icon({iconUrl:"./assets/icons/userDirection.png",iconSize:[36,36],iconAnchor:[18,18],className:"marker userArrow"}),this.taskOpenIcon=_.icon({iconUrl:"assets/icons/pirates/marker-task-open.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.taskSkippedIcon=_.icon({iconUrl:"assets/icons/pirates/marker-task-skipped.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.taskSavedIcon=_.icon({iconUrl:"assets/icons/marker-task-saved.png",iconSize:[35,48],iconAnchor:[17.5,43],className:"marker"}),this.taskDoneIcon=_.icon({iconUrl:"assets/icons/pirates/marker-task-good.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.taskDonePerfectIcon=_.icon({iconUrl:"assets/icons/pirates/marker-task-perfect.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.taskFailedIcon=_.icon({iconUrl:"assets/icons/pirates/marker-task-failed.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.taskOpenIcon.clusterColor="#AA2000",this.taskSkippedIcon.clusterColor="#b2b2b2",this.taskSavedIcon.clusterColor="#6E38B9",this.taskDoneIcon.clusterColor="#FFC033",this.taskDonePerfectIcon.clusterColor="#33CC00",this.taskFailedIcon.clusterColor="#333333";break;default:this.userPositionIcon=_.icon({iconUrl:"./assets/icons/mapposition.png",iconSize:[100,100],iconAnchor:[50,50],className:"marker userPosition"}),this.userPositionArrow=_.icon({iconUrl:"./assets/icons/userDirection.png",iconSize:[36,36],iconAnchor:[18,18],className:"marker userArrow"}),this.taskOpenIcon=_.icon({iconUrl:"assets/icons/marker-task-open.png",iconSize:[35,48],iconAnchor:[17.5,43],className:"marker"}),this.taskSkippedIcon=_.icon({iconUrl:"assets/icons/marker-task-skipped.png",iconSize:[35,48],iconAnchor:[17.5,43],className:"marker"}),this.taskSavedIcon=_.icon({iconUrl:"assets/icons/marker-task-saved.png",iconSize:[35,48],iconAnchor:[17.5,43],className:"marker"}),this.taskDoneIcon=_.icon({iconUrl:"assets/icons/marker-task-good.png",iconSize:[35,48],iconAnchor:[17.5,43],className:"marker"}),this.taskDonePerfectIcon=_.icon({iconUrl:"assets/icons/marker-task-perfect.png",iconSize:[35,48],iconAnchor:[17.5,43],className:"marker"}),this.taskFailedIcon=_.icon({iconUrl:"assets/icons/marker-task-failed.png",iconSize:[35,48],iconAnchor:[17.5,43],className:"marker"}),this.taskOpenIcon.clusterColor="#036D99",this.taskSkippedIcon.clusterColor="#B2B2B2",this.taskSavedIcon.clusterColor="#6E38B9",this.taskDoneIcon.clusterColor="#F3B100",this.taskDonePerfectIcon.clusterColor="#4CAF50",this.taskFailedIcon.clusterColor="#E62B25"}},TasksMap.UPDATE_SESSION_TIME_INTERVAL_IN_SECS=15,TasksMap;var n}(),q=t(188),H=function(){return function(){}}(),$=t(619),Y=t(620),Q=t(621),X=t(622),nn=t(623),en=t(624),tn=t(625),ln=t(626),sn=t(627),on=t(51),an=t(4),rn=t(39),un=t(23),cn=t(99),dn=t(97),hn=t(11),pn=t(98),fn=t(953),mn=t(138),vn=t(61),gn=t(26),kn=t(19),bn=t(279),Tn=t(141),Sn=t(24),wn=t(13),In=t(6),yn=t(277),_n=t(36),Rn=t(8),Cn=t(14),Mn=t(12),Ln=t(56),xn=t(952),An=t(278),En=t(199),Nn=t(113),On=t(194),Un=I["ɵcrt"]({encapsulation:2,styles:[],data:{}}),Dn=I["ɵccf"]("page-tasks-map",J,function(n){return I["ɵvid"](0,[(n()(),I["ɵeld"](0,null,null,1,"page-tasks-map",[],null,null,null,w,Un)),I["ɵdid"](245760,null,0,J,[Sn.a,wn.a,Nn.a,M.a,x.a,A.a,E.a,N.a,On.a,O.a,P.a,G.a,U.b,R.b],null,null)],function(n,e){n(e,1,0)},null)},{},{},[]),Bn=t(25),Pn=t(77),zn=t(142),Fn=t(143),Gn=t(145),Vn=t(144),jn=t(189),Kn=t(276),Wn=t(94);t.d(e,"TasksMapPageModuleNgFactory",function(){return Zn});var Zn=I["ɵcmf"](H,[],function(n){return I["ɵmod"]([I["ɵmpd"](512,I.ComponentFactoryResolver,I["ɵCodegenComponentFactoryResolver"],[[8,[$.a,Y.a,Q.a,X.a,nn.a,en.a,tn.a,ln.a,sn.a,Dn]],[3,I.ComponentFactoryResolver],I.NgModuleRef]),I["ɵmpd"](4608,hn.m,hn.l,[I.LOCALE_ID]),I["ɵmpd"](4608,Bn.k,Bn.k,[]),I["ɵmpd"](4608,Bn.c,Bn.c,[]),I["ɵmpd"](4608,Pn.a,Pn.a,[]),I["ɵmpd"](4608,zn.b,zn.a,[]),I["ɵmpd"](4608,Fn.a,Fn.b,[]),I["ɵmpd"](4608,Gn.b,Gn.a,[]),I["ɵmpd"](4608,Vn.b,Vn.a,[]),I["ɵmpd"](4608,un.a,un.a,[jn.a,zn.b,Fn.a,Gn.b,Vn.b,un.b,un.c]),I["ɵmpd"](512,hn.b,hn.b,[]),I["ɵmpd"](512,Bn.j,Bn.j,[]),I["ɵmpd"](512,Bn.d,Bn.d,[]),I["ɵmpd"](512,Bn.i,Bn.i,[]),I["ɵmpd"](512,Kn.a,Kn.a,[]),I["ɵmpd"](512,Kn.b,Kn.b,[]),I["ɵmpd"](512,y.a,y.a,[]),I["ɵmpd"](512,q.a,q.a,[]),I["ɵmpd"](512,H,H,[]),I["ɵmpd"](256,Wn.a,J,[]),I["ɵmpd"](256,un.c,void 0,[]),I["ɵmpd"](256,un.b,void 0,[])])})},952:function(n,e,t){"use strict";function l(n){return s["ɵvid"](0,[s["ɵncd"](null,0)],null,null)}t.d(e,"a",function(){return i}),e.b=l;var s=t(1),i=s["ɵcrt"]({encapsulation:2,styles:[],data:{}})},953:function(n,e,t){"use strict";function l(n){return s["ɵvid"](2,[(n()(),s["ɵeld"](0,null,null,1,"ion-icon",[["class","fab-close-icon"],["name","close"],["role","img"]],[[2,"hide",null]],null,null,null,null)),s["ɵdid"](147456,null,0,i.a,[o.a,s.ElementRef,s.Renderer],{name:[0,"name"]},null),(n()(),s["ɵeld"](0,null,null,1,"span",[["class","button-inner"]],null,null,null,null,null)),s["ɵncd"](null,0),(n()(),s["ɵeld"](0,null,null,0,"div",[["class","button-effect"]],null,null,null,null,null))],function(n,e){n(e,1,0,"close")},function(n,e){n(e,0,0,s["ɵnov"](e,1)._hidden)})}t.d(e,"a",function(){return a}),e.b=l;var s=t(1),i=t(61),o=t(4),a=s["ɵcrt"]({encapsulation:2,styles:[],data:{}})},955:function(n,e,t){"use strict";var l,s,i;!function(o){s=[t(956),t(957)],void 0===(i="function"==typeof(l=o)?l.apply(e,s):l)||(n.exports=i)}(function(n,e){})},956:function(n,e,t){"use strict";var l,s,i;!function(o,a){s=[t(139)],void 0===(i="function"==typeof(l=o)?l.apply(e,s):l)||(n.exports=i)}(function(n){n.TileLayer.Offline=n.TileLayer.extend({initialize:function(e,t,l){this._url=e,this._tilesDb=t,(l=n.Util.setOptions(this,l)).detectRetina&&n.Browser.retina&&l.maxZoom>0&&(l.tileSize=Math.floor(l.tileSize/2),l.zoomReverse?(l.zoomOffset--,l.minZoom++):(l.zoomOffset++,l.maxZoom--),l.minZoom=Math.max(0,l.minZoom)),"string"==typeof l.subdomains&&(l.subdomains=l.subdomains.split("")),n.Browser.android||this.on("tileunload",this._onTileRemove)},createTile:function(e,t){var l=document.createElement("img");return n.DomEvent.on(l,"load",n.bind(this._tileOnLoad,this,t,l)),n.DomEvent.on(l,"error",n.bind(this._tileOnError,this,t,l)),this.options.crossOrigin&&(l.crossOrigin=""),l.alt="",l.setAttribute("role","presentation"),this.getTileUrl(e).then(function(n){l.src=n}).catch(function(n){throw n}),l},getTileUrl:function(e){var t=n.TileLayer.prototype.getTileUrl.call(this,e),l=this._getStorageKey(t);return this._tilesDb.getItem(l).then(function(n){return n&&"object"==typeof n?URL.createObjectURL(n):t}).catch(function(n){throw n})},getTileUrls:function(e,t){var l=[],s=this._url;this.setUrl(this._url.replace("{z}",t),!0);for(var i=n.bounds(e.min.divideBy(this.getTileSize().x).floor(),e.max.divideBy(this.getTileSize().x).floor()),o=i.min.x;o<=i.max.x;o++)for(var a=i.min.y;a<=i.max.y;a++){var r=new n.Point(o,a),u=n.TileLayer.prototype.getTileUrl.call(this,r);l.push({key:this._getStorageKey(u),url:u})}return this.setUrl(s,!0),l},_getStorageKey:function(n){var e=null;if(n.indexOf("{s}")){var t=new RegExp("["+this.options.subdomains.join("|")+"].");e=n.replace(t,this.options.subdomains[0]+".")}return e||n}}),n.tileLayer.offline=function(e,t,l){return new n.TileLayer.Offline(e,t,l)}},window)},957:function(n,e,t){"use strict";var l,s,i;!function(o,a){s=[t(139)],void 0===(i="function"==typeof(l=o)?l.apply(e,s):l)||(n.exports=i)}(function(n){n.Control.Offline=n.Control.extend({options:{position:"topleft",saveButtonHtml:"S",saveButtonTitle:"Save tiles",removeButtonHtml:"R",removeButtonTitle:"Remove tiles",minZoom:0,maxZoom:19,confirmSavingCallback:null,confirmRemovalCallback:null},initialize:function(e,t,l){this._baseLayer=e,this._tilesDb=t,n.Util.setOptions(this,l)},onAdd:function(e){var t=n.DomUtil.create("div","leaflet-control-offline leaflet-bar");return this._createButton(this.options.saveButtonHtml,this.options.saveButtonTitle,"save-tiles-button",t,this._saveTiles),this._createButton(this.options.removeButtonHtml,this.options.removeButtonTitle,"remove-tiles-button",t,this._removeTiles),t},_createButton:function(e,t,l,s,i){var o=n.DomUtil.create("a",l,s);return o.innerHTML=e,o.href="#",o.title=t,n.DomEvent.disableClickPropagation(o),n.DomEvent.on(o,"click",n.DomEvent.stop),n.DomEvent.on(o,"click",i,this),n.DomEvent.on(o,"click",this._refocusOnMap,this),o},_saveTiles:function(){var e=this,t=null,l=[],s=[],i=this._map.getZoom(),o=this._map.getBounds();if(i<this.options.minZoom)e._baseLayer.fire("offline:below-min-zoom-error");else{for(var a=i;a<=this.options.maxZoom;a++)l.push(a);for(var r=0;r<l.length;r++)t=n.bounds(this._map.project(o.getNorthWest(),l[r]),this._map.project(o.getSouthEast(),l[r])),s=s.concat(this._baseLayer.getTileUrls(t,l[r]));var u=function(){e._baseLayer.fire("offline:save-start",{nTilesToSave:s.length}),e._tilesDb.saveTiles(s).then(function(){e._baseLayer.fire("offline:save-end")}).catch(function(n){e._baseLayer.fire("offline:save-error",{error:n})})};this.options.confirmSavingCallback?this.options.confirmSavingCallback(s.length,u):u()}},_removeTiles:function(){var n=this,e=function(){n._baseLayer.fire("offline:remove-start"),n._tilesDb.clear().then(function(){n._baseLayer.fire("offline:remove-end")}).catch(function(e){n._baseLayer.fire("offline:remove-error",{error:e})})};n.options.confirmRemovalCallback?n.options.confirmRemovalCallback(e):e()}}),n.control.offline=function(e,t,l){return new n.Control.Offline(e,t,l)}},window)},958:function(n,e){!function(){var n=L.Marker.prototype._initIcon,e=L.Marker.prototype._setPos,t="msTransform"===L.DomUtil.TRANSFORM;L.Marker.addInitHook(function(){var n=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;n&&(n=n[0]+"px "+n[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||n||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(n){n.target._applyRotation()})}),L.Marker.include({_initIcon:function(){n.call(this)},_setPos:function(n){e.call(this,n),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,t?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(n){return this.options.rotationAngle=n,this.update(),this},setRotationOrigin:function(n){return this.options.rotationOrigin=n,this.update(),this}})}()},960:function(n,e){!function(){var n=Math.PI,e=2*n,t=n/180,l=document.createElement("div");document.head.appendChild(l);var s=self.ConicGradient=function(n){s.all.push(this),n=n||{},this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.repeating=!!n.repeating,this.size=n.size||Math.max(innerWidth,innerHeight),this.canvas.width=this.canvas.height=this.size;this.stops=((o=n.stops)||"").split(/\s*,(?![^(]*\))\s*/),this.from=0;for(var e=0;e<this.stops.length;e++)if(this.stops[e]){var t=this.stops[e]=new s.ColorStop(this,this.stops[e]);t.next&&(this.stops.splice(e+1,0,t.next),e++)}else this.stops.splice(e,1),e--;if(0==this.stops[0].color.indexOf("from")&&(this.from=360*this.stops[0].pos,this.stops.shift()),void 0===this.stops[0].pos)this.stops[0].pos=0;else if(this.stops[0].pos>0){var l=this.stops[0].clone();l.pos=0,this.stops.unshift(l)}if(void 0===this.stops[this.stops.length-1].pos)this.stops[this.stops.length-1].pos=1;else if(!this.repeating&&this.stops[this.stops.length-1].pos<1){var i=this.stops[this.stops.length-1].clone();i.pos=1,this.stops.push(i)}if(this.stops.forEach(function(n,e){if(void 0===n.pos){for(var t=e+1;this[t];t++)if(void 0!==this[t].pos){n.pos=this[e-1].pos+(this[t].pos-this[e-1].pos)/(t-e+1);break}}else e>0&&(n.pos=Math.max(n.pos,this[e-1].pos))},this.stops),this.repeating){var o,a=(o=this.stops.slice())[o.length-1].pos-o[0].pos;for(e=0;this.stops[this.stops.length-1].pos<1&&e<1e4;e++)for(var r=0;r<o.length;r++){var u=o[r].clone();u.pos+=(e+1)*a,this.stops.push(u)}}this.paint()};s.all=[],s.prototype={toString:function(){return"url('"+this.dataURL+"')"},get dataURL(){return"data:image/svg+xml,"+encodeURIComponent(this.svg)},get blobURL(){return URL.createObjectURL(new Blob([this.svg],{type:"image/svg+xml"}))},get svg(){return'<svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" preserveAspectRatio="none"><svg viewBox="0 0 100 100" preserveAspectRatio="xMidYMid slice"><image width="100" height="100%" xlink:href="'+this.png+'" /></svg></svg>'},get png(){return this.canvas.toDataURL()},get r(){return Math.sqrt(2)*this.size/2},paint:function(){var n,e,l,s=this.context,i=this.r,o=this.size/2,a=0,r=this.stops[a];s.translate(this.size/2,this.size/2),s.rotate(-90*t),s.rotate(this.from*t),s.translate(-this.size/2,-this.size/2);for(var u=0;u<360;){if(u/360+1e-5>=r.pos){do{n=r,r=this.stops[++a]}while(r&&r!=n&&r.pos===n.pos);if(!r)break;var c=n.color+""==r.color+""&&n!=r;e=n.color.map(function(n,e){return r.color[e]-n})}l=(u/360-n.pos)/(r.pos-n.pos);var d=c?r.color:e.map(function(e,t){var s=e*l+n.color[t];return t<3?255&s:s});if(s.fillStyle="rgba("+d.join(",")+")",s.beginPath(),s.moveTo(o,o),c)var h=360*(r.pos-n.pos);else h=.5;var p=u*t,f=(p=Math.min(360*t,p))+h*t;f=Math.min(360*t,f+.02),s.arc(o,o,i,p,f),s.closePath(),s.fill(),u+=h}}},s.ColorStop=function(n,t){if(this.gradient=n,t){var l=t.match(/^(.+?)(?:\s+([\d.]+)(%|deg|turn|grad|rad)?)?(?:\s+([\d.]+)(%|deg|turn|grad|rad)?)?\s*$/);if(this.color=s.ColorStop.colorToRGBA(l[1]),l[2]){var i=l[3];"%"==i||"0"===l[2]&&!i?this.pos=l[2]/100:"turn"==i?this.pos=+l[2]:"deg"==i?this.pos=l[2]/360:"grad"==i?this.pos=l[2]/400:"rad"==i&&(this.pos=l[2]/e)}l[4]&&(this.next=new s.ColorStop(n,l[1]+" "+l[4]+l[5]))}},s.ColorStop.prototype={clone:function(){var n=new s.ColorStop(this.gradient);return n.color=this.color,n.pos=this.pos,n},toString:function(){return"rgba("+this.color.join(", ")+") "+100*this.pos+"%"}},s.ColorStop.colorToRGBA=function(n){if(!Array.isArray(n)&&-1==n.indexOf("from")){l.style.color=n;var e=getComputedStyle(l).color.match(/rgba?\(([\d.]+), ([\d.]+), ([\d.]+)(?:, ([\d.]+))?\)/);return e&&(e.shift(),(e=e.map(function(n){return+n}))[3]=isNaN(e[3])?1:e[3]),e||[0,0,0,0]}return n}}(),self.StyleFix&&function(){var n=document.createElement("p");n.style.backgroundImage="conic-gradient(white, black)",n.style.backgroundImage=PrefixFree.prefix+"conic-gradient(white, black)",n.style.backgroundImage||StyleFix.register(function(n,e){return n.indexOf("conic-gradient")>-1&&(n=n.replace(/(?:repeating-)?conic-gradient\(\s*((?:\([^()]+\)|[^;()}])+?)\)/g,function(n,e){return new ConicGradient({stops:e,repeating:n.indexOf("repeating-")>-1})})),n})}()}});