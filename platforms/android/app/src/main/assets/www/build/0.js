webpackJsonp([0],{932:function(t,e,n){"use strict";function s(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,5,"button",[["ion-fab",""]],null,[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.taskDetailMap.setMarker(t.context.index)&&s}return s},At.b,At.a)),mt["ɵdid"](49152,[[3,4]],0,Ot.a,[xt.a,mt.ElementRef,mt.Renderer],{color:[0,"color"]},null),(t()(),mt["ɵted"](0,["\n                    "])),(t()(),mt["ɵeld"](0,null,0,1,"span",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,["",""])),(t()(),mt["ɵted"](0,["\n                "]))],function(t,e){t(e,1,0,e.component.setFabColor(e.context.index))},function(t,e){t(e,4,0,e.context.$implicit)})}function l(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,7,"ion-fab",[["bottom",""],["right",""]],null,null,null,Ut.b,Ut.a)),mt["ɵdid"](1228800,null,2,Bt.a,[Gt.a],null,null),mt["ɵqud"](603979776,3,{_mainButton:0}),mt["ɵqud"](603979776,4,{_fabLists:1}),(t()(),mt["ɵted"](0,["\n                "])),(t()(),mt["ɵand"](16777216,null,0,1,null,s)),mt["ɵdid"](802816,null,0,Nt.j,[mt.ViewContainerRef,mt.TemplateRef,mt.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(t()(),mt["ɵted"](0,["\n            "]))],function(t,e){t(e,6,0,e.component.gpsTaskButtonLabels)},null)}function i(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,4,"div",[["id","gpsTaskMap"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,l)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n        "]))],function(t,e){var n=e.component;t(e,3,0,n.task&&"gps"==n.task.solutionType)},null)}function a(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","image"]],[[8,"src",4]],[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.openInPhotoviewer()&&s}return s},null,null))],null,function(t,e){t(e,0,0,e.component.task.getImageURL())})}function o(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","image"]],[[8,"src",4]],[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.openInPhotoviewer(!0)&&s}return s},null,null))],null,function(t,e){t(e,0,0,e.component.rootTask.getImageURL())})}function r(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,3,"ion-label",[],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef])],null,function(t,e){t(e,2,0,mt["ɵunv"](e,2,0,mt["ɵnov"](e,3).transform("a_title_activity_task_view")))})}function u(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,4,"ion-label",[],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpod"]({current:0,count:1}),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef])],null,function(t,e){var n=e.component;t(e,2,0,mt["ɵunv"](e,2,0,mt["ɵnov"](e,4).transform("a_title_activity_subtask_view",t(e,3,0,n.subTaskIndex+1,n.rootTask.subtasks.length))))})}function d(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,3,"ion-label",[["class","tag score"]],null,[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.displayScoreCalculation()&&s}return s},null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵppd"](1)],null,function(t,e){var n=e.component;t(e,2,0,mt["ɵunv"](e,2,0,t(e,3,0,mt["ɵnov"](e.parent,0),n.possibleScore())))})}function c(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,1,"p",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,["",""]))],null,function(t,e){t(e,1,0,e.component.task.description)})}function h(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,3,"ion-label",[],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef])],null,function(t,e){t(e,2,0,mt["ɵunv"](e,2,0,mt["ɵnov"](e,3).transform("a_task_answer")))})}function _(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,6,"ion-input",[["readonly","true"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"keyup.enter"],[null,"focus"],[null,"ngModelChange"]],function(t,e,n){var s=!0,l=t.component;if("keyup.enter"===e){s=!1!==l.checkResult()&&s}if("focus"===e){s=!1!==l.setKeyboardOn(!0)&&s}if("ngModelChange"===e){s=!1!==(l.taskDetails.answer=n)&&s}return s},Wt.b,Wt.a)),mt["ɵdid"](671744,null,0,qt.h,[[8,null],[8,null],[8,null],[8,null]],{isDisabled:[0,"isDisabled"],model:[1,"model"],options:[2,"options"]},{update:"ngModelChange"}),mt["ɵpod"]({standalone:0}),mt["ɵprd"](2048,null,qt.f,null,[qt.h]),mt["ɵdid"](16384,null,0,qt.g,[qt.f],null,null),mt["ɵdid"](5423104,null,0,zt.a,[xt.a,Gt.a,Ht.a,Zt.a,mt.ElementRef,mt.Renderer,[2,jt.a],[2,Jt.a],[2,qt.f],$t.a],{disabled:[0,"disabled"],type:[1,"type"],readonly:[2,"readonly"]},{focus:"focus"}),(t()(),mt["ɵted"](null,["\n                    "]))],function(t,e){var n=e.component;t(e,1,0,n.route&&n.route.isAnswerFeedbackEnabled()&&n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed),n.taskDetails.answer,t(e,2,0,!0));t(e,5,0,n.route&&n.route.isAnswerFeedbackEnabled()&&n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed),"text","true")},function(t,e){t(e,0,0,mt["ɵnov"](e,4).ngClassUntouched,mt["ɵnov"](e,4).ngClassTouched,mt["ɵnov"](e,4).ngClassPristine,mt["ɵnov"](e,4).ngClassDirty,mt["ɵnov"](e,4).ngClassValid,mt["ɵnov"](e,4).ngClassInvalid,mt["ɵnov"](e,4).ngClassPending)})}function p(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,4,"ion-input",[["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"]],function(t,e,n){var s=!0;if("ngModelChange"===e){s=!1!==(t.component.taskDetails.answer=n)&&s}return s},Wt.b,Wt.a)),mt["ɵdid"](671744,null,0,qt.h,[[8,null],[8,null],[8,null],[8,null]],{isDisabled:[0,"isDisabled"],model:[1,"model"]},{update:"ngModelChange"}),mt["ɵprd"](2048,null,qt.f,null,[qt.h]),mt["ɵdid"](16384,null,0,qt.g,[qt.f],null,null),mt["ɵdid"](5423104,null,0,zt.a,[xt.a,Gt.a,Ht.a,Zt.a,mt.ElementRef,mt.Renderer,[2,jt.a],[2,Jt.a],[2,qt.f],$t.a],{disabled:[0,"disabled"],type:[1,"type"]},null)],function(t,e){var n=e.component;t(e,1,0,n.route&&n.route.isAnswerFeedbackEnabled()&&n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed),n.taskDetails.answer);t(e,4,0,n.route&&n.route.isAnswerFeedbackEnabled()&&n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed),"text")},function(t,e){t(e,0,0,mt["ɵnov"](e,3).ngClassUntouched,mt["ɵnov"](e,3).ngClassTouched,mt["ɵnov"](e,3).ngClassPristine,mt["ɵnov"](e,3).ngClassDirty,mt["ɵnov"](e,3).ngClassValid,mt["ɵnov"](e,3).ngClassInvalid,mt["ɵnov"](e,3).ngClassPending)})}function f(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,13,"ion-item",[["class","item item-block"]],null,null,null,Xt.b,Xt.a)),mt["ɵdid"](1097728,null,3,Jt.a,[Ht.a,xt.a,mt.ElementRef,mt.Renderer,[2,Qt.a]],null,null),mt["ɵqud"](335544320,5,{contentLabel:0}),mt["ɵqud"](603979776,6,{_buttons:1}),mt["ɵqud"](603979776,7,{_icons:1}),mt["ɵdid"](16384,null,0,Yt.a,[],null,null),(t()(),mt["ɵted"](2,["\n                    "])),(t()(),mt["ɵted"](2,["\n                    "])),(t()(),mt["ɵand"](16777216,null,3,1,null,_)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](2,["\n                    "])),(t()(),mt["ɵand"](16777216,null,3,1,null,p)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](2,["\n                "]))],function(t,e){var n=e.component;t(e,9,0,"text"!=n.task.solutionType);t(e,12,0,"text"==n.task.solutionType)},null)}function k(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,2,"ion-label",[["floating",""]],null,null,null,null,null)),mt["ɵdid"](16384,[[8,4]],0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,""],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""]))],null,function(t,e){t(e,2,0,e.parent.context.$implicit.name)})}function g(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,4,"ion-label",[["floating",""]],null,null,null,null,null)),mt["ɵdid"](16384,[[8,4]],0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,""],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpod"]({index:0}),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef])],null,function(t,e){t(e,2,0,mt["ɵunv"](e,2,0,mt["ɵnov"](e,4).transform("a_task_set_answer",t(e,3,0,e.parent.context.index+1))))})}function m(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,22,"ion-item",[["class","item item-block"]],null,null,null,Xt.b,Xt.a)),mt["ɵdid"](278528,null,0,Nt.i,[mt.IterableDiffers,mt.KeyValueDiffers,mt.ElementRef,mt.Renderer],{ngClass:[0,"ngClass"]},null),mt["ɵpod"]({"is-focused":0}),mt["ɵdid"](1097728,null,3,Jt.a,[Ht.a,xt.a,mt.ElementRef,mt.Renderer,[2,Qt.a]],null,null),mt["ɵqud"](603979776,8,{contentLabel:0}),mt["ɵqud"](603979776,9,{_buttons:1}),mt["ɵqud"](603979776,10,{_icons:1}),mt["ɵdid"](16384,null,0,Yt.a,[],null,null),(t()(),mt["ɵted"](2,["\n                        "])),(t()(),mt["ɵand"](16777216,null,1,1,null,k)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](2,["\n                        "])),(t()(),mt["ɵand"](16777216,null,1,1,null,g)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](2,["\n                        "])),(t()(),mt["ɵeld"](0,null,3,6,"ion-input",[["readonly","true"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"keyup.enter"],[null,"focus"],[null,"ngModelChange"]],function(t,e,n){var s=!0,l=t.component;if("keyup.enter"===e){s=!1!==l.checkResult()&&s}if("focus"===e){s=!1!==l.setKeyboardOn(!0,t.context.index)&&s}if("ngModelChange"===e){s=!1!==(t.context.$implicit.answer=n)&&s}return s},Wt.b,Wt.a)),mt["ɵdid"](671744,null,0,qt.h,[[8,null],[8,null],[8,null],[8,null]],{isDisabled:[0,"isDisabled"],model:[1,"model"],options:[2,"options"]},{update:"ngModelChange"}),mt["ɵpod"]({standalone:0}),mt["ɵprd"](2048,null,qt.f,null,[qt.h]),mt["ɵdid"](16384,null,0,qt.g,[qt.f],null,null),mt["ɵdid"](5423104,null,0,zt.a,[xt.a,Gt.a,Ht.a,Zt.a,mt.ElementRef,mt.Renderer,[2,jt.a],[2,Jt.a],[2,qt.f],$t.a],{disabled:[0,"disabled"],type:[1,"type"],readonly:[2,"readonly"]},{focus:"focus"}),(t()(),mt["ɵted"](null,["\n                        "])),(t()(),mt["ɵted"](2,["\n                    "]))],function(t,e){var n=e.component;t(e,1,0,t(e,2,0,n.answerIndex==e.context.index&&n.keyboardVisible()));t(e,10,0,"set"!==n.task.solutionType);t(e,13,0,"set"===n.task.solutionType);t(e,16,0,e.context.$implicit.solved||n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed),e.context.$implicit.answer,t(e,17,0,!0));t(e,20,0,e.context.$implicit.solved||n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed),"text","true")},function(t,e){t(e,15,0,mt["ɵnov"](e,19).ngClassUntouched,mt["ɵnov"](e,19).ngClassTouched,mt["ɵnov"](e,19).ngClassPristine,mt["ɵnov"](e,19).ngClassDirty,mt["ɵnov"](e,19).ngClassValid,mt["ɵnov"](e,19).ngClassInvalid,mt["ɵnov"](e,19).ngClassPending)})}function v(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,5,"ion-list",[["class","vector-input-list"]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,te.a,[xt.a,mt.ElementRef,mt.Renderer,Gt.a,ee.l,$t.a],null,null),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵand"](16777216,null,null,1,null,m)),mt["ɵdid"](802816,null,0,Nt.j,[mt.ViewContainerRef,mt.TemplateRef,mt.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(t()(),mt["ɵted"](null,["\n                "]))],function(t,e){t(e,4,0,e.component.taskDetails.answerMultipleChoice)},null)}function b(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,10,"ion-item",[["class","item item-block"]],null,null,null,Xt.b,Xt.a)),mt["ɵdid"](1097728,null,3,Jt.a,[Ht.a,xt.a,mt.ElementRef,mt.Renderer,[2,Qt.a]],null,null),mt["ɵqud"](335544320,11,{contentLabel:0}),mt["ɵqud"](603979776,12,{_buttons:1}),mt["ɵqud"](603979776,13,{_icons:1}),mt["ɵdid"](16384,null,0,Yt.a,[],null,null),(t()(),mt["ɵted"](2,["\n                    "])),(t()(),mt["ɵeld"](0,null,2,2,"p",[["id","blankContainer"]],null,null,null,null,null)),mt["ɵdid"](278528,null,0,Nt.i,[mt.IterableDiffers,mt.KeyValueDiffers,mt.ElementRef,mt.Renderer],{ngClass:[0,"ngClass"]},null),mt["ɵpod"]({disabled:0}),(t()(),mt["ɵted"](2,["\n                "]))],function(t,e){var n=e.component;t(e,8,0,t(e,9,0,n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed)))},null)}function y(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,17,"ion-item",[["class","item item-block"]],null,null,null,Xt.b,Xt.a)),mt["ɵdid"](1097728,[[2,4],["multipleChoiceAnswers",4]],3,Jt.a,[Ht.a,xt.a,mt.ElementRef,mt.Renderer,[2,Qt.a]],null,null),mt["ɵqud"](335544320,14,{contentLabel:0}),mt["ɵqud"](603979776,15,{_buttons:1}),mt["ɵqud"](603979776,16,{_icons:1}),mt["ɵdid"](16384,null,0,Yt.a,[],null,null),(t()(),mt["ɵted"](2,["\n                        "])),(t()(),mt["ɵeld"](0,null,0,5,"ion-checkbox",[],[[2,"checkbox-disabled",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==mt["ɵnov"](t,8)._click(n)&&s}if("ngModelChange"===e){s=!1!==(t.context.$implicit.userChecked=n)&&s}return s},ne.b,ne.a)),mt["ɵdid"](1228800,null,0,se.a,[xt.a,Ht.a,[2,Jt.a],mt.ElementRef,mt.Renderer],{disabled:[0,"disabled"]},null),mt["ɵprd"](1024,null,qt.e,function(t){return[t]},[se.a]),mt["ɵdid"](671744,null,0,qt.h,[[8,null],[8,null],[8,null],[2,qt.e]],{isDisabled:[0,"isDisabled"],model:[1,"model"]},{update:"ngModelChange"}),mt["ɵprd"](2048,null,qt.f,null,[qt.h]),mt["ɵdid"](16384,null,0,qt.g,[qt.f],null,null),(t()(),mt["ɵted"](2,["\n                        "])),(t()(),mt["ɵeld"](0,null,1,2,"ion-label",[["class","multi-choice-label"],["tappable",""],["text-wrap",""]],null,null,null,null,null)),mt["ɵdid"](16384,[[14,4]],0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),(t()(),mt["ɵted"](2,["\n                    "]))],function(t,e){var n=e.component;t(e,8,0,n.route&&n.route.isAnswerFeedbackEnabled()&&n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed));t(e,10,0,n.route&&n.route.isAnswerFeedbackEnabled()&&n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed),e.context.$implicit.userChecked)},function(t,e){t(e,7,0,mt["ɵnov"](e,8)._disabled,mt["ɵnov"](e,12).ngClassUntouched,mt["ɵnov"](e,12).ngClassTouched,mt["ɵnov"](e,12).ngClassPristine,mt["ɵnov"](e,12).ngClassDirty,mt["ɵnov"](e,12).ngClassValid,mt["ɵnov"](e,12).ngClassInvalid,mt["ɵnov"](e,12).ngClassPending);t(e,16,0,e.context.$implicit.value)})}function D(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,5,"ion-list",[],null,null,null,null,null)),mt["ɵdid"](16384,null,0,te.a,[xt.a,mt.ElementRef,mt.Renderer,Gt.a,ee.l,$t.a],null,null),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵand"](16777216,null,null,1,null,y)),mt["ɵdid"](802816,null,0,Nt.j,[mt.ViewContainerRef,mt.TemplateRef,mt.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(t()(),mt["ɵted"](null,["\n                "]))],function(t,e){t(e,4,0,e.component.multipleChoiceList)},null)}function T(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,16,"div",[["class","answer"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,h)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,f)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,v)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,b)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,D)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n            "]))],function(t,e){var n=e.component;t(e,3,0,n.task&&"gps"!=n.task.solutionType&&n.route.isAnswerValidationEnabled());t(e,6,0,n.task&&!n.isSpecialTaskType&&n.route.isAnswerValidationEnabled()&&n.taskDetails&&(!n.subTasksRequired||!n.task.subtasks||n.rootTask||n.task.subtasks.length===n.solvedSubtasks.length));t(e,9,0,n.task&&("vector_values"===n.task.solutionType||"vector_intervals"===n.task.solutionType||"set"===n.task.solutionType)&&n.taskDetails&&n.route.isAnswerValidationEnabled()&&(!n.subTasksRequired||!n.task.subtasks||n.rootTask||n.task.subtasks.length===n.solvedSubtasks.length));t(e,12,0,n.task&&"blanks"===n.task.solutionType&&(!n.subTasksRequired||!n.task.subtasks||n.rootTask||n.task.subtasks.length===n.solvedSubtasks.length));t(e,15,0,n.task&&"multiple_choice"==n.task.solutionType&&n.multipleChoiceList&&n.route.isAnswerValidationEnabled()&&(!n.subTasksRequired||!n.task.subtasks||n.rootTask||n.task.subtasks.length===n.solvedSubtasks.length))},null)}function L(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","round"],["src","./assets/icons/icon_hint-activated.svg"]],null,null,null,null,null))],null,null)}function S(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","round used"],["src","./assets/icons/icon_hint-activated-used.svg"]],null,null,null,null,null))],null,null)}function C(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,8,"button",[["class","hint"],["color","primary"],["icon-only",""],["ion-button",""],["round",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.showHint(1)&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵand"](16777216,null,0,1,null,L)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵand"](16777216,null,0,1,null,S)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](0,["\n                            "]))],function(t,e){var n=e.component;t(e,1,0,"primary","");t(e,4,0,!n.taskDetails.hint1);t(e,7,0,n.taskDetails.hint1)},function(t,e){t(e,0,0,!1)})}function M(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","round"],["src","./assets/icons/icon_hint-activated.svg"]],null,null,null,null,null))],null,null)}function w(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","round used"],["src","./assets/icons/icon_hint-activated-used.svg"]],null,null,null,null,null))],null,null)}function E(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","round"],["src","./assets/icons/icon_hint-deactivated.svg"]],null,null,null,null,null))],null,null)}function R(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,11,"button",[["class","hint"],["color","primary"],["icon-only",""],["ion-button",""],["round",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.showHint(2)&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵand"](16777216,null,0,1,null,M)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵand"](16777216,null,0,1,null,w)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵand"](16777216,null,0,1,null,E)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](0,["\n                            "]))],function(t,e){var n=e.component;t(e,1,0,"primary","");t(e,4,0,n.taskDetails.hint1&&!n.taskDetails.hint2);t(e,7,0,n.taskDetails.hint1&&n.taskDetails.hint2);t(e,10,0,!n.taskDetails.hint1)},function(t,e){t(e,0,0,!e.component.taskDetails.hint1)})}function I(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","round"],["src","./assets/icons/icon_hint-activated.svg"]],null,null,null,null,null))],null,null)}function P(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","round used"],["src","./assets/icons/icon_hint-activated-used.svg"]],null,null,null,null,null))],null,null)}function A(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","round"],["src","./assets/icons/icon_hint-deactivated.svg"]],null,null,null,null,null))],null,null)}function O(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,11,"button",[["class","hint"],["color","primary"],["icon-only",""],["ion-button",""],["round",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.showHint(3)&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵand"](16777216,null,0,1,null,I)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵand"](16777216,null,0,1,null,P)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵand"](16777216,null,0,1,null,A)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](0,["\n                            "]))],function(t,e){var n=e.component;t(e,1,0,"primary","");t(e,4,0,n.taskDetails.hint1&&n.taskDetails.hint2&&!n.taskDetails.hint3);t(e,7,0,n.taskDetails.hint1&&n.taskDetails.hint2&&n.taskDetails.hint3);t(e,10,0,!n.taskDetails.hint2)},function(t,e){t(e,0,0,!e.component.taskDetails.hint2)})}function x(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,11,"ion-col",[["class","col"]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,ae.a,[],null,null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,C)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,R)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,O)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                        "]))],function(t,e){var n=e.component;t(e,4,0,n.task.hasHintMessage(1));t(e,7,0,n.task.hasHintMessage(2));t(e,10,0,n.task.hasHintMessage(3))},null)}function U(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,3,"button",[["ion-button",""],["round",""],["small",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.checkResult()&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{small:[0,"small"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                ","\n                            "])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef])],function(t,e){t(e,1,0,"","")},function(t,e){var n=e.component;t(e,0,0,!((n.isDecimal(n.taskDetails.answer)||"range"!=n.task.solutionType&&"value"!=n.task.solutionType)&&("multiple_choice"==n.task.solutionType||n.isSpecialTypeAnswered()||n.taskDetails.answer||"gps"==n.task.solutionType&&null!=n.taskDetailMap&&n.taskDetailMap.areAllPointsSet())));t(e,2,0,mt["ɵunv"](e,2,0,mt["ɵnov"](e,3).transform("a_btn_check_answer")))})}function B(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,5,"ion-col",[["class","col"]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,ae.a,[],null,null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,U)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                        "]))],function(t,e){var n=e.component;t(e,4,0,n.task&&n.taskDetails&&!n.taskDetails.solved&&!n.taskDetails.solvedLow&&!n.taskDetails.failed&&(!n.subTasksRequired||!n.task.subtasks||n.rootTask||n.task.subtasks.length===n.solvedSubtasks.length))},null)}function G(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,3,"button",[["ion-button",""],["round",""],["small",""]],null,[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.completeTask()&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{small:[0,"small"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                ","\n                            "])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef])],function(t,e){t(e,1,0,"","")},function(t,e){t(e,2,0,mt["ɵunv"](e,2,0,mt["ɵnov"](e,3).transform("a_task_complete")))})}function N(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,5,"ion-col",[["class","col"]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,ae.a,[],null,null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,G)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                        "]))],function(t,e){var n=e.component;t(e,4,0,n.task&&n.taskDetails&&!n.taskDetails.solved&&!n.taskDetails.solvedLow&&!n.taskDetails.failed)},null)}function V(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,3,"button",[["ion-button",""],["round",""],["small",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.checkResult()&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{small:[0,"small"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                ","\n                            "])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef])],function(t,e){t(e,1,0,"","")},function(t,e){var n=e.component;t(e,0,0,!n.isDecimal(n.taskDetails.answer)&&("range"==n.task.solutionType||"value"==n.task.solutionType)||"multiple_choice"!=n.task.solutionType&&!n.taskDetails.answer&&("gps"!=n.task.solutionType||!(null!=n.taskDetailMap&&n.taskDetailMap.areAllPointsSet())));t(e,2,0,mt["ɵunv"](e,2,0,mt["ɵnov"](e,3).transform("p_save")))})}function K(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,5,"ion-col",[["class","col"]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,ae.a,[],null,null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,V)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                        "]))],function(t,e){var n=e.component;t(e,4,0,n.task&&n.taskDetails)},null)}function F(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","primary"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.showSolutionSample()&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/icon_show_sample_salution.svg"]],null,null,null,null,null)),(t()(),mt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"primary","")},null)}function W(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","danger"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.openSubtask()&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/subtask_icon.svg"]],null,null,null,null,null)),(t()(),mt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"danger","")},null)}function q(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","danger"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.closeDetails()&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/task_icon.svg"]],null,null,null,null,null)),(t()(),mt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"danger","")},null)}function z(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","danger"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.confirmSkippingTask()&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/icon_skip.svg"]],null,null,null,null,null)),(t()(),mt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"danger","")},null)}function H(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","danger"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.closeDetails(!1)&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/icon_skip.svg"]],null,null,null,null,null)),(t()(),mt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"danger","")},null)}function Z(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","danger"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.goToNextSubtask()&&s}return s},le.b,le.a)),mt["ɵdid"](1097728,null,0,ie.a,[[8,""],xt.a,mt.ElementRef,mt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),mt["ɵted"](0,["\n                                "])),(t()(),mt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/icon_skip.svg"]],null,null,null,null,null)),(t()(),mt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"danger","")},null)}function j(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,48,"div",[["class","on-the-edge-container"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵeld"](0,null,null,45,"ion-grid",[["class","grid"],["no-padding",""]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,oe.a,[],null,null),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵeld"](0,null,null,41,"ion-row",[["class","row"]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,re.a,[],null,null),(t()(),mt["ɵted"](null,["\n                        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,x)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n\n                        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,B)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n\n                        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,N)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n\n                        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,K)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n\n                        "])),(t()(),mt["ɵeld"](0,null,null,25,"ion-col",[["class","col"]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,ae.a,[],null,null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,F)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,W)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,q)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,z)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,H)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵted"](null,["\n                            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,Z)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                        "])),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵted"](null,["\n\n            "]))],function(t,e){var n=e.component;t(e,9,0,n.route.isHintsEnabled()&&n.task&&(!n.subTasksRequired||!n.task.subtasks||n.rootTask||n.task.subtasks.length===n.solvedSubtasks.length));t(e,12,0,n.route&&n.route.isAnswerFeedbackEnabled()&&n.route.isAnswerValidationEnabled()&&n.task&&"info"!=n.task.solutionType);t(e,15,0,n.route&&n.route.isAnswerFeedbackEnabled()&&!n.route.isAnswerValidationEnabled()||n.task&&"info"==n.task.solutionType);t(e,18,0,n.route&&!n.route.isAnswerFeedbackEnabled()&&n.task&&"info"!=n.task.solutionType);t(e,24,0,n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed)&&n.route.isSampleSolutionEnabled()&&n.route.isAnswerFeedbackEnabled()&&"info"!==n.task.solutionType);t(e,28,0,n.task.subtasks&&n.task.subtasks.length!==n.solvedSubtasks.length&&n.task&&n.taskDetails&&!n.taskDetails.solved&&!n.taskDetails.solvedLow&&!n.taskDetails.failed);t(e,32,0,n.rootTask&&n.task);t(e,36,0,n.task&&n.taskDetails&&"info"!==n.task.solutionType&&!n.taskDetails.solved&&!n.taskDetails.solvedLow&&!n.taskDetails.failed&&(!n.rootTask||!n.subTasksRequired||n.rootTask&&n.subTasksRequired&&n.taskDetails.tries>=2));t(e,40,0,!n.rootTask&&n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed));t(e,44,0,n.rootTask&&n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||n.taskDetails.failed))},null)}function J(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,7,"ion-label",[["class","answer_container"]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef]),(t()(),mt["ɵeld"](0,null,null,3,"span",[["class","answer"]],null,null,null,null,null)),mt["ɵdid"](278528,null,0,Nt.i,[mt.IterableDiffers,mt.KeyValueDiffers,mt.ElementRef,mt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),mt["ɵpod"]({perfect:0,good:1,failed:2,saved:3}),(t()(),mt["ɵted"](null,["",""]))],function(t,e){var n=e.component;t(e,5,0,"answer",t(e,6,0,e.parent.context.$implicit.solved&&n.route.isAnswerFeedbackEnabled(),e.parent.context.$implicit.solvedLow&&n.route.isAnswerFeedbackEnabled(),e.parent.context.$implicit.failed&&n.route.isAnswerFeedbackEnabled(),!n.route.isAnswerFeedbackEnabled()))},function(t,e){t(e,2,0,mt["ɵunv"](e,2,0,mt["ɵnov"](e,3).transform("a_task_score")));t(e,7,0,e.parent.context.$implicit.score)})}function $(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,37,"div",[["class","accordion"]],null,null,null,null,null)),mt["ɵdid"](278528,null,0,Nt.i,[mt.IterableDiffers,mt.KeyValueDiffers,mt.ElementRef,mt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),mt["ɵpod"]({open:0}),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵeld"](0,null,null,10,"div",[["class","accordion_title"]],null,[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.changeSubtaskAccordionState(t.context.$implicit.taskId)&&s}return s},null,null)),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵeld"](0,null,null,1,"p",[["class","task_name"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["#"," ",""])),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵeld"](0,null,null,2,"div",[["class","rating_container"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                        "])),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","accordion_arrow"],["src","./assets/icons/subtask_arrow.svg"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵeld"](0,null,null,20,"div",[["class","accordion_content"]],null,[[null,"click"]],function(t,e,n){var s=!0;if("click"===e){s=!1!==t.component.openSubtask(t.context.index)&&s}return s},null,null)),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵeld"](0,null,null,3,"span",[["class","description"]],null,null,null,null,null)),mt["ɵdid"](278528,null,0,Nt.i,[mt.IterableDiffers,mt.KeyValueDiffers,mt.ElementRef,mt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),mt["ɵpod"]({compact:0}),(t()(),mt["ɵted"](null,["",""])),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵeld"](0,null,null,7,"ion-label",[["class","answer_container"]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef]),(t()(),mt["ɵeld"](0,null,null,3,"span",[["class","answer"]],null,null,null,null,null)),mt["ɵdid"](278528,null,0,Nt.i,[mt.IterableDiffers,mt.KeyValueDiffers,mt.ElementRef,mt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),mt["ɵpod"]({perfect:0,good:1,failed:2,saved:3}),(t()(),mt["ɵted"](null,["",""])),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵand"](16777216,null,null,1,null,J)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵeld"](0,null,null,0,"img",[["class","subtask-inner-arrow"],["src","./assets/icons/subtask_arrow.svg"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵted"](null,["\n            "]))],function(t,e){var n=e.component;t(e,1,0,"accordion",t(e,2,0,-1!=n.activeAccordions.indexOf(e.context.$implicit.taskId)));t(e,19,0,"description",t(e,20,0,n.subTasksRequired));t(e,28,0,"answer",t(e,29,0,e.context.$implicit.solved&&n.route.isAnswerFeedbackEnabled(),e.context.$implicit.solvedLow&&n.route.isAnswerFeedbackEnabled(),e.context.$implicit.failed&&n.route.isAnswerFeedbackEnabled(),!n.route.isAnswerFeedbackEnabled()));t(e,33,0,n.subTasksRequired)},function(t,e){var n=e.component;t(e,7,0,e.context.index+1,n.task.subtasks[e.context.index].title);t(e,21,0,n.task.subtasks[e.context.index].description);t(e,25,0,mt["ɵunv"](e,25,0,mt["ɵnov"](e,26).transform("a_task_answer")));t(e,30,0,e.context.$implicit.answer)})}function X(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,9,"div",[["class","card subtasks"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n            "])),(t()(),mt["ɵeld"](0,null,null,3,"ion-label",[],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef]),(t()(),mt["ɵted"](null,["\n            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,$)),mt["ɵdid"](802816,null,0,Nt.j,[mt.ViewContainerRef,mt.TemplateRef,mt.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(t()(),mt["ɵted"](null,["\n        "]))],function(t,e){t(e,8,0,e.component.solvedSubtasks)},function(t,e){t(e,4,0,mt["ɵunv"](e,4,0,mt["ɵnov"](e,5).transform("a_solved_subtasks")))})}function Q(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,5,"div",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                        "])),(t()(),mt["ɵeld"](0,null,null,2,"ion-label",[["text-wrap",""]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),(t()(),mt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,4,0,e.component.route.getNarrativeString("a_alert_congrats"))})}function Y(t){return mt["ɵvid"](0,[(t()(),mt["ɵted"](null,["\n                        "])),(t()(),mt["ɵeld"](0,null,null,3,"ion-label",[["text-wrap",""]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef]),(t()(),mt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,3,0,mt["ɵunv"](e,3,0,mt["ɵnov"](e,4).transform("a_alert_congrats")))})}function tt(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,6,"div",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵand"](16777216,null,null,1,null,Q)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵand"](0,[["elseBlock",2]],null,0,null,Y)),(t()(),mt["ɵted"](null,["\n                "]))],function(t,e){var n=e.component;t(e,3,0,n.route.isNarrativeEnabled()&&n.route.hasNarrativeString("a_alert_congrats"),mt["ɵnov"](e,5))},null)}function et(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,5,"div",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                        "])),(t()(),mt["ɵeld"](0,null,null,2,"ion-label",[["text-wrap",""]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),(t()(),mt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,4,0,e.component.route.getNarrativeString("good_luck_next_time"))})}function nt(t){return mt["ɵvid"](0,[(t()(),mt["ɵted"](null,["\n                        "])),(t()(),mt["ɵeld"](0,null,null,3,"ion-label",[["text-wrap",""]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef]),(t()(),mt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,3,0,mt["ɵunv"](e,3,0,mt["ɵnov"](e,4).transform("good_luck_next_time")))})}function st(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,6,"div",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵand"](16777216,null,null,1,null,et)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵand"](0,[["elseBlock",2]],null,0,null,nt)),(t()(),mt["ɵted"](null,["\n                "]))],function(t,e){var n=e.component;t(e,3,0,n.route.isNarrativeEnabled()&&n.route.hasNarrativeString("good_luck_next_time"),mt["ɵnov"](e,5))},null)}function lt(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,5,"div",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                        "])),(t()(),mt["ɵeld"](0,null,null,2,"ion-label",[["text-wrap",""]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),(t()(),mt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,4,0,e.component.route.getNarrativeString("a_alert_congrats"))})}function it(t){return mt["ɵvid"](0,[(t()(),mt["ɵted"](null,["\n                        "])),(t()(),mt["ɵeld"](0,null,null,3,"ion-label",[["text-wrap",""]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef]),(t()(),mt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,3,0,mt["ɵunv"](e,3,0,mt["ɵnov"](e,4).transform("a_alert_congrats")))})}function at(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,6,"div",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵand"](16777216,null,null,1,null,lt)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵand"](0,[["elseBlock",2]],null,0,null,it)),(t()(),mt["ɵted"](null,["\n                "]))],function(t,e){var n=e.component;t(e,3,0,n.route.isNarrativeEnabled()&&n.route.hasNarrativeString("a_alert_congrats"),mt["ɵnov"](e,5))},null)}function ot(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,2,"ion-label",[["class","tag score"]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["+ ",""]))],null,function(t,e){t(e,2,0,e.component.taskDetails.score)})}function rt(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,13,"div",[["class","head"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,tt)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,st)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,at)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,ot)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n            "]))],function(t,e){var n=e.component;t(e,3,0,((null==n.taskDetails?null:n.taskDetails.solved)||(null==n.taskDetails?null:n.taskDetails.solvedLow))&&n.route.isAnswerFeedbackEnabled()&&n.task&&"info"!==n.task.solutionType);t(e,6,0,(null==n.taskDetails?null:n.taskDetails.failed)&&n.route.isAnswerFeedbackEnabled()&&n.task&&"info"!==n.task.solutionType);t(e,9,0,n.taskDetails.saved&&!n.route.isAnswerFeedbackEnabled()&&n.task&&"info"!==n.task.solutionType);t(e,12,0,n.route.isAnswerFeedbackEnabled()&&!n.gamificationIsDisabled&&n.taskDetails&&(n.taskDetails.score||0==n.taskDetails.score))},null)}function ut(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,6,"div",[["class","card evaluation"]],null,null,null,null,null)),mt["ɵdid"](278528,null,0,Nt.i,[mt.IterableDiffers,mt.KeyValueDiffers,mt.ElementRef,mt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),mt["ɵpod"]({saved:0,perfect:1,good:2,failed:3}),(t()(),mt["ɵted"](null,["\n            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,rt)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n        "]))],function(t,e){var n=e.component;t(e,1,0,"card evaluation",t(e,2,0,null==n.taskDetails?null:n.taskDetails.saved,(null==n.taskDetails?null:n.taskDetails.solved)&&n.route.isAnswerFeedbackEnabled(),(null==n.taskDetails?null:n.taskDetails.solvedLow)&&n.route.isAnswerFeedbackEnabled(),(null==n.taskDetails?null:n.taskDetails.failed)&&n.route.isAnswerFeedbackEnabled()));t(e,5,0,"info"!==n.task.solutionType)},null)}function dt(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"div",[["id","keyboard-anchor"]],null,null,null,null,null))],null,null)}function ct(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,0,"div",[["id","snd-keyboard-anchor"]],null,null,null,null,null))],null,null)}function ht(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,5,"div",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵeld"](0,null,null,2,"ion-label",[["text-wrap",""]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),(t()(),mt["ɵted"](null,["\n                "]))],null,function(t,e){t(e,4,0,e.component.route.getNarrativeString("a_did_you_know"))})}function _t(t){return mt["ɵvid"](0,[(t()(),mt["ɵted"](null,["\n                    "])),(t()(),mt["ɵeld"](0,null,null,3,"ion-label",[["text-wrap",""]],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef]),(t()(),mt["ɵted"](null,["\n                "]))],null,function(t,e){t(e,3,0,mt["ɵunv"](e,3,0,mt["ɵnov"](e,4).transform("a_did_you_know")))})}function pt(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,1,"p",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n\t\t\t    ","\n\t\t    "]))],null,function(t,e){t(e,1,0,e.component.task.getSideFactsText())})}function ft(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,9,"div",[["class","card secondary"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,ht)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](0,[["elseBlock",2]],null,0,null,_t)),(t()(),mt["ɵted"](null,["\n\t\t    "])),(t()(),mt["ɵand"](16777216,null,null,1,null,pt)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n\t    "]))],function(t,e){var n=e.component;t(e,3,0,n.route.isNarrativeEnabled()&&n.route.hasNarrativeString("a_did_you_know"),mt["ɵnov"](e,5));t(e,8,0,n.task)},null)}function kt(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,11,"div",[["class","card secondary"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n            "])),(t()(),mt["ɵeld"](0,null,null,3,"ion-label",[],null,null,null,null,null)),mt["ɵdid"](16384,null,0,Vt.a,[xt.a,mt.ElementRef,mt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),mt["ɵted"](null,["",""])),mt["ɵpid"](131072,Kt.a,[Ft.a,mt.ChangeDetectorRef]),(t()(),mt["ɵted"](null,["\n            "])),(t()(),mt["ɵeld"](0,null,null,3,"p",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                ",""])),(t()(),mt["ɵeld"](0,null,null,0,"br",[],null,null,null,null,null)),(t()(),mt["ɵted"](null,[" ","\n            "])),(t()(),mt["ɵted"](null,["\n        "]))],null,function(t,e){var n=e.component;t(e,4,0,mt["ɵunv"](e,4,0,mt["ɵnov"](e,5).transform("author")));t(e,8,0,n.task.author);t(e,10,0,n.task.mail)})}function gt(t){return mt["ɵvid"](0,[mt["ɵpid"](0,Nt.e,[mt.LOCALE_ID]),mt["ɵqud"](402653184,1,{content:0}),mt["ɵqud"](671088640,2,{multipleChoiceView:1}),(t()(),mt["ɵeld"](0,null,null,1,"mcm-header",[],null,null,null,ue.b,ue.a)),mt["ɵdid"](114688,null,0,de.a,[ce.a,he.a,_e.a,pe.a,fe.a,ke.a],null,null),(t()(),mt["ɵted"](null,["\n"])),(t()(),mt["ɵeld"](0,null,null,67,"ion-content",[["class","has-header padding bottom"],["no-bounce",""]],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,ge.b,ge.a)),mt["ɵdid"](278528,null,0,Nt.i,[mt.IterableDiffers,mt.KeyValueDiffers,mt.ElementRef,mt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),mt["ɵdid"](4374528,[[1,4]],0,jt.a,[xt.a,Gt.a,$t.a,mt.ElementRef,mt.Renderer,Zt.a,me.a,mt.NgZone,[2,_e.a],[2,ce.a]],null,null),(t()(),mt["ɵted"](1,["\n    "])),(t()(),mt["ɵeld"](0,null,1,12,"div",[["class","task-header"]],null,null,null,null,null)),mt["ɵdid"](278528,null,0,Nt.i,[mt.IterableDiffers,mt.KeyValueDiffers,mt.ElementRef,mt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),mt["ɵpod"]({gps:0}),(t()(),mt["ɵted"](null,["\n        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,i)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,a)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,o)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n    "])),(t()(),mt["ɵted"](1,["\n    "])),(t()(),mt["ɵeld"](0,null,1,48,"div",[["class","task-content"]],null,null,null,null,null)),mt["ɵdid"](278528,null,0,Nt.i,[mt.IterableDiffers,mt.KeyValueDiffers,mt.ElementRef,mt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),mt["ɵpod"]({subtask:0}),(t()(),mt["ɵted"](null,["\n        "])),(t()(),mt["ɵeld"](0,null,null,0,"div",[["class","transition"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n        "])),(t()(),mt["ɵeld"](0,null,null,22,"div",[["class","card task has-button-on-the-edge"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n\n            "])),(t()(),mt["ɵeld"](0,null,null,10,"div",[["class","head"]],null,null,null,null,null)),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,r)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,u)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n                "])),(t()(),mt["ɵand"](16777216,null,null,1,null,d)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n            "])),(t()(),mt["ɵted"](null,["\n            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,c)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,T)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n\n            "])),(t()(),mt["ɵand"](16777216,null,null,1,null,j)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n        "])),(t()(),mt["ɵted"](null,["\n\n        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,X)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n\n       "])),(t()(),mt["ɵted"](null,["\n        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,ut)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n\n        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,dt)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,ct)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n\t    "])),(t()(),mt["ɵand"](16777216,null,null,1,null,ft)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n        "])),(t()(),mt["ɵand"](16777216,null,null,1,null,kt)),mt["ɵdid"](16384,null,0,Nt.k,[mt.ViewContainerRef,mt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),mt["ɵted"](null,["\n    "])),(t()(),mt["ɵted"](1,["\n\n"])),(t()(),mt["ɵted"](null,["\n"]))],function(t,e){var n=e.component;t(e,4,0);t(e,7,0,"has-header padding bottom",n.keyboardVisible()?"mcm-keyboard-open":"");t(e,11,0,"task-header",t(e,12,0,n.task&&"gps"==n.task.solutionType));t(e,15,0,n.task&&"gps"==n.task.solutionType);t(e,18,0,n.task&&"gps"!=n.task.solutionType&&n.task.image);t(e,21,0,n.task&&!n.task.image&&n.rootTask&&n.rootTask.image&&"gps"!=n.task.solutionType);t(e,25,0,"task-content",t(e,26,0,n.rootTask));t(e,35,0,!n.rootTask);t(e,38,0,n.rootTask);t(e,41,0,n.route&&n.route.isAnswerFeedbackEnabled()&&(!n.rootTask||n.subTasksRequired)&&!n.gamificationIsDisabled);t(e,45,0,n.task);t(e,48,0,n.task&&"info"!=n.task.solutionType&&(!n.subTasksRequired||!n.task.subtasks||n.rootTask||n.task.subtasks.length===n.solvedSubtasks.length));t(e,51,0,n.taskDetails);t(e,55,0,n.task&&n.task.subtasks&&n.task.subtasks.length>0&&n.solvedSubtasks&&n.solvedSubtasks.length>0);t(e,59,0,n.route&&n.taskDetails&&(n.taskDetails.solved||n.taskDetails.solvedLow||(null==n.taskDetails?null:n.taskDetails.failed)||(null==n.taskDetails?null:n.taskDetails.saved)));t(e,62,0,!n.rootTask);t(e,65,0,n.rootTask);t(e,68,0,n.taskDetails&&n.task.hasSideFacts());t(e,71,0,n.task&&n.task.author)},function(t,e){t(e,6,0,mt["ɵnov"](e,8).statusbarPadding,mt["ɵnov"](e,8)._hasRefresher)})}Object.defineProperty(e,"__esModule",{value:!0});var mt=n(1),vt=(n(0),n(17),n(43)),bt=n(942),yt=n(188),Dt=n(76),Tt=function(){return function(){}}(),Lt=n(605),St=n(606),Ct=n(607),Mt=n(608),wt=n(609),Et=n(610),Rt=n(611),It=n(612),Pt=n(613),At=n(934),Ot=n(137),xt=n(4),Ut=n(933),Bt=n(277),Gt=n(8),Nt=n(12),Vt=n(49),Kt=n(38),Ft=n(22),Wt=n(301),qt=n(23),zt=n(112),Ht=n(27),Zt=n(11),jt=n(35),Jt=n(29),$t=n(14),Xt=n(146),Qt=n(61),Yt=n(92),te=n(147),ee=n(16),ne=n(621),se=n(148),le=n(25),ie=n(18),ae=n(93),oe=n(94),re=n(95),ue=n(278),de=n(141),ce=n(24),he=n(13),_e=n(6),pe=n(53),fe=n(48),ke=n(26),ge=n(276),me=n(54),ve=n(37),be=n(108),ye=n(60),De=n(140),Te=n(55),Le=n(41),Se=mt["ɵcrt"]({encapsulation:2,styles:[],data:{}}),Ce=mt["ɵccf"]("page-task-detail",bt.a,function(t){return mt["ɵvid"](0,[(t()(),mt["ɵeld"](0,null,null,1,"page-task-detail",[],null,null,null,gt,Se)),mt["ɵdid"](49152,null,0,bt.a,[ce.a,he.a,ve.a,fe.a,ke.a,pe.a,be.a,ye.a,De.b,Dt.a,Te.a,Le.a],null,null)],null,null)},{},{},[]),Me=n(275),we=n(91);n.d(e,"TaskDetailPageModuleNgFactory",function(){return Ee});var Ee=mt["ɵcmf"](Tt,[],function(t){return mt["ɵmod"]([mt["ɵmpd"](512,mt.ComponentFactoryResolver,mt["ɵCodegenComponentFactoryResolver"],[[8,[Lt.a,St.a,Ct.a,Mt.a,wt.a,Et.a,Rt.a,It.a,Pt.a,Ce]],[3,mt.ComponentFactoryResolver],mt.NgModuleRef]),mt["ɵmpd"](4608,Nt.m,Nt.l,[mt.LOCALE_ID]),mt["ɵmpd"](4608,qt.k,qt.k,[]),mt["ɵmpd"](4608,qt.c,qt.c,[]),mt["ɵmpd"](4608,Dt.a,Dt.a,[]),mt["ɵmpd"](512,Nt.b,Nt.b,[]),mt["ɵmpd"](512,qt.j,qt.j,[]),mt["ɵmpd"](512,qt.d,qt.d,[]),mt["ɵmpd"](512,qt.i,qt.i,[]),mt["ɵmpd"](512,Me.a,Me.a,[]),mt["ɵmpd"](512,Me.b,Me.b,[]),mt["ɵmpd"](512,vt.a,vt.a,[]),mt["ɵmpd"](512,yt.a,yt.a,[]),mt["ɵmpd"](512,Tt,Tt,[]),mt["ɵmpd"](256,we.a,bt.a,[])])})},933:function(t,e,n){"use strict";function s(t){return l["ɵvid"](0,[l["ɵncd"](null,0)],null,null)}n.d(e,"a",function(){return i}),e.b=s;var l=n(1),i=l["ɵcrt"]({encapsulation:2,styles:[],data:{}})},934:function(t,e,n){"use strict";function s(t){return l["ɵvid"](2,[(t()(),l["ɵeld"](0,null,null,1,"ion-icon",[["class","fab-close-icon"],["name","close"],["role","img"]],[[2,"hide",null]],null,null,null,null)),l["ɵdid"](147456,null,0,i.a,[a.a,l.ElementRef,l.Renderer],{name:[0,"name"]},null),(t()(),l["ɵeld"](0,null,null,1,"span",[["class","button-inner"]],null,null,null,null,null)),l["ɵncd"](null,0),(t()(),l["ɵeld"](0,null,null,0,"div",[["class","button-effect"]],null,null,null,null,null))],function(t,e){t(e,1,0,"close")},function(t,e){t(e,0,0,l["ɵnov"](e,1)._hidden)})}n.d(e,"a",function(){return o}),e.b=s;var l=n(1),i=n(77),a=n(4),o=l["ɵcrt"]({encapsulation:2,styles:[],data:{}})},935:function(t,e){!function(t,e,n){L.MarkerClusterGroup=L.FeatureGroup.extend({options:{maxClusterRadius:80,iconCreateFunction:null,spiderfyOnMaxZoom:!0,showCoverageOnHover:!0,zoomToBoundsOnClick:!0,singleMarkerMode:!1,disableClusteringAtZoom:null,removeOutsideVisibleBounds:!0,animate:!0,animateAddingMarkers:!1,spiderfyDistanceMultiplier:1,spiderLegPolylineOptions:{weight:1.5,color:"#222",opacity:.5},chunkedLoading:!1,chunkInterval:200,chunkDelay:50,chunkProgress:null,polygonOptions:{}},initialize:function(t){L.Util.setOptions(this,t),this.options.iconCreateFunction||(this.options.iconCreateFunction=this._defaultIconCreateFunction),this.options.clusterPane||(this.options.clusterPane=L.Marker.prototype.options.pane),this._featureGroup=L.featureGroup(),this._featureGroup.addEventParent(this),this._nonPointGroup=L.featureGroup(),this._nonPointGroup.addEventParent(this),this._inZoomAnimation=0,this._needsClustering=[],this._needsRemoving=[],this._currentShownBounds=null,this._queue=[],this._childMarkerEventHandlers={dragstart:this._childMarkerDragStart,move:this._childMarkerMoved,dragend:this._childMarkerDragEnd};var e=L.DomUtil.TRANSITION&&this.options.animate;L.extend(this,e?this._withAnimation:this._noAnimation),this._markerCluster=e?L.MarkerCluster:L.MarkerClusterNonAnimated},addLayer:function(t){if(t instanceof L.LayerGroup)return this.addLayers([t]);if(!t.getLatLng)return this._nonPointGroup.addLayer(t),this.fire("layeradd",{layer:t}),this;if(!this._map)return this._needsClustering.push(t),this.fire("layeradd",{layer:t}),this;if(this.hasLayer(t))return this;this._unspiderfy&&this._unspiderfy(),this._addLayer(t,this._maxZoom),this.fire("layeradd",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons();var e=t,n=this._zoom;if(t.__parent)for(;e.__parent._zoom>=n;)e=e.__parent;return this._currentShownBounds.contains(e.getLatLng())&&(this.options.animateAddingMarkers?this._animationAddLayer(t,e):this._animationAddLayerNonAnimated(t,e)),this},removeLayer:function(t){return t instanceof L.LayerGroup?this.removeLayers([t]):t.getLatLng?this._map?t.__parent?(this._unspiderfy&&(this._unspiderfy(),this._unspiderfyLayer(t)),this._removeLayer(t,!0),this.fire("layerremove",{layer:t}),this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),t.off(this._childMarkerEventHandlers,this),this._featureGroup.hasLayer(t)&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow()),this):this:(!this._arraySplice(this._needsClustering,t)&&this.hasLayer(t)&&this._needsRemoving.push({layer:t,latlng:t._latlng}),this.fire("layerremove",{layer:t}),this):(this._nonPointGroup.removeLayer(t),this.fire("layerremove",{layer:t}),this)},addLayers:function(t,e){if(!L.Util.isArray(t))return this.addLayer(t);var n,s=this._featureGroup,l=this._nonPointGroup,i=this.options.chunkedLoading,a=this.options.chunkInterval,o=this.options.chunkProgress,r=t.length,u=0,d=!0;if(this._map){var c=(new Date).getTime(),h=L.bind(function(){for(var _=(new Date).getTime();r>u;u++){if(i&&0==u%200){if((new Date).getTime()-_>a)break}if((n=t[u])instanceof L.LayerGroup)d&&(t=t.slice(),d=!1),this._extractNonGroupLayers(n,t),r=t.length;else if(n.getLatLng){if(!this.hasLayer(n)&&(this._addLayer(n,this._maxZoom),e||this.fire("layeradd",{layer:n}),n.__parent&&2===n.__parent.getChildCount())){var p=n.__parent.getAllChildMarkers();s.removeLayer(p[0]===n?p[1]:p[0])}}else l.addLayer(n),e||this.fire("layeradd",{layer:n})}o&&o(u,r,(new Date).getTime()-c),u===r?(this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds)):setTimeout(h,this.options.chunkDelay)},this);h()}else for(var _=this._needsClustering;r>u;u++)(n=t[u])instanceof L.LayerGroup?(d&&(t=t.slice(),d=!1),this._extractNonGroupLayers(n,t),r=t.length):n.getLatLng?this.hasLayer(n)||_.push(n):l.addLayer(n);return this},removeLayers:function(t){var e,n,s=t.length,l=this._featureGroup,i=this._nonPointGroup,a=!0;if(!this._map){for(e=0;s>e;e++)(n=t[e])instanceof L.LayerGroup?(a&&(t=t.slice(),a=!1),this._extractNonGroupLayers(n,t),s=t.length):(this._arraySplice(this._needsClustering,n),i.removeLayer(n),this.hasLayer(n)&&this._needsRemoving.push({layer:n,latlng:n._latlng}),this.fire("layerremove",{layer:n}));return this}if(this._unspiderfy){this._unspiderfy();var o=t.slice(),r=s;for(e=0;r>e;e++)(n=o[e])instanceof L.LayerGroup?(this._extractNonGroupLayers(n,o),r=o.length):this._unspiderfyLayer(n)}for(e=0;s>e;e++)(n=t[e])instanceof L.LayerGroup?(a&&(t=t.slice(),a=!1),this._extractNonGroupLayers(n,t),s=t.length):n.__parent?(this._removeLayer(n,!0,!0),this.fire("layerremove",{layer:n}),l.hasLayer(n)&&(l.removeLayer(n),n.clusterShow&&n.clusterShow())):(i.removeLayer(n),this.fire("layerremove",{layer:n}));return this._topClusterLevel._recalculateBounds(),this._refreshClustersIcons(),this._topClusterLevel._recursivelyAddChildrenToMap(null,this._zoom,this._currentShownBounds),this},clearLayers:function(){return this._map||(this._needsClustering=[],delete this._gridClusters,delete this._gridUnclustered),this._noanimationUnspiderfy&&this._noanimationUnspiderfy(),this._featureGroup.clearLayers(),this._nonPointGroup.clearLayers(),this.eachLayer(function(t){t.off(this._childMarkerEventHandlers,this),delete t.__parent},this),this._map&&this._generateInitialClusters(),this},getBounds:function(){var t=new L.LatLngBounds;this._topClusterLevel&&t.extend(this._topClusterLevel._bounds);for(var e=this._needsClustering.length-1;e>=0;e--)t.extend(this._needsClustering[e].getLatLng());return t.extend(this._nonPointGroup.getBounds()),t},eachLayer:function(t,e){var n,s,l,i=this._needsClustering.slice(),a=this._needsRemoving;for(this._topClusterLevel&&this._topClusterLevel.getAllChildMarkers(i),s=i.length-1;s>=0;s--){for(n=!0,l=a.length-1;l>=0;l--)if(a[l].layer===i[s]){n=!1;break}n&&t.call(e,i[s])}this._nonPointGroup.eachLayer(t,e)},getLayers:function(){var t=[];return this.eachLayer(function(e){t.push(e)}),t},getLayer:function(t){var e=null;return t=parseInt(t,10),this.eachLayer(function(n){L.stamp(n)===t&&(e=n)}),e},hasLayer:function(t){if(!t)return!1;var e,n=this._needsClustering;for(e=n.length-1;e>=0;e--)if(n[e]===t)return!0;for(e=(n=this._needsRemoving).length-1;e>=0;e--)if(n[e].layer===t)return!1;return!(!t.__parent||t.__parent._group!==this)||this._nonPointGroup.hasLayer(t)},zoomToShowLayer:function(t,e){"function"!=typeof e&&(e=function(){});var n=function(){!t._icon&&!t.__parent._icon||this._inZoomAnimation||(this._map.off("moveend",n,this),this.off("animationend",n,this),t._icon?e():t.__parent._icon&&(this.once("spiderfied",e,this),t.__parent.spiderfy()))};t._icon&&this._map.getBounds().contains(t.getLatLng())?e():t.__parent._zoom<Math.round(this._map._zoom)?(this._map.on("moveend",n,this),this._map.panTo(t.getLatLng())):(this._map.on("moveend",n,this),this.on("animationend",n,this),t.__parent.zoomToBounds())},onAdd:function(t){this._map=t;var e,n,s;if(!isFinite(this._map.getMaxZoom()))throw"Map has no maxZoom specified";for(this._featureGroup.addTo(t),this._nonPointGroup.addTo(t),this._gridClusters||this._generateInitialClusters(),this._maxLat=t.options.crs.projection.MAX_LATITUDE,e=0,n=this._needsRemoving.length;n>e;e++)s=this._needsRemoving[e],s.newlatlng=s.layer._latlng,s.layer._latlng=s.latlng;for(e=0,n=this._needsRemoving.length;n>e;e++)s=this._needsRemoving[e],this._removeLayer(s.layer,!0),s.layer._latlng=s.newlatlng;this._needsRemoving=[],this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds(),this._map.on("zoomend",this._zoomEnd,this),this._map.on("moveend",this._moveEnd,this),this._spiderfierOnAdd&&this._spiderfierOnAdd(),this._bindEvents(),n=this._needsClustering,this._needsClustering=[],this.addLayers(n,!0)},onRemove:function(t){t.off("zoomend",this._zoomEnd,this),t.off("moveend",this._moveEnd,this),this._unbindEvents(),this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim",""),this._spiderfierOnRemove&&this._spiderfierOnRemove(),delete this._maxLat,this._hideCoverage(),this._featureGroup.remove(),this._nonPointGroup.remove(),this._featureGroup.clearLayers(),this._map=null},getVisibleParent:function(t){for(var e=t;e&&!e._icon;)e=e.__parent;return e||null},_arraySplice:function(t,e){for(var n=t.length-1;n>=0;n--)if(t[n]===e)return t.splice(n,1),!0},_removeFromGridUnclustered:function(t,e){for(var n=this._map,s=this._gridUnclustered,l=Math.floor(this._map.getMinZoom());e>=l&&s[e].removeObject(t,n.project(t.getLatLng(),e));e--);},_childMarkerDragStart:function(t){t.target.__dragStart=t.target._latlng},_childMarkerMoved:function(t){if(!this._ignoreMove&&!t.target.__dragStart){var e=t.target._popup&&t.target._popup.isOpen();this._moveChild(t.target,t.oldLatLng,t.latlng),e&&t.target.openPopup()}},_moveChild:function(t,e,n){t._latlng=e,this.removeLayer(t),t._latlng=n,this.addLayer(t)},_childMarkerDragEnd:function(t){t.target.__dragStart&&this._moveChild(t.target,t.target.__dragStart,t.target._latlng),delete t.target.__dragStart},_removeLayer:function(t,e,n){var s=this._gridClusters,l=this._gridUnclustered,i=this._featureGroup,a=this._map,o=Math.floor(this._map.getMinZoom());e&&this._removeFromGridUnclustered(t,this._maxZoom);var r,u=t.__parent;for(this._arraySplice(u._markers,t);u&&(u._childCount--,u._boundsNeedUpdate=!0,!(u._zoom<o));)e&&u._childCount<=1?(r=u._markers[0]===t?u._markers[1]:u._markers[0],s[u._zoom].removeObject(u,a.project(u._cLatLng,u._zoom)),l[u._zoom].addObject(r,a.project(r.getLatLng(),u._zoom)),this._arraySplice(u.__parent._childClusters,u),u.__parent._markers.push(r),r.__parent=u.__parent,u._icon&&(i.removeLayer(u),n||i.addLayer(r))):u._iconNeedsUpdate=!0,u=u.__parent;delete t.__parent},_isOrIsParent:function(t,e){for(;e;){if(t===e)return!0;e=e.parentNode}return!1},fire:function(t,e,n){if(e&&e.layer instanceof L.MarkerCluster){if(e.originalEvent&&this._isOrIsParent(e.layer._icon,e.originalEvent.relatedTarget))return;t="cluster"+t}L.FeatureGroup.prototype.fire.call(this,t,e,n)},listens:function(t,e){return L.FeatureGroup.prototype.listens.call(this,t,e)||L.FeatureGroup.prototype.listens.call(this,"cluster"+t,e)},_defaultIconCreateFunction:function(t){var e=t.getChildCount(),n=" marker-cluster-";return n+=10>e?"small":100>e?"medium":"large",new L.DivIcon({html:"<div><span>"+e+"</span></div>",className:"marker-cluster"+n,iconSize:new L.Point(40,40)})},_bindEvents:function(){var t=this._map,e=this.options.showCoverageOnHover;(this.options.spiderfyOnMaxZoom||this.options.zoomToBoundsOnClick)&&this.on("clusterclick",this._zoomOrSpiderfy,this),e&&(this.on("clustermouseover",this._showCoverage,this),this.on("clustermouseout",this._hideCoverage,this),t.on("zoomend",this._hideCoverage,this))},_zoomOrSpiderfy:function(t){for(var e=t.layer,n=e;1===n._childClusters.length;)n=n._childClusters[0];n._zoom===this._maxZoom&&n._childCount===e._childCount&&this.options.spiderfyOnMaxZoom?e.spiderfy():this.options.zoomToBoundsOnClick&&e.zoomToBounds(),t.originalEvent&&13===t.originalEvent.keyCode&&this._map._container.focus()},_showCoverage:function(t){var e=this._map;this._inZoomAnimation||(this._shownPolygon&&e.removeLayer(this._shownPolygon),t.layer.getChildCount()>2&&t.layer!==this._spiderfied&&(this._shownPolygon=new L.Polygon(t.layer.getConvexHull(),this.options.polygonOptions),e.addLayer(this._shownPolygon)))},_hideCoverage:function(){this._shownPolygon&&(this._map.removeLayer(this._shownPolygon),this._shownPolygon=null)},_unbindEvents:function(){var t=this.options.showCoverageOnHover,e=this._map;(this.options.spiderfyOnMaxZoom||this.options.zoomToBoundsOnClick)&&this.off("clusterclick",this._zoomOrSpiderfy,this),t&&(this.off("clustermouseover",this._showCoverage,this),this.off("clustermouseout",this._hideCoverage,this),e.off("zoomend",this._hideCoverage,this))},_zoomEnd:function(){this._map&&(this._mergeSplitClusters(),this._zoom=Math.round(this._map._zoom),this._currentShownBounds=this._getExpandedVisibleBounds())},_moveEnd:function(){if(!this._inZoomAnimation){var t=this._getExpandedVisibleBounds();this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,t),this._topClusterLevel._recursivelyAddChildrenToMap(null,Math.round(this._map._zoom),t),this._currentShownBounds=t}},_generateInitialClusters:function(){var t=Math.ceil(this._map.getMaxZoom()),e=Math.floor(this._map.getMinZoom()),n=this.options.maxClusterRadius,s=n;"function"!=typeof n&&(s=function(){return n}),null!==this.options.disableClusteringAtZoom&&(t=this.options.disableClusteringAtZoom-1),this._maxZoom=t,this._gridClusters={},this._gridUnclustered={};for(var l=t;l>=e;l--)this._gridClusters[l]=new L.DistanceGrid(s(l)),this._gridUnclustered[l]=new L.DistanceGrid(s(l));this._topClusterLevel=new this._markerCluster(this,e-1)},_addLayer:function(t,e){var n,s,l=this._gridClusters,i=this._gridUnclustered,a=Math.floor(this._map.getMinZoom());for(this.options.singleMarkerMode&&this._overrideMarkerIcon(t),t.on(this._childMarkerEventHandlers,this);e>=a;e--){n=this._map.project(t.getLatLng(),e);var o=l[e].getNearObject(n);if(o)return o._addChild(t),void(t.__parent=o);if(o=i[e].getNearObject(n)){var r=o.__parent;r&&this._removeLayer(o,!1);var u=new this._markerCluster(this,e,o,t);l[e].addObject(u,this._map.project(u._cLatLng,e)),o.__parent=u,t.__parent=u;var d=u;for(s=e-1;s>r._zoom;s--)d=new this._markerCluster(this,s,d),l[s].addObject(d,this._map.project(o.getLatLng(),s));return r._addChild(d),void this._removeFromGridUnclustered(o,e)}i[e].addObject(t,n)}this._topClusterLevel._addChild(t),t.__parent=this._topClusterLevel},_refreshClustersIcons:function(){this._featureGroup.eachLayer(function(t){t instanceof L.MarkerCluster&&t._iconNeedsUpdate&&t._updateIcon()})},_enqueue:function(t){this._queue.push(t),this._queueTimeout||(this._queueTimeout=setTimeout(L.bind(this._processQueue,this),300))},_processQueue:function(){for(var t=0;t<this._queue.length;t++)this._queue[t].call(this);this._queue.length=0,clearTimeout(this._queueTimeout),this._queueTimeout=null},_mergeSplitClusters:function(){var t=Math.round(this._map._zoom);this._processQueue(),this._zoom<t&&this._currentShownBounds.intersects(this._getExpandedVisibleBounds())?(this._animationStart(),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),this._zoom,this._getExpandedVisibleBounds()),this._animationZoomIn(this._zoom,t)):this._zoom>t?(this._animationStart(),this._animationZoomOut(this._zoom,t)):this._moveEnd()},_getExpandedVisibleBounds:function(){return this.options.removeOutsideVisibleBounds?L.Browser.mobile?this._checkBoundsMaxLat(this._map.getBounds()):this._checkBoundsMaxLat(this._map.getBounds().pad(1)):this._mapBoundsInfinite},_checkBoundsMaxLat:function(t){var e=this._maxLat;return void 0!==e&&(t.getNorth()>=e&&(t._northEast.lat=1/0),t.getSouth()<=-e&&(t._southWest.lat=-1/0)),t},_animationAddLayerNonAnimated:function(t,e){if(e===t)this._featureGroup.addLayer(t);else if(2===e._childCount){e._addToMap();var n=e.getAllChildMarkers();this._featureGroup.removeLayer(n[0]),this._featureGroup.removeLayer(n[1])}else e._updateIcon()},_extractNonGroupLayers:function(t,e){var n,s=t.getLayers(),l=0;for(e=e||[];l<s.length;l++)(n=s[l])instanceof L.LayerGroup?this._extractNonGroupLayers(n,e):e.push(n);return e},_overrideMarkerIcon:function(t){return t.options.icon=this.options.iconCreateFunction({getChildCount:function(){return 1},getAllChildMarkers:function(){return[t]}})}}),L.MarkerClusterGroup.include({_mapBoundsInfinite:new L.LatLngBounds(new L.LatLng(-1/0,-1/0),new L.LatLng(1/0,1/0))}),L.MarkerClusterGroup.include({_noAnimation:{_animationStart:function(){},_animationZoomIn:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationZoomOut:function(t,e){this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this.fire("animationend")},_animationAddLayer:function(t,e){this._animationAddLayerNonAnimated(t,e)}},_withAnimation:{_animationStart:function(){this._map._mapPane.className+=" leaflet-cluster-anim",this._inZoomAnimation++},_animationZoomIn:function(t,e){var n,s=this._getExpandedVisibleBounds(),l=this._featureGroup,i=Math.floor(this._map.getMinZoom());this._ignoreMove=!0,this._topClusterLevel._recursively(s,t,i,function(i){var a,o=i._latlng,r=i._markers;for(s.contains(o)||(o=null),i._isSingleParent()&&t+1===e?(l.removeLayer(i),i._recursivelyAddChildrenToMap(null,e,s)):(i.clusterHide(),i._recursivelyAddChildrenToMap(o,e,s)),n=r.length-1;n>=0;n--)a=r[n],s.contains(a._latlng)||l.removeLayer(a)}),this._forceLayout(),this._topClusterLevel._recursivelyBecomeVisible(s,e),l.eachLayer(function(t){t instanceof L.MarkerCluster||!t._icon||t.clusterShow()}),this._topClusterLevel._recursively(s,t,e,function(t){t._recursivelyRestoreChildPositions(e)}),this._ignoreMove=!1,this._enqueue(function(){this._topClusterLevel._recursively(s,t,i,function(t){l.removeLayer(t),t.clusterShow()}),this._animationEnd()})},_animationZoomOut:function(t,e){this._animationZoomOutSingle(this._topClusterLevel,t-1,e),this._topClusterLevel._recursivelyAddChildrenToMap(null,e,this._getExpandedVisibleBounds()),this._topClusterLevel._recursivelyRemoveChildrenFromMap(this._currentShownBounds,Math.floor(this._map.getMinZoom()),t,this._getExpandedVisibleBounds())},_animationAddLayer:function(t,e){var n=this,s=this._featureGroup;s.addLayer(t),e!==t&&(e._childCount>2?(e._updateIcon(),this._forceLayout(),this._animationStart(),t._setPos(this._map.latLngToLayerPoint(e.getLatLng())),t.clusterHide(),this._enqueue(function(){s.removeLayer(t),t.clusterShow(),n._animationEnd()})):(this._forceLayout(),n._animationStart(),n._animationZoomOutSingle(e,this._map.getMaxZoom(),this._zoom)))}},_animationZoomOutSingle:function(t,e,n){var s=this._getExpandedVisibleBounds(),l=Math.floor(this._map.getMinZoom());t._recursivelyAnimateChildrenInAndAddSelfToMap(s,l,e+1,n);var i=this;this._forceLayout(),t._recursivelyBecomeVisible(s,n),this._enqueue(function(){if(1===t._childCount){var a=t._markers[0];this._ignoreMove=!0,a.setLatLng(a.getLatLng()),this._ignoreMove=!1,a.clusterShow&&a.clusterShow()}else t._recursively(s,n,l,function(t){t._recursivelyRemoveChildrenFromMap(s,l,e+1)});i._animationEnd()})},_animationEnd:function(){this._map&&(this._map._mapPane.className=this._map._mapPane.className.replace(" leaflet-cluster-anim","")),this._inZoomAnimation--,this.fire("animationend")},_forceLayout:function(){L.Util.falseFn(e.body.offsetWidth)}}),L.markerClusterGroup=function(t){return new L.MarkerClusterGroup(t)},L.MarkerCluster=L.Marker.extend({initialize:function(t,e,n,s){L.Marker.prototype.initialize.call(this,n?n._cLatLng||n.getLatLng():new L.LatLng(0,0),{icon:this,pane:t.options.clusterPane}),this._group=t,this._zoom=e,this._markers=[],this._childClusters=[],this._childCount=0,this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._bounds=new L.LatLngBounds,n&&this._addChild(n),s&&this._addChild(s)},getAllChildMarkers:function(t){t=t||[];for(var e=this._childClusters.length-1;e>=0;e--)this._childClusters[e].getAllChildMarkers(t);for(var n=this._markers.length-1;n>=0;n--)t.push(this._markers[n]);return t},getChildCount:function(){return this._childCount},zoomToBounds:function(t){for(var e,n=this._childClusters.slice(),s=this._group._map,l=s.getBoundsZoom(this._bounds),i=this._zoom+1,a=s.getZoom();n.length>0&&l>i;){i++;var o=[];for(e=0;e<n.length;e++)o=o.concat(n[e]._childClusters);n=o}l>i?this._group._map.setView(this._latlng,i):a>=l?this._group._map.setView(this._latlng,a+1):this._group._map.fitBounds(this._bounds,t)},getBounds:function(){var t=new L.LatLngBounds;return t.extend(this._bounds),t},_updateIcon:function(){this._iconNeedsUpdate=!0,this._icon&&this.setIcon(this)},createIcon:function(){return this._iconNeedsUpdate&&(this._iconObj=this._group.options.iconCreateFunction(this),this._iconNeedsUpdate=!1),this._iconObj.createIcon()},createShadow:function(){return this._iconObj.createShadow()},_addChild:function(t,e){this._iconNeedsUpdate=!0,this._boundsNeedUpdate=!0,this._setClusterCenter(t),t instanceof L.MarkerCluster?(e||(this._childClusters.push(t),t.__parent=this),this._childCount+=t._childCount):(e||this._markers.push(t),this._childCount++),this.__parent&&this.__parent._addChild(t,!0)},_setClusterCenter:function(t){this._cLatLng||(this._cLatLng=t._cLatLng||t._latlng)},_resetBounds:function(){var t=this._bounds;t._southWest&&(t._southWest.lat=1/0,t._southWest.lng=1/0),t._northEast&&(t._northEast.lat=-1/0,t._northEast.lng=-1/0)},_recalculateBounds:function(){var t,e,n,s,l=this._markers,i=this._childClusters,a=0,o=0,r=this._childCount;if(0!==r){for(this._resetBounds(),t=0;t<l.length;t++)n=l[t]._latlng,this._bounds.extend(n),a+=n.lat,o+=n.lng;for(t=0;t<i.length;t++)(e=i[t])._boundsNeedUpdate&&e._recalculateBounds(),this._bounds.extend(e._bounds),n=e._wLatLng,s=e._childCount,a+=n.lat*s,o+=n.lng*s;this._latlng=this._wLatLng=new L.LatLng(a/r,o/r),this._boundsNeedUpdate=!1}},_addToMap:function(t){t&&(this._backupLatlng=this._latlng,this.setLatLng(t)),this._group._featureGroup.addLayer(this)},_recursivelyAnimateChildrenIn:function(t,e,n){this._recursively(t,this._group._map.getMinZoom(),n-1,function(t){var n,s,l=t._markers;for(n=l.length-1;n>=0;n--)(s=l[n])._icon&&(s._setPos(e),s.clusterHide())},function(t){var n,s,l=t._childClusters;for(n=l.length-1;n>=0;n--)(s=l[n])._icon&&(s._setPos(e),s.clusterHide())})},_recursivelyAnimateChildrenInAndAddSelfToMap:function(t,e,n,s){this._recursively(t,s,e,function(l){l._recursivelyAnimateChildrenIn(t,l._group._map.latLngToLayerPoint(l.getLatLng()).round(),n),l._isSingleParent()&&n-1===s?(l.clusterShow(),l._recursivelyRemoveChildrenFromMap(t,e,n)):l.clusterHide(),l._addToMap()})},_recursivelyBecomeVisible:function(t,e){this._recursively(t,this._group._map.getMinZoom(),e,null,function(t){t.clusterShow()})},_recursivelyAddChildrenToMap:function(t,e,n){this._recursively(n,this._group._map.getMinZoom()-1,e,function(s){if(e!==s._zoom)for(var l=s._markers.length-1;l>=0;l--){var i=s._markers[l];n.contains(i._latlng)&&(t&&(i._backupLatlng=i.getLatLng(),i.setLatLng(t),i.clusterHide&&i.clusterHide()),s._group._featureGroup.addLayer(i))}},function(e){e._addToMap(t)})},_recursivelyRestoreChildPositions:function(t){for(var e=this._markers.length-1;e>=0;e--){var n=this._markers[e];n._backupLatlng&&(n.setLatLng(n._backupLatlng),delete n._backupLatlng)}if(t-1===this._zoom)for(var s=this._childClusters.length-1;s>=0;s--)this._childClusters[s]._restorePosition();else for(var l=this._childClusters.length-1;l>=0;l--)this._childClusters[l]._recursivelyRestoreChildPositions(t)},_restorePosition:function(){this._backupLatlng&&(this.setLatLng(this._backupLatlng),delete this._backupLatlng)},_recursivelyRemoveChildrenFromMap:function(t,e,n,s){var l,i;this._recursively(t,e-1,n-1,function(t){for(i=t._markers.length-1;i>=0;i--)l=t._markers[i],s&&s.contains(l._latlng)||(t._group._featureGroup.removeLayer(l),l.clusterShow&&l.clusterShow())},function(t){for(i=t._childClusters.length-1;i>=0;i--)l=t._childClusters[i],s&&s.contains(l._latlng)||(t._group._featureGroup.removeLayer(l),l.clusterShow&&l.clusterShow())})},_recursively:function(t,e,n,s,l){var i,a,o=this._childClusters,r=this._zoom;if(r>=e&&(s&&s(this),l&&r===n&&l(this)),e>r||n>r)for(i=o.length-1;i>=0;i--)a=o[i],t.intersects(a._bounds)&&a._recursively(t,e,n,s,l)},_isSingleParent:function(){return this._childClusters.length>0&&this._childClusters[0]._childCount===this._childCount}}),L.Marker.include({clusterHide:function(){return this.options.opacityWhenUnclustered=this.options.opacity||1,this.setOpacity(0)},clusterShow:function(){var t=this.setOpacity(this.options.opacity||this.options.opacityWhenUnclustered);return delete this.options.opacityWhenUnclustered,t}}),L.DistanceGrid=function(t){this._cellSize=t,this._sqCellSize=t*t,this._grid={},this._objectPoint={}},L.DistanceGrid.prototype={addObject:function(t,e){var n=this._getCoord(e.x),s=this._getCoord(e.y),l=this._grid,i=l[s]=l[s]||{},a=i[n]=i[n]||[],o=L.Util.stamp(t);this._objectPoint[o]=e,a.push(t)},updateObject:function(t,e){this.removeObject(t),this.addObject(t,e)},removeObject:function(t,e){var n,s,l=this._getCoord(e.x),i=this._getCoord(e.y),a=this._grid,o=a[i]=a[i]||{},r=o[l]=o[l]||[];for(delete this._objectPoint[L.Util.stamp(t)],n=0,s=r.length;s>n;n++)if(r[n]===t)return r.splice(n,1),1===s&&delete o[l],!0},eachObject:function(t,e){var n,s,l,i,a,o,r=this._grid;for(n in r){a=r[n];for(s in a)for(o=a[s],l=0,i=o.length;i>l;l++)t.call(e,o[l])&&(l--,i--)}},getNearObject:function(t){var e,n,s,l,i,a,o,r,u=this._getCoord(t.x),d=this._getCoord(t.y),c=this._objectPoint,h=this._sqCellSize,_=null;for(e=d-1;d+1>=e;e++)if(l=this._grid[e])for(n=u-1;u+1>=n;n++)if(i=l[n])for(s=0,a=i.length;a>s;s++)o=i[s],r=this._sqDist(c[L.Util.stamp(o)],t),h>r&&(h=r,_=o);return _},_getCoord:function(t){return Math.floor(t/this._cellSize)},_sqDist:function(t,e){var n=e.x-t.x,s=e.y-t.y;return n*n+s*s}},L.QuickHull={getDistant:function(t,e){return(e[0].lng-e[1].lng)*(t.lat-e[0].lat)+(e[1].lat-e[0].lat)*(t.lng-e[0].lng)},findMostDistantPointFromBaseLine:function(t,e){var n,s,l,i=0,a=null,o=[];for(n=e.length-1;n>=0;n--)s=e[n],(l=this.getDistant(s,t))>0&&(o.push(s),l>i&&(i=l,a=s));return{maxPoint:a,newPoints:o}},buildConvexHull:function(t,e){var n=[],s=this.findMostDistantPointFromBaseLine(t,e);return s.maxPoint?(n=n.concat(this.buildConvexHull([t[0],s.maxPoint],s.newPoints)),n=n.concat(this.buildConvexHull([s.maxPoint,t[1]],s.newPoints))):[t[0]]},getConvexHull:function(t){var e,n=!1,s=!1,l=!1,i=!1,a=null,o=null,r=null,u=null,d=null,c=null;for(e=t.length-1;e>=0;e--){var h=t[e];(!1===n||h.lat>n)&&(a=h,n=h.lat),(!1===s||h.lat<s)&&(o=h,s=h.lat),(!1===l||h.lng>l)&&(r=h,l=h.lng),(!1===i||h.lng<i)&&(u=h,i=h.lng)}s!==n?(c=o,d=a):(c=u,d=r);return[].concat(this.buildConvexHull([c,d],t),this.buildConvexHull([d,c],t))}},L.MarkerCluster.include({getConvexHull:function(){var t,e,n=this.getAllChildMarkers(),s=[];for(e=n.length-1;e>=0;e--)t=n[e].getLatLng(),s.push(t);return L.QuickHull.getConvexHull(s)}}),L.MarkerCluster.include({_2PI:2*Math.PI,_circleFootSeparation:25,_circleStartAngle:Math.PI/6,_spiralFootSeparation:28,_spiralLengthStart:11,_spiralLengthFactor:5,_circleSpiralSwitchover:9,spiderfy:function(){if(this._group._spiderfied!==this&&!this._group._inZoomAnimation){var t,e=this.getAllChildMarkers(),n=this._group._map.latLngToLayerPoint(this._latlng);this._group._unspiderfy(),this._group._spiderfied=this,e.length>=this._circleSpiralSwitchover?t=this._generatePointsSpiral(e.length,n):(n.y+=10,t=this._generatePointsCircle(e.length,n)),this._animationSpiderfy(e,t)}},unspiderfy:function(t){this._group._inZoomAnimation||(this._animationUnspiderfy(t),this._group._spiderfied=null)},_generatePointsCircle:function(t,e){var n,s,l=this._group.options.spiderfyDistanceMultiplier*this._circleFootSeparation*(2+t)/this._2PI,i=this._2PI/t,a=[];for(a.length=t,n=t-1;n>=0;n--)s=this._circleStartAngle+n*i,a[n]=new L.Point(e.x+l*Math.cos(s),e.y+l*Math.sin(s))._round();return a},_generatePointsSpiral:function(t,e){var n,s=this._group.options.spiderfyDistanceMultiplier,l=s*this._spiralLengthStart,i=s*this._spiralFootSeparation,a=s*this._spiralLengthFactor*this._2PI,o=0,r=[];for(r.length=t,n=t-1;n>=0;n--)o+=i/l+5e-4*n,r[n]=new L.Point(e.x+l*Math.cos(o),e.y+l*Math.sin(o))._round(),l+=a/o;return r},_noanimationUnspiderfy:function(){var t,e,n=this._group,s=n._map,l=n._featureGroup,i=this.getAllChildMarkers();for(n._ignoreMove=!0,this.setOpacity(1),e=i.length-1;e>=0;e--)t=i[e],l.removeLayer(t),t._preSpiderfyLatlng&&(t.setLatLng(t._preSpiderfyLatlng),delete t._preSpiderfyLatlng),t.setZIndexOffset&&t.setZIndexOffset(0),t._spiderLeg&&(s.removeLayer(t._spiderLeg),delete t._spiderLeg);n.fire("unspiderfied",{cluster:this,markers:i}),n._ignoreMove=!1,n._spiderfied=null}}),L.MarkerClusterNonAnimated=L.MarkerCluster.extend({_animationSpiderfy:function(t,e){var n,s,l,i,a=this._group,o=a._map,r=a._featureGroup,u=this._group.options.spiderLegPolylineOptions;for(a._ignoreMove=!0,n=0;n<t.length;n++)i=o.layerPointToLatLng(e[n]),s=t[n],l=new L.Polyline([this._latlng,i],u),o.addLayer(l),s._spiderLeg=l,s._preSpiderfyLatlng=s._latlng,s.setLatLng(i),s.setZIndexOffset&&s.setZIndexOffset(1e6),r.addLayer(s);this.setOpacity(.3),a._ignoreMove=!1,a.fire("spiderfied",{cluster:this,markers:t})},_animationUnspiderfy:function(){this._noanimationUnspiderfy()}}),L.MarkerCluster.include({_animationSpiderfy:function(t,e){var n,s,l,i,a,o,r=this,u=this._group,d=u._map,c=u._featureGroup,h=this._latlng,_=d.latLngToLayerPoint(h),p=L.Path.SVG,f=L.extend({},this._group.options.spiderLegPolylineOptions),k=f.opacity;for(void 0===k&&(k=L.MarkerClusterGroup.prototype.options.spiderLegPolylineOptions.opacity),p?(f.opacity=0,f.className=(f.className||"")+" leaflet-cluster-spider-leg"):f.opacity=k,u._ignoreMove=!0,n=0;n<t.length;n++)s=t[n],o=d.layerPointToLatLng(e[n]),l=new L.Polyline([h,o],f),d.addLayer(l),s._spiderLeg=l,p&&(i=l._path,a=i.getTotalLength()+.1,i.style.strokeDasharray=a,i.style.strokeDashoffset=a),s.setZIndexOffset&&s.setZIndexOffset(1e6),s.clusterHide&&s.clusterHide(),c.addLayer(s),s._setPos&&s._setPos(_);for(u._forceLayout(),u._animationStart(),n=t.length-1;n>=0;n--)o=d.layerPointToLatLng(e[n]),s=t[n],s._preSpiderfyLatlng=s._latlng,s.setLatLng(o),s.clusterShow&&s.clusterShow(),p&&(l=s._spiderLeg,i=l._path,i.style.strokeDashoffset=0,l.setStyle({opacity:k}));this.setOpacity(.3),u._ignoreMove=!1,setTimeout(function(){u._animationEnd(),u.fire("spiderfied",{cluster:r,markers:t})},200)},_animationUnspiderfy:function(t){var e,n,s,l,i,a,o=this,r=this._group,u=r._map,d=r._featureGroup,c=t?u._latLngToNewLayerPoint(this._latlng,t.zoom,t.center):u.latLngToLayerPoint(this._latlng),h=this.getAllChildMarkers(),_=L.Path.SVG;for(r._ignoreMove=!0,r._animationStart(),this.setOpacity(1),n=h.length-1;n>=0;n--)(e=h[n])._preSpiderfyLatlng&&(e.closePopup(),e.setLatLng(e._preSpiderfyLatlng),delete e._preSpiderfyLatlng,a=!0,e._setPos&&(e._setPos(c),a=!1),e.clusterHide&&(e.clusterHide(),a=!1),a&&d.removeLayer(e),_&&(s=e._spiderLeg,l=s._path,i=l.getTotalLength()+.1,l.style.strokeDashoffset=i,s.setStyle({opacity:0})));r._ignoreMove=!1,setTimeout(function(){var t=0;for(n=h.length-1;n>=0;n--)(e=h[n])._spiderLeg&&t++;for(n=h.length-1;n>=0;n--)(e=h[n])._spiderLeg&&(e.clusterShow&&e.clusterShow(),e.setZIndexOffset&&e.setZIndexOffset(0),t>1&&d.removeLayer(e),u.removeLayer(e._spiderLeg),delete e._spiderLeg);r._animationEnd(),r.fire("unspiderfied",{cluster:o,markers:h})},200)}}),L.MarkerClusterGroup.include({_spiderfied:null,unspiderfy:function(){this._unspiderfy.apply(this,arguments)},_spiderfierOnAdd:function(){this._map.on("click",this._unspiderfyWrapper,this),this._map.options.zoomAnimation&&this._map.on("zoomstart",this._unspiderfyZoomStart,this),this._map.on("zoomend",this._noanimationUnspiderfy,this),L.Browser.touch||this._map.getRenderer(this)},_spiderfierOnRemove:function(){this._map.off("click",this._unspiderfyWrapper,this),this._map.off("zoomstart",this._unspiderfyZoomStart,this),this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._map.off("zoomend",this._noanimationUnspiderfy,this),this._noanimationUnspiderfy()},_unspiderfyZoomStart:function(){this._map&&this._map.on("zoomanim",this._unspiderfyZoomAnim,this)},_unspiderfyZoomAnim:function(t){L.DomUtil.hasClass(this._map._mapPane,"leaflet-touching")||(this._map.off("zoomanim",this._unspiderfyZoomAnim,this),this._unspiderfy(t))},_unspiderfyWrapper:function(){this._unspiderfy()},_unspiderfy:function(t){this._spiderfied&&this._spiderfied.unspiderfy(t)},_noanimationUnspiderfy:function(){this._spiderfied&&this._spiderfied._noanimationUnspiderfy()},_unspiderfyLayer:function(t){t._spiderLeg&&(this._featureGroup.removeLayer(t),t.clusterShow&&t.clusterShow(),t.setZIndexOffset&&t.setZIndexOffset(0),this._map.removeLayer(t._spiderLeg),delete t._spiderLeg)}}),L.MarkerClusterGroup.include({refreshClusters:function(t){return t?t instanceof L.MarkerClusterGroup?t=t._topClusterLevel.getAllChildMarkers():t instanceof L.LayerGroup?t=t._layers:t instanceof L.MarkerCluster?t=t.getAllChildMarkers():t instanceof L.Marker&&(t=[t]):t=this._topClusterLevel.getAllChildMarkers(),this._flagParentsIconsNeedUpdate(t),this._refreshClustersIcons(),this.options.singleMarkerMode&&this._refreshSingleMarkerModeMarkers(t),this},_flagParentsIconsNeedUpdate:function(t){var e,n;for(e in t)for(n=t[e].__parent;n;)n._iconNeedsUpdate=!0,n=n.__parent},_refreshSingleMarkerModeMarkers:function(t){var e,n;for(e in t)n=t[e],this.hasLayer(n)&&n.setIcon(this._overrideMarkerIcon(n))}}),L.Marker.include({refreshIconOptions:function(t,e){var n=this.options.icon;return L.setOptions(n,t),this.setIcon(n),e&&this.__parent&&this.__parent._group.refreshClusters(this),this}})}(window,document)},938:function(t,e,n){"use strict";var s,l,i;!function(a){l=[n(939),n(940)],void 0===(i="function"==typeof(s=a)?s.apply(e,l):s)||(t.exports=i)}(function(t,e){})},939:function(t,e,n){"use strict";var s,l,i;!function(a,o){l=[n(138)],void 0===(i="function"==typeof(s=a)?s.apply(e,l):s)||(t.exports=i)}(function(t){t.TileLayer.Offline=t.TileLayer.extend({initialize:function(e,n,s){this._url=e,this._tilesDb=n,(s=t.Util.setOptions(this,s)).detectRetina&&t.Browser.retina&&s.maxZoom>0&&(s.tileSize=Math.floor(s.tileSize/2),s.zoomReverse?(s.zoomOffset--,s.minZoom++):(s.zoomOffset++,s.maxZoom--),s.minZoom=Math.max(0,s.minZoom)),"string"==typeof s.subdomains&&(s.subdomains=s.subdomains.split("")),t.Browser.android||this.on("tileunload",this._onTileRemove)},createTile:function(e,n){var s=document.createElement("img");return t.DomEvent.on(s,"load",t.bind(this._tileOnLoad,this,n,s)),t.DomEvent.on(s,"error",t.bind(this._tileOnError,this,n,s)),this.options.crossOrigin&&(s.crossOrigin=""),s.alt="",s.setAttribute("role","presentation"),this.getTileUrl(e).then(function(t){s.src=t}).catch(function(t){throw t}),s},getTileUrl:function(e){var n=t.TileLayer.prototype.getTileUrl.call(this,e),s=this._getStorageKey(n);return this._tilesDb.getItem(s).then(function(t){return t&&"object"==typeof t?URL.createObjectURL(t):n}).catch(function(t){throw t})},getTileUrls:function(e,n){var s=[],l=this._url;this.setUrl(this._url.replace("{z}",n),!0);for(var i=t.bounds(e.min.divideBy(this.getTileSize().x).floor(),e.max.divideBy(this.getTileSize().x).floor()),a=i.min.x;a<=i.max.x;a++)for(var o=i.min.y;o<=i.max.y;o++){var r=new t.Point(a,o),u=t.TileLayer.prototype.getTileUrl.call(this,r);s.push({key:this._getStorageKey(u),url:u})}return this.setUrl(l,!0),s},_getStorageKey:function(t){var e=null;if(t.indexOf("{s}")){var n=new RegExp("["+this.options.subdomains.join("|")+"].");e=t.replace(n,this.options.subdomains[0]+".")}return e||t}}),t.tileLayer.offline=function(e,n,s){return new t.TileLayer.Offline(e,n,s)}},window)},940:function(t,e,n){"use strict";var s,l,i;!function(a,o){l=[n(138)],void 0===(i="function"==typeof(s=a)?s.apply(e,l):s)||(t.exports=i)}(function(t){t.Control.Offline=t.Control.extend({options:{position:"topleft",saveButtonHtml:"S",saveButtonTitle:"Save tiles",removeButtonHtml:"R",removeButtonTitle:"Remove tiles",minZoom:0,maxZoom:19,confirmSavingCallback:null,confirmRemovalCallback:null},initialize:function(e,n,s){this._baseLayer=e,this._tilesDb=n,t.Util.setOptions(this,s)},onAdd:function(e){var n=t.DomUtil.create("div","leaflet-control-offline leaflet-bar");return this._createButton(this.options.saveButtonHtml,this.options.saveButtonTitle,"save-tiles-button",n,this._saveTiles),this._createButton(this.options.removeButtonHtml,this.options.removeButtonTitle,"remove-tiles-button",n,this._removeTiles),n},_createButton:function(e,n,s,l,i){var a=t.DomUtil.create("a",s,l);return a.innerHTML=e,a.href="#",a.title=n,t.DomEvent.disableClickPropagation(a),t.DomEvent.on(a,"click",t.DomEvent.stop),t.DomEvent.on(a,"click",i,this),t.DomEvent.on(a,"click",this._refocusOnMap,this),a},_saveTiles:function(){var e=this,n=null,s=[],l=[],i=this._map.getZoom(),a=this._map.getBounds();if(i<this.options.minZoom)e._baseLayer.fire("offline:below-min-zoom-error");else{for(var o=i;o<=this.options.maxZoom;o++)s.push(o);for(var r=0;r<s.length;r++)n=t.bounds(this._map.project(a.getNorthWest(),s[r]),this._map.project(a.getSouthEast(),s[r])),l=l.concat(this._baseLayer.getTileUrls(n,s[r]));var u=function(){e._baseLayer.fire("offline:save-start",{nTilesToSave:l.length}),e._tilesDb.saveTiles(l).then(function(){e._baseLayer.fire("offline:save-end")}).catch(function(t){e._baseLayer.fire("offline:save-error",{error:t})})};this.options.confirmSavingCallback?this.options.confirmSavingCallback(l.length,u):u()}},_removeTiles:function(){var t=this,e=function(){t._baseLayer.fire("offline:remove-start"),t._tilesDb.clear().then(function(){t._baseLayer.fire("offline:remove-end")}).catch(function(e){t._baseLayer.fire("offline:remove-error",{error:e})})};t.options.confirmRemovalCallback?t.options.confirmRemovalCallback(e):e()}}),t.control.offline=function(e,n,s){return new t.Control.Offline(e,n,s)}},window)},941:function(t,e){!function(){var t=L.Marker.prototype._initIcon,e=L.Marker.prototype._setPos,n="msTransform"===L.DomUtil.TRANSFORM;L.Marker.addInitHook(function(){var t=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;t&&(t=t[0]+"px "+t[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||t||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(t){t.target._applyRotation()})}),L.Marker.include({_initIcon:function(){t.call(this)},_setPos:function(t){e.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,n?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}})}()},942:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return TaskDetail});var __WEBPACK_IMPORTED_MODULE_0_tslib__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_1__angular_core__=__webpack_require__(1),__WEBPACK_IMPORTED_MODULE_2_ionic_angular__=__webpack_require__(17),__WEBPACK_IMPORTED_MODULE_3__services_orm_service__=__webpack_require__(37),__WEBPACK_IMPORTED_MODULE_4_ionic_angular_components_modal_modal_controller__=__webpack_require__(48),__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__=__webpack_require__(280),__WEBPACK_IMPORTED_MODULE_6__app_app_component__=__webpack_require__(140),__WEBPACK_IMPORTED_MODULE_7__task_detail_map__=__webpack_require__(945),__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__=__webpack_require__(149),__WEBPACK_IMPORTED_MODULE_9_leaflet__=__webpack_require__(138),__WEBPACK_IMPORTED_MODULE_9_leaflet___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_9_leaflet__),__WEBPACK_IMPORTED_MODULE_10_leaflet_geometryutil__=__webpack_require__(616),__WEBPACK_IMPORTED_MODULE_10_leaflet_geometryutil___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_10_leaflet_geometryutil__),__WEBPACK_IMPORTED_MODULE_11__services_modals_service__=__webpack_require__(53),__WEBPACK_IMPORTED_MODULE_12__services_gps_service__=__webpack_require__(108),__WEBPACK_IMPORTED_MODULE_13_rxjs_Subscription__=__webpack_require__(30),__WEBPACK_IMPORTED_MODULE_13_rxjs_Subscription___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_13_rxjs_Subscription__),__WEBPACK_IMPORTED_MODULE_14__services_chat_and_session_service__=__webpack_require__(60),__WEBPACK_IMPORTED_MODULE_15__ionic_native_photo_viewer__=__webpack_require__(76),__WEBPACK_IMPORTED_MODULE_16__classes_Helper__=__webpack_require__(28),__WEBPACK_IMPORTED_MODULE_17__ionic_native_spinner_dialog__=__webpack_require__(55),__WEBPACK_IMPORTED_MODULE_18__services_images_service__=__webpack_require__(41),__WEBPACK_IMPORTED_MODULE_19_js_levenshtein__=__webpack_require__(946),__WEBPACK_IMPORTED_MODULE_19_js_levenshtein___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_19_js_levenshtein__),__awaiter=this&&this.__awaiter||function(t,e,n,s){return new(n||(n=Promise))(function(l,i){function a(t){try{r(s.next(t))}catch(t){i(t)}}function o(t){try{r(s.throw(t))}catch(t){i(t)}}function r(t){t.done?l(t.value):new n(function(e){e(t.value)}).then(a,o)}r((s=s.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function n(n){return function(a){return function(n){if(s)throw new TypeError("Generator is already executing.");for(;o;)try{if(s=1,l&&(i=l[2&n[0]?"return":n[0]?"throw":"next"])&&!(i=i.call(l,n[1])).done)return i;switch(l=0,i&&(n=[0,i.value]),n[0]){case 0:case 1:i=n;break;case 4:return o.label++,{value:n[1],done:!1};case 5:o.label++,l=n[1],n=[0];continue;case 7:n=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!(i=i.length>0&&i[i.length-1])&&(6===n[0]||2===n[0])){o=0;continue}if(3===n[0]&&(!i||n[1]>i[0]&&n[1]<i[3])){o.label=n[1];break}if(6===n[0]&&o.label<i[1]){o.label=i[1],i=n;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(n);break}i[2]&&o.ops.pop(),o.trys.pop();continue}n=e.call(t,o)}catch(t){n=[6,t],l=0}finally{s=i=0}if(5&n[0])throw n[1];return{value:n[0]?n[1]:void 0,done:!0}}([n,a])}}var s,l,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:n(0),throw:n(1),return:n(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},trim=__WEBPACK_IMPORTED_MODULE_9_leaflet__.Util.trim,TaskDetail=function(){function TaskDetail(t,e,n,s,l,i,a,o,r,u,d,c){this.navCtrl=t,this.navParams=e,this.ormService=n,this.modalCtrl=s,this.deepLinker=l,this.modalsService=i,this.gpsService=a,this.chatAndSessionService=o,this.app=r,this.photoViewer=u,this.spinnerDialog=d,this.imageService=c,this.solvedSubtasks=[],this.activeAccordions=[],this.subTaskScore=0,this.gamificationIsDisabled=!1,this.answerIndex=null,this.blankRegex=/\*\*([^*]+)\*\*/g,this.multipleChoiceList=[],this.gpsTaskButtonLabels=[],this.shownHints=[],this.subTaskModalShown=!1,this.keyboardSubscriptions=new __WEBPACK_IMPORTED_MODULE_13_rxjs_Subscription__.Subscription}return TaskDetail_1=TaskDetail,TaskDetail.prototype.subscribeCKEvents=function(){var t=this;this.keyboardSubscriptions=new __WEBPACK_IMPORTED_MODULE_13_rxjs_Subscription__.Subscription,this.keyboardSubscriptions.add(__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.onCKClick.subscribe(function(e){(0!=t.taskDetails.timeSolved||t.taskDetails.failed)&&t.route.isAnswerFeedbackEnabled()||("C"===e?null!=t.answerIndex?t.taskDetails.answerMultipleChoice[t.answerIndex].answer="":t.taskDetails.answer="":"✔"===e?t.checkResult():null!=t.answerIndex?t.taskDetails.answerMultipleChoice[t.answerIndex].answer+=e:t.taskDetails.answer+=e)},function(t){console.log(t)},function(){console.log("onCKClick subscribed.")})),this.keyboardSubscriptions.add(__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.onDeleteClick.subscribe(function(){null!=t.answerIndex?t.taskDetails.answerMultipleChoice[t.answerIndex].answer=t.taskDetails.answerMultipleChoice[t.answerIndex].answer.slice(0,t.taskDetails.answerMultipleChoice[t.answerIndex].answer.length-1):t.taskDetails.answer=t.taskDetails.answer.slice(0,t.taskDetails.answer.length-1)},function(t){console.log(t)},function(){console.log("onDeleteClick subscribed.")})),this.keyboardSubscriptions.add(__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.onCKHide.subscribe(function(){t.setKeyboardOn(!1)},function(t){console.log(t)},function(){console.log("onCKHide subscribed.")}))},TaskDetail.prototype.unsubscribeCKEvents=function(){this.keyboardSubscriptions.unsubscribe()},TaskDetail.prototype.ionViewDidEnter=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return console.log("TasksMap ionViewDidEnter()"),eval('MathJax.Hub.Queue(["Typeset", MathJax.Hub])'),[2]})})},TaskDetail.prototype.ionViewWillEnter=function(){return __awaiter(this,void 0,void 0,function(){var _this=this,_a,_b,_c,_d,_e,blankMatch_1,blankText,savedAnswer,blankContainer,inputs,answers,_i,_f,input,_loop_1,_g,_h,input,answerArray,i,component,answerArray,i,_j,_k,task,subtaskDetails,subtaskModal_1,subtaskModal_2,_l,details,scorableTaskCount,_m,_o,task,gpsType,points,buttonCount,startCharCode,i;return __generator(this,function(_p){switch(_p.label){case 0:return console.log("TasksMap ionViewWillEnter()"),this.routeId=this.navParams.get("routeId"),_a=this,[4,this.ormService.findRouteById(this.routeId)];case 1:return _a.route=_p.sent(),this.taskId=this.navParams.get("taskId"),this.subTaskIndex=this.navParams.get("subTaskIndex"),_b=this,[4,this.ormService.findTaskById(this.taskId)];case 2:return _b.task=_p.sent(),(this.subTaskIndex||0===this.subTaskIndex)&&(this.rootTask=this.task,this.task=this.rootTask.subtasks[this.subTaskIndex]),this.subTasksRequired=this.route.isSubtaskRequired(),console.log("Opened Task: ",this.task),this.isSpecialTaskType="multiple_choice"===this.task.solutionType||"gps"===this.task.solutionType||"vector_values"===this.task.solutionType||"vector_intervals"===this.task.solutionType||"set"===this.task.solutionType||"blanks"===this.task.solutionType,_c=this,_e=(_d=this.route).getScoreForUser,[4,this.ormService.getActiveUser()];case 3:if(_c.score=_e.apply(_d,[_p.sent()]),this.taskDetails=this.score.getTaskStateForTask(this.task.id),"blanks"===this.task.solutionType){for(this.specialSolution=this.task.getSolution(),blankText=this.specialSolution.val;null!==(blankMatch_1=this.blankRegex.exec(blankText));)savedAnswer=this.taskDetails.answerMultipleChoice&&this.taskDetails.answerMultipleChoice.length>0?this.taskDetails.answerMultipleChoice.find(function(t){return t.id===blankMatch_1[1]}):null,blankText=blankText.replace(blankMatch_1[0],'<span id="'+blankMatch_1[1]+'" class="blankInput '+(savedAnswer&&savedAnswer.solved||this.taskDetails&&(this.taskDetails.solved||this.taskDetails.solvedLow||this.taskDetails.failed)?"disabled":"")+'" role="textbox" contenteditable>'+(savedAnswer?savedAnswer.answer:"")+"</span>");if(blankContainer=document.getElementById("blankContainer"),blankContainer.innerHTML=blankText,inputs=blankContainer.getElementsByClassName("blankInput"),!this.taskDetails.answerMultipleChoice||0==this.taskDetails.answerMultipleChoice.length){for(answers=[],_i=0,_f=Array.from(inputs);_i<_f.length;_i++)input=_f[_i],answers.push({id:input.id,answer:"",solved:null});this.taskDetails.answerMultipleChoice=answers}for(_loop_1=function(t){t.addEventListener("input",function(e){_this.taskDetails.answerMultipleChoice.find(function(e){return e.id===t.id}).answer=e.currentTarget.innerText})},_g=0,_h=Array.from(inputs);_g<_h.length;_g++)input=_h[_g],_loop_1(input)}if("vector_values"===this.task.solutionType||"vector_intervals"===this.task.solutionType){if(this.specialSolution=this.task.getSolution(),!this.taskDetails.answerMultipleChoice||0==this.taskDetails.answerMultipleChoice.length){for(answerArray=[],i=0;i<this.specialSolution.components.length;i++)component=this.specialSolution.components[i],answerArray.push({name:component.name,answer:"",solved:null});this.taskDetails.answerMultipleChoice=answerArray}}else if("set"===this.task.solutionType&&(this.specialSolution=this.task.getSolution(),!this.taskDetails.answerMultipleChoice||0==this.taskDetails.answerMultipleChoice.length)){for(answerArray=[],i=0;i<this.specialSolution.length;i++)answerArray.push({answer:"",solved:null});this.taskDetails.answerMultipleChoice=answerArray}if(this.task.subtasks&&this.task.subtasks.length>0){for(this.solvedSubtasks=[],_j=0,_k=this.task.subtasks;_j<_k.length;_j++)task=_k[_j],((subtaskDetails=this.score.getTaskStateForTask(task.id)).solved||subtaskDetails.failed||subtaskDetails.solvedLow||subtaskDetails.saved||subtaskDetails.skipped)&&this.solvedSubtasks.push(subtaskDetails);this.subTasksRequired&&!this.subTaskModalShown&&this.solvedSubtasks.length!==this.task.subtasks.length?((subtaskModal_1=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{type:"text",message:0==this.solvedSubtasks.length?"a_subtaskinfo_required_message":"a_subtaskinfo_required_progress_message",modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.subtask,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[{title:"a_subtaskinfo_required_letsgo",callback:function(){subtaskModal_1.dismiss()}}]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})).present(),this.subTaskModalShown=!0):0===this.taskDetails.timeFirstOpen&&(subtaskModal_2=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{title:"a_subtaskinfo_title",type:"text",message:"a_subtaskinfo_message",modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.subtask,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[{title:"a_alert_close",callback:function(){subtaskModal_2.dismiss()}}]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})).present()}return _l=this,[4,this.chatAndSessionService.getActiveSession()];case 4:if(_l.sessionInfo=_p.sent(),null==this.sessionInfo||this.task||(details=JSON.stringify({title:this.task.title}),this.chatAndSessionService.addUserEvent("event_task_opened",details,this.task.id.toString())),0!=this.taskDetails.timeSolved||this.taskDetails.failed||(this.taskDetails.answer=""),this.gamificationIsDisabled=this.route.isGamificationDisabled(),!this.rootTask&&this.route.isAnswerFeedbackEnabled()&&"info"!=this.task.solutionType?(this.maxScore=100,this.orangeScore=this.maxScore/2,this.penalty=.15*Math.floor(this.maxScore),this.minScore=Math.floor(this.maxScore)/10):(this.maxScore=0,this.orangeScore=0,this.penalty=0,this.minScore=0),this.task.subtasks&&this.subTasksRequired){for(scorableTaskCount=1,_m=0,_o=this.task.subtasks;_m<_o.length;_m++)"info"!=(task=_o[_m]).solutionType&&scorableTaskCount++;this.subTaskScore=Math.floor(this.maxScore/scorableTaskCount),this.maxScore=this.subTaskScore+(this.maxScore-this.subTaskScore*scorableTaskCount),this.penalty=.15*Math.floor(this.maxScore),this.minScore=Math.floor(this.maxScore)/10}if(this.rootTask&&this.subTasksRequired&&"info"!==this.task.solutionType&&(this.subTaskScore=this.navParams.get("score"),this.maxScore=this.subTaskScore,this.orangeScore=this.maxScore/2,this.penalty=.15*Math.floor(this.maxScore),this.minScore=Math.floor(this.maxScore)/10),null==this.score.score&&(this.score.score=0),0==this.taskDetails.timeFirstOpen&&(this.taskDetails.timeFirstOpen=(new Date).getTime(),this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails)),"multiple_choice"==this.task.solutionType&&(this.multipleChoiceView.changes.subscribe(function(data){console.log("MultipleChoiceChildData",data),eval('MathJax.Hub.Queue(["Typeset", MathJax.Hub])')}),this.multipleChoiceList=this.taskDetails.solved||this.taskDetails.solvedLow?this.taskDetails.answerMultipleChoice:this.task.getSolutionOptionList()),"gps"==this.task.solutionType)for(this.taskDetailMap=new __WEBPACK_IMPORTED_MODULE_7__task_detail_map__.a(this.task,this.route,this.gpsService,this.app,this.ormService,this.imageService),this.taskDetailMap.loadMap(),null!=(gpsType=this.task.getSolutionGpsValue("task"))&&(points=[],"centerTwo"==gpsType&&(points=[this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2")]),"centerThree"==gpsType&&(points=[this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2"),this.task.getSolutionGpsValue("point3")]),points.length>0&&this.taskDetailMap.insertPreDefinedPoints(points),"linearFx"==gpsType&&this.taskDetailMap.insertAxis(this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2"))),buttonCount=this.task.getSolutionGpsValue("points"),buttonCount=null!=buttonCount?parseInt(buttonCount):0,startCharCode="A".charCodeAt(0),i=0;i<buttonCount;i++)this.gpsTaskButtonLabels[i]=String.fromCharCode(startCharCode+i);return this.taskDetails.skipped&&(this.taskDetails.newTries=0),"range"!=this.task.solutionType&&"value"!=this.task.solutionType&&"vector_values"!=this.task.solutionType&&"vector_intervals"!=this.task.solutionType&&"set"!==this.task.solutionType||this.subscribeCKEvents(),eval('MathJax.Hub.Queue(["Typeset", MathJax.Hub])'),[2]}})})},TaskDetail.prototype.ionViewWillLeave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return __WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.isVisible()&&__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.hide(),"range"!=this.task.solutionType&&"value"!=this.task.solutionType&&"vector_values"!=this.task.solutionType&&"vector_intervals"!=this.task.solutionType&&"set"!==this.task.solutionType||this.unsubscribeCKEvents(),(this.taskDetails.solved||this.taskDetails.solvedLow||this.taskDetails.failed)&&this.navParams.get("goToNextTaskById")&&this.navParams.get("goToNextTaskById")(this.task.id,!1),[2]})})},TaskDetail.prototype.setKeyboardOn=function(t,e){void 0===e&&(e=null);var n=this;this.answerIndex=e,t&&"gps"!=this.task.solutionType&&__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.show(function(){n.content.scrollTo(0,n.rootTask?document.getElementById("snd-keyboard-anchor").offsetTop:document.getElementById("keyboard-anchor").offsetTop)})},TaskDetail.prototype.hideKeyboard=function(){__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.isVisible()&&__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.hide()},TaskDetail.prototype.keyboardVisible=function(){return __WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.isVisible()},TaskDetail.prototype.isDecimal=function(t){var e=t.match(/^-?(0(([.,])[0-9]+)?|[1-9]{1}[0-9]*(([.,])[0-9]+)?)/g);return null!==e&&e[0]===t},TaskDetail.prototype.showHint=function(t){return __awaiter(this,void 0,void 0,function(){var e,n,s,l,i,a,o=this;return __generator(this,function(r){switch(e=!1,n="",s=this.task.getHint(t).type,l=this.task.getHint(t).value,-1==this.shownHints.indexOf(t)&&this.shownHints.push(t),t){case 1:this.taskDetails.solved||this.taskDetails.solvedLow||this.taskDetails.failed||(this.taskDetails.hint1=!0,e=!0),n="a_btn_hint1",null!=this.sessionInfo&&(i=JSON.stringify({}),this.chatAndSessionService.addUserEvent("event_took_hint1",i,this.task.id.toString()));break;case 2:this.taskDetails.solved||this.taskDetails.solvedLow||this.taskDetails.failed||(this.taskDetails.hint2=!0,e=!0),n="a_btn_hint2",null!=this.sessionInfo&&(i=JSON.stringify({}),this.chatAndSessionService.addUserEvent("event_took_hint2",i,this.task.id.toString()));break;case 3:this.taskDetails.solved||this.taskDetails.solvedLow||this.taskDetails.failed||(this.taskDetails.hint3=!0,null!=this.sessionInfo&&(i=JSON.stringify({}),this.chatAndSessionService.addUserEvent("event_took_hint3",i,this.task.id.toString())),e=!0),n="a_btn_hint3"}return e&&this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails),(a=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{title:n,type:s,message:l,modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.hint,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[{title:"a_alert_close",callback:function(){a.dismiss()}}]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})).onDidDismiss(function(t){if(null!=o.sessionInfo){var e=JSON.stringify({});o.chatAndSessionService.addUserEvent("event_hint_closed",e,o.task.id.toString())}}),a.present(),[2]})})},TaskDetail.prototype.checkResult=function(){return __awaiter(this,void 0,void 0,function(){var t,e,n,s,l,i,a,o,r,u,d,c,h,_,p,f,k,g,m,v,b,y,D,T,L,S,C,M,w,E,R,I,P,A,O,x,U,B,G;return __generator(this,function(N){if(("range"==this.task.solutionType||"value"==this.task.solutionType)&&!this.isDecimal(this.taskDetails.answer)||!this.isSpecialTypeAnswered())return[2];if(console.log(this.task.solutionType),t=[this.taskDetails.answer],e=this.taskDetails.answer.replace(",","."),n=JSON.stringify({solution:t,solutionType:this.task.solutionType}),"value"==this.task.solutionType)s=parseFloat(e),l=parseFloat(this.task.getSolution()),s.toString()==l.toString()?(this.CalculateScore("value","solved"),this.taskSolved("solved",t)):(null!=this.sessionInfo&&this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",n,this.task.id.toString()),this.taskSolved("",t));else if("multiple_choice"==this.task.solutionType){for(console.log(this.multipleChoiceList),i=!0,a=(a=this.multipleChoiceList.filter(function(t){return 1==t.userChecked})).map(function(t){return t.value}),L=0;L<this.multipleChoiceList.length;L++)if(o=this.multipleChoiceList[L],console.log(o),console.log(o.userChecked!=o.rightAnswer),o.userChecked!=o.rightAnswer){i=!1,console.log("found wrong answer");break}this.taskDetails.answerMultipleChoice=this.multipleChoiceList,console.log(i),r=[this.task.getSolution()],i?(this.CalculateScore("multiple_choice","solved"),this.taskSolved("solved",r)):(null!=this.sessionInfo&&(n=JSON.stringify({solution:a,solutionType:this.task.solutionType}),this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",n,this.task.id.toString())),this.taskSolved("",[""]))}else if("range"==this.task.solutionType)u=this.task.getSolutionList(),d=u[0],c=u[1],h=+this.taskDetails.answer.replace(",","."),_=[this.taskDetails.answer],h>=d&&h<=c?(this.CalculateScore("range","solved"),this.taskSolved("solved",_)):4==u.length?(p=u[3],f=[this.taskDetails.answer],h>=u[2]&&h<=p?(this.CalculateScore("range","solved_low"),this.taskSolved("solved_low",f)):(null!=this.sessionInfo&&this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",n,this.task.id.toString()),this.taskSolved("",[""]))):(null!=this.sessionInfo&&this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",n,this.task.id.toString()),this.taskSolved("",[""]));else if("gps"==this.task.solutionType)switch(k=this.task.getSolutionGpsValue("task"),console.log(k),k){case"lineNoDirection":this.CalculateLine(this.taskDetailMap.pointMarkers[0],this.taskDetailMap.pointMarkers[1],+this.task.getSolutionGpsValue("length"));break;case"line":this.CalculateLineDirection(this.taskDetailMap.pointMarkers[0],this.taskDetailMap.pointMarkers[1],+this.task.getSolutionGpsValue("length"),+this.task.getSolutionGpsValue("direction"));break;case"triangle":this.CalculateTriangle(this.taskDetailMap.pointMarkers[0],this.taskDetailMap.pointMarkers[1],this.taskDetailMap.pointMarkers[2],+this.task.getSolutionGpsValue("length"));break;case"square":this.CalculateSquare(this.taskDetailMap.pointMarkers[0],this.taskDetailMap.pointMarkers[1],this.taskDetailMap.pointMarkers[2],this.taskDetailMap.pointMarkers[3],+this.task.getSolutionGpsValue("length"));break;case"centerTwo":this.CalculateCenterTwoP(this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2"),this.taskDetailMap.pointMarkers[0]);break;case"centerThree":this.CalculateCenterThreeP(this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2"),this.task.getSolutionGpsValue("point3"),this.taskDetailMap.pointMarkers[0]);break;case"linearFx":this.CalculateLinearFx(this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2"),this.taskDetailMap.pointMarkers[0].getLatLng(),this.taskDetailMap.pointMarkers[1].getLatLng(),this.task.getSolutionGpsValue("slope"),this.task.getSolutionGpsValue("y"))}else if("vector_values"==this.task.solutionType){for(y=this.taskDetails.answerMultipleChoice,I=this.specialSolution.components,A=!0,O=[],T="<table class='solutionTable'>",L=0;L<y.length;L++)g=y[L],C=parseFloat(g.answer.replace(",",".")),O.push({name:(m=I[L]).name,answer:g.answer}),g.solved=C>+m.val-1e-4&&C<+m.val+1e-4,g.solved||(A=!1),T+="<tr><td>"+g.name+':</td> <td class="'+(g.solved?"correct":"false")+'">'+g.answer+"</td></tr>";T+="</table>",A?(this.CalculateScore("vector_values","solved"),this.taskSolved("solved",[T])):(null!=this.sessionInfo&&(n=JSON.stringify({solution:O,solutionType:this.task.solutionType}),this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",n,this.task.id.toString())),this.taskSolved("",[T]))}else if("vector_intervals"==this.task.solutionType){for(y=this.taskDetails.answerMultipleChoice,I=this.specialSolution.components,A=!0,O=[],T="<table class='solutionTable'>",L=0;L<y.length;L++)v=y[L],C=parseFloat(v.answer.replace(",",".")),O.push({name:(b=I[L]).name,answer:v.answer}),v.solved=C>=+b.low&&C<=+b.high,v.solved||(A=!1),T+="<tr><td>"+v.name+':</td> <td class="'+(v.solved?"correct":"false")+'">'+v.answer+"</td></tr>";T+="</table>",A?(this.CalculateScore("vector_intervals","solved"),this.taskSolved("solved",[T])):(null!=this.sessionInfo&&(n=JSON.stringify({solution:O,solutionType:this.task.solutionType}),this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",n,this.task.id.toString())),this.taskSolved("",[T]))}else if("set"===this.task.solutionType){y=[];for(D in this.taskDetails.answerMultipleChoice)y.push({answer:this.taskDetails.answerMultipleChoice[D].answer,originalIndex:D});for(y.sort(function(t,e){return parseFloat(t.answer)>parseFloat(e.answer)?1:parseFloat(t.answer)===parseFloat(e.answer)?0:-1}),I=this.specialSolution.sort(function(t,e){return parseFloat(t)>parseFloat(e)?1:parseFloat(t)===parseFloat(e)?0:-1}),A=!0,O=[],T="<table class='solutionTable'>",L=0;L<y.length;L++){for(S=y[L],C=parseFloat(S.answer.replace(",",".")),M=this.taskDetails.answerMultipleChoice[S.originalIndex],w=0,E=I;w<E.length;w++){if(R=E[w],C>+R-1e-4&&C<+R+1e-4){M.solved=!0;break}M.solved=!1}O.push(S.answer),M.solved||(A=!1),T+='<tr><td class="'+(M.solved?"correct":"false")+'">'+S.answer+"</td></tr>"}T+="</table>",A?(this.CalculateScore("set","solved"),this.taskSolved("solved",[T])):(null!=this.sessionInfo&&(n=JSON.stringify({solution:O,solutionType:this.task.solutionType}),this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",n,this.task.id.toString())),this.taskSolved("",[T]))}else if("blanks"===this.task.solutionType){for(I=this.specialSolution.features,P="strict"===this.specialSolution.settings.check_type?0:"normal"===this.specialSolution.settings.check_type?.2:.4,A=!0,O=[],x=this.specialSolution.val,U=function(t){for(var e=1,n=0,s=I.find(function(e){return e.blank==="**"+t.id+"**"}).answers;n<s.length;n++){var l=s[n];t.answer=trim(t.answer);var i=__WEBPACK_IMPORTED_MODULE_19_js_levenshtein__(l.toLowerCase(),t.answer.toLowerCase())/l.length;i<e&&(e=i)}if(t.solved=e<=P,t.solved){document.getElementById(t.id).classList.add("disabled")}else A=!1;var a=new RegExp("\\*\\*"+t.id.replace(/\//g,"\\/")+"\\*\\*").exec(x);x=x.replace(a[0],'<span class="blank '+(t.solved?"correct":"false")+'">'+t.answer+"</span>"),O.push(t.answer)},B=0,G=this.taskDetails.answerMultipleChoice;B<G.length;B++)U(G[B]);A?(this.CalculateScore("blanks","solved"),this.taskSolved("solved",[x])):(null!=this.sessionInfo&&(n=JSON.stringify({solution:O,solutionType:this.task.solutionType}),this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",n,this.task.id.toString())),this.taskSolved("",[x]))}return[2]})})},TaskDetail.prototype.completeTask=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return this.taskDetails.score=this.maxScore,this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",[""]),[2]})})},TaskDetail.prototype.showSolutionSample=function(t){var e=this;void 0===t&&(t=!1),this.taskDetails.solved||this.taskDetails.solvedLow||(this.rootTask||this.score.addFailedTask(this.task.id),this.taskDetails.score=0,this.taskDetails.failed=!0,this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails));var n=this.task.getSolutionSample(),s=this.task.getSolutionSampleImgSrc(),l=[];n&&0!=n.length||s&&0!=s.length?l.push(n):l=["a_msg_no_solutionsample","p_t_solution",this.task.getSolution()];var i=this,a=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{title:"t_samplesolution",imageUrl:this.task.getSolutionSampleImgSrc(),messages:l,modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.sampleSolution,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[{title:"a_alert_close",callback:function(){a.dismiss(),i.rootTask&&t&&i.goToNextSubtask()}}]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative});a.onDidDismiss(function(t){if(null!=e.sessionInfo){var n=JSON.stringify({});e.chatAndSessionService.addUserEvent("event_viewed_sample_solution",n,e.task.id.toString())}}),a.present()},TaskDetail.prototype.closeDetails=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(n){switch(n.label){case 0:return this.rootTask&&t?(this.taskDetails.skipped=!0,[4,this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails)]):[3,2];case 1:return n.sent(),[2,this.goToNextSubtask()];case 2:return this.navParams.get("goToNextTaskById")?(e=this.navParams.get("goToNextTaskById"),t?(this.taskDetails.skipped=!0,[4,this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails)]):[3,4]):[3,5];case 3:n.sent(),n.label=4;case 4:e(this.task.id,t),n.label=5;case 5:return this.deepLinker.navChange("back"),this.navCtrl.pop({},function(){}),[2]}})})},TaskDetail.prototype.confirmSkippingTask=function(){var t=this,e="a_skipTask_confirm";this.route.isNarrativeEnabled()&&(e=this.route.getNarrativeString(e)),this.modalsService.showDialog("a_skipTask",e,"no",function(){},"yes",function(){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(e){return null!=this.sessionInfo&&(t=JSON.stringify({}),this.chatAndSessionService.addUserEvent("event_task_skipped",t,this.task.id.toString())),this.closeDetails(!0),[2]})})},this.app.activeNarrative)},TaskDetail.prototype.getNextAvailableHint=function(){return-1==this.shownHints.indexOf(1)&&this.task.hasHintMessage(1)||!this.task.hasHintMessage(2)?1:-1==this.shownHints.indexOf(2)&&this.task.hasHintMessage(2)||!this.task.hasHintMessage(3)?2:-1==this.shownHints.indexOf(3)&&this.task.hasHintMessage(3)?3:4},TaskDetail.prototype.taskSolved=function(t,e){return __awaiter(this,void 0,void 0,function(){var n,s,l,i,a,o,r,u,d,c,h,_,p,f,k,g,m,v,b,y=this;return __generator(this,function(D){switch(D.label){case 0:if(n=this,this.route.isAnswerFeedbackEnabled()||(this.taskDetails.saved=!0,this.rootTask||this.score.addSavedTask(this.task.id)),"solved"==t||"solved_low"==t){if(this.taskDetails.skipped=!1,o="",g="","solved"==t)if(g="a_alert_right_answer_title",this.taskDetails.solved=!0,this.rootTask||this.score.addSolvedTask(this.task.id),this.rootTask&&!this.subTasksRequired)o=0==this.taskDetails.tries?"gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"info"==this.task.solutionType?"a_info_task_finished_message":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_1":"a_alert_subtask_right_answer":"a_alert_subtask_right_answer_1";else switch(this.taskDetails.tries){case 0:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"info"==this.task.solutionType?"a_info_task_finished_message":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_1":"a_alert_right_answer_1";break;case 1:case 2:case 3:case 4:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"info"==this.task.solutionType?"":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_2":"a_alert_right_answer_2";break;case 5:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"info"==this.task.solutionType?"":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_3":"a_alert_right_answer_3"}if("solved_low"==t)if(g="a_alert_right_answer_title_low",this.taskDetails.solvedLow=!0,this.rootTask||this.score.addSolvedTaskLow(this.task.id),this.rootTask&&!this.subTasksRequired)o=0==this.taskDetails.tries?"gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_1_low":"a_alert_right_answer_1_low":"a_alert_subtask_right_answer_low";else switch(this.taskDetails.tries){case 0:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_1_low":"a_alert_right_answer_1_low";break;case 1:case 2:case 3:case 4:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_2_low":"a_alert_right_answer_2_low";break;case 5:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_3_low":"a_alert_right_answer_3_low"}s=this,p={title:"t_samplesolution",callback:function(){i.dismiss().then(function(){s.showSolutionSample(!0)})}},l={title:"okay",callback:function(){i.dismiss().then(function(){s.goToNextSubtask()})}},b={title:"pdf_next_task",callback:function(){i.dismiss().then(function(){s.closeDetails(!1)})}},this.route.isNarrativeEnabled()&&(g=this.route.getNarrativeString(g),o=this.route.getNarrativeString(o)),this.route.isAnswerFeedbackEnabled()?(v={title:"info"===this.task.solutionType?"hide":g,message:o,solution:"info"===this.task.solutionType?void 0:e,modalType:"solved_low"==t?__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.solvedLow:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.solved,gamificationEnabled:!this.gamificationIsDisabled,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,param:{tries:this.taskDetails.tries+1},buttons:this.rootTask?[l]:this.route.isSampleSolutionEnabled()&&"info"!==this.task.solutionType?[p,b]:[b]},"info"!==this.task.solutionType&&(!this.rootTask||this.rootTask&&this.subTasksRequired)&&(v.score="+"+this.taskDetails.score+"MP/"+this.bestPossibleScore()+'MP<span class="subscore">'+this.generateSubtaskScoreCalculationString(t)+"</span>"),console.log(v),i=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,v,{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})):i=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{title:"a_alert_saved_answer_title",message:"a_alert_saved_answer_message",modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.saved,gamificationEnabled:!this.gamificationIsDisabled,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:this.rootTask?[l]:[b]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative}),i.onDidDismiss(function(t){console.log(t),t&&t.showMap&&y.navCtrl.pop()}),i.present(),null!=this.sessionInfo&&(a=JSON.stringify({score:this.taskDetails.score,solution:e,quality:t}),this.chatAndSessionService.addUserEvent("event_task_completed",a,this.task.id.toString())),this.taskDetails.timeSolved=(new Date).getTime()}else{switch(o="",r=void 0,u=this.taskDetails.tries,this.taskDetails.skipped&&(u=this.taskDetails.newTries),u){case 0:case 1:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"blanks"==this.task.solutionType?"a_alert_blanks_false_answer_1":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_false_answer_1":"a_alert_false_answer_1",r=[{title:"a_alert_close",callback:function(){m.dismiss()}}];break;case 2:case 3:case 4:case 5:case 6:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"blanks"==this.task.solutionType?"a_alert_blanks_false_answer_2":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_false_answer_2":"a_alert_false_answer_2",this.route.isHintsEnabled()&&!this.rootTask||(o="blanks"==this.task.solutionType?"a_alert_blanks_false_answer_1":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_false_answer_1":"a_alert_false_answer_1"),d={title:"a_t_show_hint",callback:function(){m.dismiss().then(function(){var t=1;if(3==u){t=(e=n.getNextAvailableHint())<2?e:2}else if(4==u){var e;t=(e=n.getNextAvailableHint())<3?e:3}n.showHint(t)})}},c=this,h={title:"a_t_show_subtask",callback:function(){m.dismiss().then(function(){c.openSubtask()})}},_={title:"a_alert_close",callback:function(){m.dismiss()}},r=this.route.isHintsEnabled()&&this.task.subtasks&&this.task.subtasks.length>0&&this.task.subtasks.length!==this.solvedSubtasks.length?[h,d,_]:this.route.isHintsEnabled()&&!this.rootTask?[d,_]:this.task.subtasks&&this.task.subtasks.length>0&&this.task.subtasks.length!==this.solvedSubtasks.length?[h,_]:[_];break;default:o="a_t_skip_msg",p={title:"t_samplesolution",callback:function(){m.dismiss().then(function(){if(null!=n.sessionInfo){var t=JSON.stringify({});n.chatAndSessionService.addUserEvent("event_task_failed",t,n.task.id.toString())}n.showSolutionSample(!0)})}},f={title:"a_skipTask",callback:function(){m.dismiss().then(function(){if(null!=n.sessionInfo){var t=JSON.stringify({});n.chatAndSessionService.addUserEvent("event_task_skipped",t,n.task.id.toString())}n.closeDetails(!0)})}},k={title:"okay",callback:function(){m.dismiss().then(function(){if(null!=n.sessionInfo){var t=JSON.stringify({});n.chatAndSessionService.addUserEvent("event_task_failed",t,n.task.id.toString())}n.taskDetails.failed=!0,n.ormService.insertOrUpdateTaskState(n.score,n.taskDetails).then(function(){n.rootTask?n.goToNextSubtask():n.closeDetails()})})}},r=this.rootTask&&this.route.isSampleSolutionEnabled()?[p,k]:this.rootTask?[k]:this.route.isSampleSolutionEnabled()?[p,f]:[f]}this.taskDetails.tries++,this.taskDetails.skipped&&this.taskDetails.newTries++,g="a_alert_false_answer_title",this.route.isNarrativeEnabled()&&(g=this.route.getNarrativeString(g),o=this.route.getNarrativeString(o)),this.route.isAnswerFeedbackEnabled()?(v={title:g,message:o,solution:e,modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.error,gamificationEnabled:!this.gamificationIsDisabled,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:r},(!this.rootTask||this.rootTask&&this.subTasksRequired)&&(v.score=this.taskDetails.tries>1?"-"+this.penalty:"0"),m=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,v,{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})):(b={title:"pdf_next_task",callback:function(){m.dismiss().then(function(){n.closeDetails(!1)})}},m=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{title:"a_alert_saved_answer_title",message:"a_alert_saved_answer_message",modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.saved,gamificationEnabled:!this.gamificationIsDisabled,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[b]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})),m.present()}return[4,this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails)];case 1:return D.sent(),[2]}})})},TaskDetail.prototype.CalculateScore=function(t,e){if("value"==t)if(this.taskDetails.tries>0){this.taskDetails.score=(l=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?l:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.maxScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score);if("multiple_choice"==t)if(this.taskDetails.tries>0){this.taskDetails.score=(l=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?l:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.maxScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score);if("range"==t)if("solved"==e)if(this.taskDetails.tries>0){this.taskDetails.score=(l=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?l:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.maxScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score);else if("solved_low"==e){var n=this.task.getSolutionList(),s=parseFloat(this.taskDetails.answer.replace(",","."));if(s<n[0])if(this.taskDetails.tries>0){var l=this.CalculateOrangeScore(n[2],n[0],s,this.maxScore-(this.taskDetails.tries-1)*this.penalty);this.taskDetails.score=l>this.minScore?l:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.CalculateOrangeScore(n[2],n[0],s,this.maxScore),this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score);else if(this.taskDetails.tries>0){l=this.CalculateOrangeScore(n[3],n[1],s,this.maxScore-(this.taskDetails.tries-1)*this.penalty);this.taskDetails.score=l>this.minScore?l:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.CalculateOrangeScore(n[3],n[1],s,this.maxScore),this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}if("vector_values"==t||"vector_intervals"==t||"set"==t||"blanks"===t)if(this.taskDetails.tries>0){this.taskDetails.score=(l=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?l:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.maxScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score);if(this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0){l=this.taskDetails.score;for(var i=0,a=this.solvedSubtasks;i<a.length;i++){l+=a[i].score}this.taskDetails.score=l>this.minScore?l:this.minScore,this.rootTask||(this.score.score+=this.taskDetails.score)}console.log("FinalScore: "+this.score.score)},TaskDetail.prototype.CalculateOrangeScore=function(t,e,n,s){var l=Math.abs(e-t);console.log("borderRight "+e+"  BorderLeft "+t);var i=Math.abs(n-t)/l*s,a=Math.round(i);return a<this.minScore?this.minScore:a},TaskDetail.prototype.bestPossibleScore=function(){return this.rootTask&&this.subTasksRequired?this.maxScore:100},TaskDetail.prototype.possibleScore=function(){if(this.taskDetails){if(this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0){for(var t=0,e=0,n=this.solvedSubtasks;e<n.length;e++){t+=n[e].score}return t+=0==this.taskDetails.tries?this.maxScore:this.maxScore-(this.taskDetails.tries-1)*this.penalty>this.minScore?this.maxScore-(this.taskDetails.tries-1)*this.penalty:this.minScore}return 0==this.taskDetails.tries?this.maxScore:this.maxScore-(this.taskDetails.tries-1)*this.penalty>this.minScore?this.maxScore-(this.taskDetails.tries-1)*this.penalty:this.minScore}return this.maxScore},TaskDetail.prototype.CalculateLine=function(t,e,n){var s=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t.getLatLng(),e.getLatLng()]),l=[Math.round(s).toString()];if(s>n-10&&s<n+10){if(this.taskDetails.tries>0){this.taskDetails.score=(i=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?i:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",l)}else if(s>n-20&&s<n+20){if(this.taskDetails.tries>0){var i;this.taskDetails.score=(i=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?i:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",l)}else this.taskSolved("",l)},TaskDetail.prototype.CalculateLineDirection=function(t,e,n,s){var l=0,i=0,a=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t.getLatLng(),e.getLatLng()]),o=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.bearing(t.getLatLng(),e.getLatLng());o<0&&(o+=360),l=a>n-10&&a<n+10?2:a>n-20&&a<n+20?1:0;var r=!1,u=s-10,d=s-20;u<0&&(u+=360,r=!0),d&&(d+=360,r=!0),i=r?o>u||o<s+10?2:o>d||o<s+20?1:0:o>u&&o<s+10?2:o>d&&o<s+20?1:0;var c=[Math.round(a).toString(),Math.round(o-s).toString()];if(2==i&&2==l){if(this.taskDetails.tries>0){this.taskDetails.score=(h=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?h:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",c)}else if(i>0&&l>0){if(this.taskDetails.tries>0){var h;this.taskDetails.score=(h=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?h:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",c)}else this.taskSolved("",c)},TaskDetail.prototype.CalculateTriangle=function(t,e,n,s){for(var l=[__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t.getLatLng(),e.getLatLng()]),__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([e.getLatLng(),n.getLatLng()]),__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([n.getLatLng(),t.getLatLng()])],i=!0,a=!0,o=0;o<l.length;o++){var r=l[o];r>s-10&&r<s+10||(r>s-20&&r<20?i=!1:(a=!1,i=!1))}var u=[Math.round(l[0]).toString(),Math.round(l[1]).toString(),Math.round(l[2]).toString()];if(i){if(this.taskDetails.tries>0){this.taskDetails.score=(d=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?d:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",u)}else if(a){if(this.taskDetails.tries>0){var d;this.taskDetails.score=(d=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?d:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",u)}else this.taskSolved("",u)},TaskDetail.prototype.CalculateSquare=function(t,e,n,s,l){for(var i=[__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t.getLatLng(),e.getLatLng()]),__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([e.getLatLng(),n.getLatLng()]),__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([n.getLatLng(),s.getLatLng()]),__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([s.getLatLng(),t.getLatLng()])],a=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t.getLatLng(),n.getLatLng()]),o=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([e.getLatLng(),s.getLatLng()]),r=!0,u=!0,d=0,c=0;c<i.length;c++){var h=i[c];h>l-10&&h<l+10||(h>l-20&&h<20?r=!1:(u=!1,r=!1))}d=Math.abs(a-o)<10?2:Math.abs(a-o)<20?1:0;var _=[Math.round(i[0]).toString(),Math.round(i[1]).toString(),Math.round(i[2]).toString(),Math.round(i[3]).toString()];if(r&&2==d){if(this.taskDetails.tries>0){this.taskDetails.score=(p=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?p:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",_)}else if(u&&d>0){if(this.taskDetails.tries>0){var p;this.taskDetails.score=(p=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?p:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",_)}else this.taskSolved("",_)},TaskDetail.prototype.CalculateCenterTwoP=function(t,e,n){t=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(t[0],t[1]),e=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(e[0],e[1]),console.log(n.getLatLng());var s=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t,n.getLatLng()]),l=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([e,n.getLatLng()]),i=Math.abs(s-l),a=[Math.round(s).toString(),Math.round(l).toString()];if(i<5){if(this.taskDetails.tries>0){this.taskDetails.score=(o=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?o:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",a)}else if(i<10){if(this.taskDetails.tries>0){var o;this.taskDetails.score=(o=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?o:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",a)}else this.taskSolved("",a)},TaskDetail.prototype.CalculateCenterThreeP=function(t,e,n,s){t=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(t[0],t[1]),e=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(e[0],e[1]),n=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(n[0],n[1]);var l=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t,s.getLatLng()]),i=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([e,s.getLatLng()]),a=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([n,s.getLatLng()]),o=Math.abs(l-i),r=Math.abs(i-a),u=[Math.round(l).toString(),Math.round(i).toString(),Math.round(a).toString()];if(o<5&&r<5){if(this.taskDetails.tries>0){this.taskDetails.score=(d=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?d:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",u)}else if(o<10&&r<10){if(this.taskDetails.tries>0){var d;this.taskDetails.score=(d=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?d:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",u)}else this.taskSolved("",u)},TaskDetail.prototype.CalculateLinearFx=function(t,e,n,s,l,i){t=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(t[0],t[1]),e=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(e[0],e[1]);__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t,e])<100&&(e=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.destination(t,__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.bearing(t,e),100));var a=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.bearing(t,e)-90;a<0&&(a+=360);var o=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.destination(t,a,100),r=this.getDistanceToLine(n,t,o),u=this.getDistanceToLine(s,t,o);if(r>u){var d=n;n=s,s=d}var c=this.getDistanceToLine(n,t,e),h=(this.getDistanceToLine(s,t,e)-c)/(u-r),_=c-h*r,p=0,f=0,k=[Math.round(h).toString(),Math.round(i).toString()],g=[h.toFixed(2).toString(),Math.round(_).toString()];if(h>l-5&&h<l+5?p=2:h>l-10&&h<l+10&&(p=1),_>i-5&&_<i+5?f=2:_>i-10&&_<i+10&&(f=1),2==p&&2==f){if(this.taskDetails.tries>0){this.taskDetails.score=(m=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?m:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",k)}else if(p>0&&f>0){if(this.taskDetails.tries>0){var m;this.taskDetails.score=(m=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?m:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",k)}else this.taskSolved("",g)},TaskDetail.prototype.getDistanceToLine=function(t,e,n){var s=this.taskDetailMap.getMap();if(null!=s){var l=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.closestOnSegment(s,t,e,n);return __WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t,l])}return 0},TaskDetail.prototype.setFabColor=function(t){return"fab-color-"+(t+1)},TaskDetail.prototype.SetMessage=function(t){var e="";switch(t){case"lineNoDirection":e="a_line_no_direction_distance";break;case"line":e="a_line_direction_distance";break;case"triangle":e="a_triangle_distances";break;case"square":e="a_square_distances";break;case"centerTwo":e="a_center_two_distances";break;case"centerThree":e="a_center_three_distances";break;case"linearFx":e="a_linearFx_info"}return e},TaskDetail.prototype.openInPhotoviewer=function(t){var e=this;void 0===t&&(t=!1),__WEBPACK_IMPORTED_MODULE_16__classes_Helper__.b.isPluginAvailable(__WEBPACK_IMPORTED_MODULE_15__ionic_native_photo_viewer__.a)&&(this.spinnerDialog.show(),setTimeout(function(){e.photoViewer.show(t?e.rootTask.getImageURL(!0):e.task.getImageURL(!0)),setTimeout(function(){e.spinnerDialog.hide()},1e3)},100))},TaskDetail.prototype.openSubtask=function(t){var e=this.rootTask?this.rootTask:this.task;if(t||0===t||this.solvedSubtasks.length!==e.subtasks.length)return t||0===t||(t=this.solvedSubtasks.length),this.navCtrl.push(TaskDetail_1,{taskId:this.taskId,routeId:this.routeId,headerTitle:e.subtasks[t].title,subTaskIndex:t,score:this.subTaskScore})},TaskDetail.prototype.changeSubtaskAccordionState=function(t){this.activeAccordions.find(function(e){return e===t})?this.activeAccordions=this.activeAccordions.filter(function(e){return e!=t}):this.activeAccordions.push(t),console.log("New Accordion State",this.activeAccordions)},TaskDetail.prototype.goToNextSubtask=function(){var t=this,e=this.navCtrl.getActive().index;this.subTaskIndex+1!==this.rootTask.subtasks.length?this.openSubtask(this.subTaskIndex+1).then(function(){t.navCtrl.remove(e)}):this.closeDetails()},TaskDetail.prototype.goToPreviousSubtask=function(){var t=this,e=this.navCtrl.getActive().index;this.subTaskIndex-1>=0?this.openSubtask(this.subTaskIndex-1).then(function(){t.navCtrl.remove(e)}):this.closeDetails()},TaskDetail.prototype.isSpecialTypeAnswered=function(){var t=!0;if(!this.isSpecialTaskType)return t;if("vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType||"set"==this.task.solutionType||"blanks"==this.task.solutionType)for(var e=0,n=this.taskDetails.answerMultipleChoice;e<n.length;e++){""===n[e].answer&&(t=!1)}return t},TaskDetail.prototype.generateSubtaskScoreCalculationString=function(t){var e,n=this.task.solutionType;if("value"!=n&&"multiple_choice"!=n&&"vector_values"!=n&&"vector_intervals"!=n&&"set"!=n&&"blanks"!==n||(e=this.maxScore),"range"==n)if("solved"==t)e=this.maxScore;else if("solved_low"==t){var s=this.task.getSolutionList(),l=parseFloat(this.taskDetails.answer.replace(",","."));e=l<s[0]?this.CalculateOrangeScore(s[2],s[0],l,this.taskDetails.tries>0?this.maxScore-(this.taskDetails.tries-1)*this.penalty:this.maxScore):this.CalculateOrangeScore(s[3],s[1],l,this.taskDetails.tries>0?this.maxScore-(this.taskDetails.tries-1)*this.penalty:this.maxScore)}var i="";if(this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0){for(var a=[],o=0,r=this.solvedSubtasks;o<r.length;o++){var u=r[o];a[u.score]?a[u.score]++:a[u.score]=1}if(this.taskDetails.tries<=1)a[e]?a[e]++:a[e]=1;else{var d=e-(this.taskDetails.tries-1)*this.penalty>this.minScore?this.maxScore-(this.taskDetails.tries-1)*this.penalty:this.minScore;a[d]?a[d]++:a[d]=1}for(var c in a)""!=i&&(i+=" + "),1==a[c]&&"0"!=c?i+=c+"MP":"0"!=c&&(i+=a[c]+" x "+c+"MP")}else{var h=0;h=this.taskDetails.tries>1?this.maxScore-(this.taskDetails.tries-1)*this.penalty-e:this.maxScore-e,this.taskDetails.tries>1?(i=this.taskDetails.tries>2?this.maxScore+"MP - "+(this.taskDetails.tries-1)+" x "+this.penalty+"MP":this.maxScore+"MP - "+this.penalty+"MP",h>0&&(i+=" -"+h+"MP")):h>0&&(i=this.maxScore+"MP - "+h+"MP")}return i},TaskDetail.prototype.displayScoreCalculation=function(){if(this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0){var t=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{type:"text",score:"("+this.generateSubtaskScoreCalculationString("solved")+")",gamificationEnabled:!this.gamificationIsDisabled,modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.calculation,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[{title:"a_alert_close",callback:function(){t.dismiss()}}]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative});t.present()}},TaskDetail.prototype.goBack=function(){console.log("We goin back boys"),this.rootTask?this.goToPreviousSubtask():this.closeDetails()},TaskDetail;var TaskDetail_1,_a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p}()},945:function(t,e,n){"use strict";n.d(e,"a",function(){return c});n(0);var s=n(138),l=(n.n(s),n(935)),i=(n.n(l),n(938)),a=(n.n(i),n(616)),o=(n.n(a),n(28)),r=n(615),u=n(617),d=(n.n(u),n(941)),c=(n.n(d),function(){function t(t,e,n,s,l,i){this.task=t,this.route=e,this.gpsService=n,this.app=s,this.ormService=l,this.imagesService=i,this.pointsIcons=[],this.pointMarkers=[],this.ALLOWED_DISTANCE_TO_TASK=300,this.AXIS_LENGTH=110,this.ARROW_LENGTH=6,this.ARROW_DEGREE=25,this.MARK_DISTANCE=10,this.MARK_LENGTH=1.5,this.LINEAR_FX_EXTEND=100,this.axisPoints={origin:null,x:null,y:null},this.linearFxGraph=null,this.markerGroup=null,this.updateIcons(),this.taskDetails=t,this.routeDetails=e;for(var a=0;a<parseInt(this.task.getSolutionGpsValue("points"));a++)this.pointMarkers[a]=null}return t.prototype.ngOnDestroy=function(){this.watchSubscription&&(this.watchSubscription.unsubscribe(),this.watchSubscription=null)},t.prototype.updateIcons=function(){switch(this.app.activeNarrative){case"pirates":this.userPositionIcon=s.icon({iconUrl:"./assets/icons/pirates/mapposition.png",iconSize:[100,100],iconAnchor:[50,50],className:"marker userPosition"}),this.preDefinedPointIcon=s.icon({iconUrl:"assets/icons/pirates/marker-task-gps-0.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.pointsIcons[0]=s.icon({iconUrl:"./assets/icons/pirates/marker-task-gps-1.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.pointsIcons[1]=s.icon({iconUrl:"./assets/icons/pirates/marker-task-gps-2.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.pointsIcons[2]=s.icon({iconUrl:"./assets/icons/pirates/marker-task-gps-3.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.pointsIcons[3]=s.icon({iconUrl:"./assets/icons/pirates/marker-task-gps-4.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"});break;default:this.userPositionIcon=s.icon({iconUrl:"./assets/icons/mapposition.png",iconSize:[100,100],className:"marker"}),this.preDefinedPointIcon=s.icon({iconUrl:"./assets/icons/marker-task-gps-0.png",iconSize:[50,50],iconAnchor:[25,50],className:"marker"}),this.pointsIcons[0]=s.icon({iconUrl:"./assets/icons/marker-task-gps-1.png",iconSize:[50,50],iconAnchor:[25,50],className:"marker"}),this.pointsIcons[1]=s.icon({iconUrl:"./assets/icons/marker-task-gps-2.png",iconSize:[50,50],iconAnchor:[25,50],className:"marker"}),this.pointsIcons[2]=s.icon({iconUrl:"./assets/icons/marker-task-gps-3.png",iconSize:[50,50],iconAnchor:[25,50],className:"marker"}),this.pointsIcons[3]=s.icon({iconUrl:"./assets/icons/marker-task-gps-4.png",iconSize:[50,50],iconAnchor:[25,50],className:"marker"})}},t.prototype.setMarker=function(t){var e;if(null!=(e=this.gpsService.getLastPosition())){var n=new s.LatLng(e.coords.latitude,e.coords.longitude);if(!this.markerCanBeSet(n))return;if(null==this.pointMarkers[t]){String.fromCharCode("A".charCodeAt(0)+t);var l=s.marker(n,{icon:this.pointsIcons[t]});l.addTo(this.map),this.pointMarkers[t]=l}else this.pointMarkers[t].setLatLng(n);"linearFx"==this.taskDetails.getSolutionGpsValue("task")&&this.insertLinearFxGraph(),console.log("Marker placed")}},t.prototype.markerCanBeSet=function(t){if(s.GeometryUtil.length([new s.LatLng(this.taskDetails.lat,this.taskDetails.lon),t])>this.ALLOWED_DISTANCE_TO_TASK)return console.log("Marker cannot be placed: Out of range."),!1;if("linearFx"==this.taskDetails.getSolutionGpsValue("task")){var e=s.GeometryUtil.destination(this.axisPoints.x,s.GeometryUtil.bearing(this.axisPoints.origin,this.axisPoints.y),this.AXIS_LENGTH),n=s.GeometryUtil.closestOnSegment(this.map,t,this.axisPoints.origin,this.axisPoints.x),l=s.GeometryUtil.closestOnSegment(this.map,t,this.axisPoints.origin,this.axisPoints.y),i=s.GeometryUtil.closestOnSegment(this.map,t,this.axisPoints.x,e),a=s.GeometryUtil.closestOnSegment(this.map,t,this.axisPoints.y,e),o=s.GeometryUtil.length([n,t]),r=s.GeometryUtil.length([l,t]),u=s.GeometryUtil.length([i,t]),d=s.GeometryUtil.length([a,t]);return o<=this.AXIS_LENGTH&&r<=this.AXIS_LENGTH&&u<=this.AXIS_LENGTH&&d<=this.AXIS_LENGTH||(console.log("Marker cannot be placed: Not in axis"),!1)}return!0},t.prototype.areAllPointsSet=function(){for(var t=!0,e=0;e<this.pointMarkers.length;e++)if(null==this.pointMarkers[e]){t=!1;break}return t},t.prototype.getPoints=function(){if(this.areAllPointsSet()){for(var t=[],e=0;e<this.pointMarkers.length;e++){t[e]=this.pointMarkers[e].getLatLng()}return t}return null},t.prototype.insertPreDefinedPoints=function(t){for(var e=0;e<t.length;e++){s.marker(new s.LatLng(t[e][0],t[e][1]),{icon:this.preDefinedPointIcon}).addTo(this.map)}},t.prototype.insertAxis=function(t,e){var n=new s.LatLng(t[0],t[1]),l=new s.LatLng(e[0],e[1]),i=s.GeometryUtil.bearing(n,l);l=s.GeometryUtil.destination(n,i,this.AXIS_LENGTH);var a=s.GeometryUtil.destination(n,i-90,this.AXIS_LENGTH),o=s.GeometryUtil.destination(l,i-180+this.ARROW_DEGREE,this.ARROW_LENGTH),r=s.GeometryUtil.destination(l,i+180-this.ARROW_DEGREE,this.ARROW_LENGTH),u=s.GeometryUtil.destination(a,i-90-180+this.ARROW_DEGREE,this.ARROW_LENGTH),d=s.GeometryUtil.destination(a,i-90+180-this.ARROW_DEGREE,this.ARROW_LENGTH);s.polyline([u,a,d,a,n,l,o,l,r],{color:"red",opacity:.7}).addTo(this.map),this.axisPoints.origin=n,this.axisPoints.x=l,this.axisPoints.y=a,s.marker(s.GeometryUtil.destination(l,i,3*this.MARK_LENGTH),{rotationAngle:i-90,icon:this.getLabeledIcon("X","axis-label","x")}).addTo(this.map),s.marker(s.GeometryUtil.destination(a,i-90,3*this.MARK_LENGTH),{rotationAngle:i-90,icon:this.getLabeledIcon("Y","axis-label","y")}).addTo(this.map),s.polyline([s.GeometryUtil.destination(n,i+135,this.MARK_LENGTH),s.GeometryUtil.destination(n,i-45,1.5*this.MARK_LENGTH)],{color:"red",weight:2,opacity:.7}).addTo(this.map),s.marker(s.GeometryUtil.destination(n,i+135,2*this.MARK_LENGTH),{icon:this.getLabeledIcon("0 m","axis-label","y"),rotationAngle:i-90}).addTo(this.map);for(var c=1;c<this.AXIS_LENGTH/this.MARK_DISTANCE;c++){var h=2;5!=c&&10!=c||(h=4);var _=s.GeometryUtil.destination(n,i,this.MARK_DISTANCE*c),p=s.GeometryUtil.destination(n,i-90,this.MARK_DISTANCE*c),f=s.GeometryUtil.destination(_,i-90,this.MARK_LENGTH),k=s.GeometryUtil.destination(_,i-90,-this.MARK_LENGTH),g=s.GeometryUtil.destination(p,i,this.MARK_LENGTH),m=s.GeometryUtil.destination(p,i,-this.MARK_LENGTH);if(s.polyline([k,f],{color:"red",weight:h,opacity:.7}).addTo(this.map),s.polyline([m,g],{color:"red",weight:h,opacity:.7}).addTo(this.map),5==c||10==c){var v=s.GeometryUtil.destination(_,i+90,3*this.MARK_LENGTH),b=s.GeometryUtil.destination(p,-i,3*this.MARK_LENGTH);s.marker(v,{icon:this.getLabeledIcon(10*c+" m","axis-label","x"),rotationAngle:i-90}).addTo(this.map),s.marker(b,{icon:this.getLabeledIcon(10*c+" m","axis-label","y"),rotationAngle:i-90}).addTo(this.map)}}},t.prototype.getLabeledIcon=function(t,e,n){var l;return l=[40,20],s.divIcon({className:e,html:t,iconSize:l})},t.prototype.insertLinearFxGraph=function(){if(this.areAllPointsSet()){var t=this.getPoints();null!=this.linearFxGraph&&this.map.removeLayer(this.linearFxGraph);var e=s.GeometryUtil.bearing(t[0],t[1]),n=s.GeometryUtil.destination(t[0],e,-1*this.LINEAR_FX_EXTEND),l=s.GeometryUtil.destination(t[1],e,this.LINEAR_FX_EXTEND);this.linearFxGraph=s.polyline([n,l],{color:"blue"}).addTo(this.map)}},t.prototype.loadMap=function(){var t=this;this.center=[this.taskDetails.lat,this.taskDetails.lon];var e=this.route.getTilesMap(this.app.activeNarrative),n=this.route.getTilesServerSubdomains(this.app.activeNarrative);if(null==this.map){this.map=s.map("gpsTaskMap",{center:this.center,zoom:18,zoomControl:!0,tileSize:256,maxBounds:this.routeDetails.getBoundingBoxLatLng(),trackResize:!1}),this.map.on("click",function(t){null==o.b.testLocation&&(o.b.testLocation={coords:{latitude:null,longitude:null}}),o.b.testLocation.coords.latitude=t.latlng.lat,o.b.testLocation.coords.longitude=t.latlng.lng});var l=o.b.calculateZoom(this.route.getViewBoundingBoxLatLng());r.a.initialize().then(function(){console.log("Tiles DB Initialized");var i=s.tileLayer.offline(e,r.a,{attribution:"&copy; mapbox.com",subdomains:n,minZoom:l.min_zoom,maxZoom:l.max_zoom,tileSize:256,crossOrigin:!0,detectRetina:!0,bounds:t.route.getBoundingBoxLatLng()}),a=t.ormService.getTileURLsAsObject(t.route),o=!t.route.isNarrativeEnabled(),u=t;i.getTileUrl=function(t){var e=s.TileLayer.prototype.getTileUrl.call(this,t),n=this._getStorageKey(e);return a[n]?Promise.resolve(u.imagesService.getOfflineURL(n,!1,o)):Promise.resolve(e)},t.map.fitBounds(t.route.getViewBoundingBoxLatLng()),i.on("offline:below-min-zoom-error",function(){alert("Can not save tiles below minimum zoom level.")}),i.on("offline:save-start",function(t){console.debug(t),console.debug("Saving "+t.nTilesToSave+" tiles.")}),i.on("offline:save-end",function(){alert("All the tiles were saved.")}),i.on("offline:save-error",function(t){console.error("Error when saving tiles: "+t)}),i.on("offline:remove-start",function(){console.debug("Removing tiles.")}),i.on("offline:remove-end",function(){alert("All the tiles were removed.")}),i.on("offline:remove-error",function(t){console.error("Error when removing tiles: "+t)}),i.addTo(t.map)}),this.gpsService.getCurrentPosition().then(function(e){e&&e.coords&&(console.warn("found you"),t.userMarker=s.marker([e.coords.latitude,e.coords.longitude],{icon:t.userPositionIcon}).on("click",function(){}),t.userMarker.setRotationOrigin("center center"),t.userMarker.addTo(t.map),t.watchSubscription&&t.watchSubscription.unsubscribe(),t.watchSubscription=t.gpsService.watchPosition().subscribe(function(e){if(e&&e.coords){var n=new s.LatLng(e.coords.latitude,e.coords.longitude);if(t.userMarker.setLatLng(n),null!=t.prevPos){var l=o.b.getAngle(t.prevPos,e.coords);t.userMarker.setRotationAngle(l)}t.prevPos=e.coords}}))}).catch(function(t){console.error("Location error: "+JSON.stringify(t))})}},t.prototype.getMap=function(){return this.map},t}())},946:function(t,e,n){"use strict";t.exports=function(){function t(t,e,n,s,l){return t<e||n<e?t>n?n+1:t+1:s===l?e:e+1}return function(e,n){if(e===n)return 0;if(e.length>n.length){var s=e;e=n,n=s}for(var l=e.length,i=n.length;l>0&&e.charCodeAt(l-1)===n.charCodeAt(i-1);)l--,i--;for(var a=0;a<l&&e.charCodeAt(a)===n.charCodeAt(a);)a++;if(l-=a,i-=a,0===l||i<3)return i;var o,r,u,d,c,h,_,p,f,k,g,m,v=0,b=[];for(o=0;o<l;o++)b.push(o+1),b.push(e.charCodeAt(a+o));for(var y=b.length-1;v<i-3;)for(f=n.charCodeAt(a+(r=v)),k=n.charCodeAt(a+(u=v+1)),g=n.charCodeAt(a+(d=v+2)),m=n.charCodeAt(a+(c=v+3)),h=v+=4,o=0;o<y;o+=2)h=t(d=t(u=t(r=t(_=b[o],r,u,f,p=b[o+1]),u,d,k,p),d,c,g,p),c,h,m,p),b[o]=h,c=d,d=u,u=r,r=_;for(;v<i;)for(f=n.charCodeAt(a+(r=v)),h=++v,o=0;o<y;o+=2)b[o]=h=t(_=b[o],r,h,f,b[o+1]),r=_;return h}}()}});