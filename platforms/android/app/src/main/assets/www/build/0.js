webpackJsonp([0],{951:function(t,e,l){"use strict";function n(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,5,"button",[["ion-fab",""]],null,[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.taskDetailMap.setMarker(t.context.index)&&n}return n},At.b,At.a)),vt["ɵdid"](49152,[[3,4]],0,xt.a,[Pt.a,vt.ElementRef,vt.Renderer],{color:[0,"color"]},null),(t()(),vt["ɵted"](0,["\n                    "])),(t()(),vt["ɵeld"](0,null,0,1,"span",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,["",""])),(t()(),vt["ɵted"](0,["\n                "]))],function(t,e){t(e,1,0,e.component.setFabColor(e.context.index))},function(t,e){t(e,4,0,e.context.$implicit)})}function s(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,7,"ion-fab",[["bottom",""],["right",""]],null,null,null,Ut.b,Ut.a)),vt["ɵdid"](1228800,null,2,Bt.a,[Kt.a],null,null),vt["ɵqud"](603979776,3,{_mainButton:0}),vt["ɵqud"](603979776,4,{_fabLists:1}),(t()(),vt["ɵted"](0,["\n                "])),(t()(),vt["ɵand"](16777216,null,0,1,null,n)),vt["ɵdid"](802816,null,0,Nt.j,[vt.ViewContainerRef,vt.TemplateRef,vt.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(t()(),vt["ɵted"](0,["\n            "]))],function(t,e){t(e,6,0,e.component.gpsTaskButtonLabels)},null)}function i(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,4,"div",[["id","gpsTaskMap"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,s)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n        "]))],function(t,e){var l=e.component;t(e,3,0,l.task&&"gps"==l.task.solutionType)},null)}function a(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","image"]],[[8,"src",4]],[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.openInPhotoviewer()&&n}return n},null,null))],null,function(t,e){t(e,0,0,e.component.task.getImageURL())})}function o(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","image"]],[[8,"src",4]],[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.openInPhotoviewer(!0)&&n}return n},null,null))],null,function(t,e){t(e,0,0,e.component.rootTask.getImageURL())})}function r(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,3,"ion-label",[],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef])],null,function(t,e){t(e,2,0,vt["ɵunv"](e,2,0,vt["ɵnov"](e,3).transform("a_title_activity_task_view")))})}function u(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,4,"ion-label",[],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpod"]({current:0,count:1}),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef])],null,function(t,e){var l=e.component;t(e,2,0,vt["ɵunv"](e,2,0,vt["ɵnov"](e,4).transform("a_title_activity_subtask_view",t(e,3,0,l.subTaskIndex+1,l.rootTask.subtasks.length))))})}function c(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,3,"ion-label",[["class","tag score"]],null,[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.displayScoreCalculation()&&n}return n},null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵppd"](1)],null,function(t,e){var l=e.component;t(e,2,0,vt["ɵunv"](e,2,0,t(e,3,0,vt["ɵnov"](e.parent,0),l.possibleScore())))})}function d(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,1,"p",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,["",""]))],null,function(t,e){t(e,1,0,e.component.task.description)})}function h(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,3,"ion-label",[],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef])],null,function(t,e){t(e,2,0,vt["ɵunv"](e,2,0,vt["ɵnov"](e,3).transform("a_task_answer")))})}function _(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,6,"ion-input",[["readonly","true"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"keyup.enter"],[null,"focus"],[null,"ngModelChange"]],function(t,e,l){var n=!0,s=t.component;if("keyup.enter"===e){n=!1!==s.checkResult()&&n}if("focus"===e){n=!1!==s.setKeyboardOn(!0)&&n}if("ngModelChange"===e){n=!1!==(s.taskDetails.answer=l)&&n}return n},qt.b,qt.a)),vt["ɵdid"](671744,null,0,Ft.h,[[8,null],[8,null],[8,null],[8,null]],{isDisabled:[0,"isDisabled"],model:[1,"model"],options:[2,"options"]},{update:"ngModelChange"}),vt["ɵpod"]({standalone:0}),vt["ɵprd"](2048,null,Ft.f,null,[Ft.h]),vt["ɵdid"](16384,null,0,Ft.g,[Ft.f],null,null),vt["ɵdid"](5423104,null,0,Ht.a,[Pt.a,Kt.a,zt.a,jt.a,vt.ElementRef,vt.Renderer,[2,Jt.a],[2,$t.a],[2,Ft.f],Xt.a],{disabled:[0,"disabled"],type:[1,"type"],readonly:[2,"readonly"]},{focus:"focus"}),(t()(),vt["ɵted"](null,["\n                    "]))],function(t,e){var l=e.component;t(e,1,0,l.route&&l.route.isAnswerFeedbackEnabled()&&l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed),l.taskDetails.answer,t(e,2,0,!0));t(e,5,0,l.route&&l.route.isAnswerFeedbackEnabled()&&l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed),"text","true")},function(t,e){t(e,0,0,vt["ɵnov"](e,4).ngClassUntouched,vt["ɵnov"](e,4).ngClassTouched,vt["ɵnov"](e,4).ngClassPristine,vt["ɵnov"](e,4).ngClassDirty,vt["ɵnov"](e,4).ngClassValid,vt["ɵnov"](e,4).ngClassInvalid,vt["ɵnov"](e,4).ngClassPending)})}function k(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,4,"ion-input",[["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"]],function(t,e,l){var n=!0;if("ngModelChange"===e){n=!1!==(t.component.taskDetails.answer=l)&&n}return n},qt.b,qt.a)),vt["ɵdid"](671744,null,0,Ft.h,[[8,null],[8,null],[8,null],[8,null]],{isDisabled:[0,"isDisabled"],model:[1,"model"]},{update:"ngModelChange"}),vt["ɵprd"](2048,null,Ft.f,null,[Ft.h]),vt["ɵdid"](16384,null,0,Ft.g,[Ft.f],null,null),vt["ɵdid"](5423104,null,0,Ht.a,[Pt.a,Kt.a,zt.a,jt.a,vt.ElementRef,vt.Renderer,[2,Jt.a],[2,$t.a],[2,Ft.f],Xt.a],{disabled:[0,"disabled"],type:[1,"type"]},null)],function(t,e){var l=e.component;t(e,1,0,l.route&&l.route.isAnswerFeedbackEnabled()&&l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed),l.taskDetails.answer);t(e,4,0,l.route&&l.route.isAnswerFeedbackEnabled()&&l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed),"text")},function(t,e){t(e,0,0,vt["ɵnov"](e,3).ngClassUntouched,vt["ɵnov"](e,3).ngClassTouched,vt["ɵnov"](e,3).ngClassPristine,vt["ɵnov"](e,3).ngClassDirty,vt["ɵnov"](e,3).ngClassValid,vt["ɵnov"](e,3).ngClassInvalid,vt["ɵnov"](e,3).ngClassPending)})}function p(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,13,"ion-item",[["class","item item-block"]],null,null,null,Zt.b,Zt.a)),vt["ɵdid"](1097728,null,3,$t.a,[zt.a,Pt.a,vt.ElementRef,vt.Renderer,[2,Qt.a]],null,null),vt["ɵqud"](335544320,5,{contentLabel:0}),vt["ɵqud"](603979776,6,{_buttons:1}),vt["ɵqud"](603979776,7,{_icons:1}),vt["ɵdid"](16384,null,0,Yt.a,[],null,null),(t()(),vt["ɵted"](2,["\n                    "])),(t()(),vt["ɵted"](2,["\n                    "])),(t()(),vt["ɵand"](16777216,null,3,1,null,_)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](2,["\n                    "])),(t()(),vt["ɵand"](16777216,null,3,1,null,k)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](2,["\n                "]))],function(t,e){var l=e.component;t(e,9,0,"text"!=l.task.solutionType);t(e,12,0,"text"==l.task.solutionType)},null)}function f(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,2,"ion-label",[["floating",""]],null,null,null,null,null)),vt["ɵdid"](16384,[[8,4]],0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,""],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""]))],null,function(t,e){t(e,2,0,e.parent.context.$implicit.name)})}function g(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,4,"ion-label",[["floating",""]],null,null,null,null,null)),vt["ɵdid"](16384,[[8,4]],0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,""],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpod"]({index:0}),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef])],null,function(t,e){t(e,2,0,vt["ɵunv"](e,2,0,vt["ɵnov"](e,4).transform("a_task_set_answer",t(e,3,0,e.parent.context.index+1))))})}function v(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,22,"ion-item",[["class","item item-block"]],null,null,null,Zt.b,Zt.a)),vt["ɵdid"](278528,null,0,Nt.i,[vt.IterableDiffers,vt.KeyValueDiffers,vt.ElementRef,vt.Renderer],{ngClass:[0,"ngClass"]},null),vt["ɵpod"]({"is-focused":0}),vt["ɵdid"](1097728,null,3,$t.a,[zt.a,Pt.a,vt.ElementRef,vt.Renderer,[2,Qt.a]],null,null),vt["ɵqud"](603979776,8,{contentLabel:0}),vt["ɵqud"](603979776,9,{_buttons:1}),vt["ɵqud"](603979776,10,{_icons:1}),vt["ɵdid"](16384,null,0,Yt.a,[],null,null),(t()(),vt["ɵted"](2,["\n                        "])),(t()(),vt["ɵand"](16777216,null,1,1,null,f)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](2,["\n                        "])),(t()(),vt["ɵand"](16777216,null,1,1,null,g)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](2,["\n                        "])),(t()(),vt["ɵeld"](0,null,3,6,"ion-input",[["readonly","true"],["type","text"]],[[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"keyup.enter"],[null,"focus"],[null,"ngModelChange"]],function(t,e,l){var n=!0,s=t.component;if("keyup.enter"===e){n=!1!==s.checkResult()&&n}if("focus"===e){n=!1!==s.setKeyboardOn(!0,t.context.index)&&n}if("ngModelChange"===e){n=!1!==(t.context.$implicit.answer=l)&&n}return n},qt.b,qt.a)),vt["ɵdid"](671744,null,0,Ft.h,[[8,null],[8,null],[8,null],[8,null]],{isDisabled:[0,"isDisabled"],model:[1,"model"],options:[2,"options"]},{update:"ngModelChange"}),vt["ɵpod"]({standalone:0}),vt["ɵprd"](2048,null,Ft.f,null,[Ft.h]),vt["ɵdid"](16384,null,0,Ft.g,[Ft.f],null,null),vt["ɵdid"](5423104,null,0,Ht.a,[Pt.a,Kt.a,zt.a,jt.a,vt.ElementRef,vt.Renderer,[2,Jt.a],[2,$t.a],[2,Ft.f],Xt.a],{disabled:[0,"disabled"],type:[1,"type"],readonly:[2,"readonly"]},{focus:"focus"}),(t()(),vt["ɵted"](null,["\n                        "])),(t()(),vt["ɵted"](2,["\n                    "]))],function(t,e){var l=e.component;t(e,1,0,t(e,2,0,l.answerIndex==e.context.index&&l.keyboardVisible()));t(e,10,0,"set"!==l.task.solutionType);t(e,13,0,"set"===l.task.solutionType);t(e,16,0,e.context.$implicit.solved||l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed),e.context.$implicit.answer,t(e,17,0,!0));t(e,20,0,e.context.$implicit.solved||l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed),"text","true")},function(t,e){t(e,15,0,vt["ɵnov"](e,19).ngClassUntouched,vt["ɵnov"](e,19).ngClassTouched,vt["ɵnov"](e,19).ngClassPristine,vt["ɵnov"](e,19).ngClassDirty,vt["ɵnov"](e,19).ngClassValid,vt["ɵnov"](e,19).ngClassInvalid,vt["ɵnov"](e,19).ngClassPending)})}function m(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,5,"ion-list",[["class","vector-input-list"]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,te.a,[Pt.a,vt.ElementRef,vt.Renderer,Kt.a,ee.l,Xt.a],null,null),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵand"](16777216,null,null,1,null,v)),vt["ɵdid"](802816,null,0,Nt.j,[vt.ViewContainerRef,vt.TemplateRef,vt.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(t()(),vt["ɵted"](null,["\n                "]))],function(t,e){t(e,4,0,e.component.taskDetails.answerMultipleChoice)},null)}function b(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,10,"ion-item",[["class","item item-block"]],null,null,null,Zt.b,Zt.a)),vt["ɵdid"](1097728,null,3,$t.a,[zt.a,Pt.a,vt.ElementRef,vt.Renderer,[2,Qt.a]],null,null),vt["ɵqud"](335544320,11,{contentLabel:0}),vt["ɵqud"](603979776,12,{_buttons:1}),vt["ɵqud"](603979776,13,{_icons:1}),vt["ɵdid"](16384,null,0,Yt.a,[],null,null),(t()(),vt["ɵted"](2,["\n                    "])),(t()(),vt["ɵeld"](0,null,2,2,"p",[["class","blankContainer"]],[[8,"id",0]],null,null,null,null)),vt["ɵdid"](278528,null,0,Nt.i,[vt.IterableDiffers,vt.KeyValueDiffers,vt.ElementRef,vt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),vt["ɵpod"]({disabled:0}),(t()(),vt["ɵted"](2,["\n                "]))],function(t,e){var l=e.component;t(e,8,0,"blankContainer",t(e,9,0,l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed)))},function(t,e){t(e,7,0,vt["ɵinlineInterpolate"](1,"blankContainer_",e.component.task.id,""))})}function D(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,17,"ion-item",[["class","item item-block"]],null,null,null,Zt.b,Zt.a)),vt["ɵdid"](1097728,[[2,4],["multipleChoiceAnswers",4]],3,$t.a,[zt.a,Pt.a,vt.ElementRef,vt.Renderer,[2,Qt.a]],null,null),vt["ɵqud"](335544320,14,{contentLabel:0}),vt["ɵqud"](603979776,15,{_buttons:1}),vt["ɵqud"](603979776,16,{_icons:1}),vt["ɵdid"](16384,null,0,Yt.a,[],null,null),(t()(),vt["ɵted"](2,["\n                        "])),(t()(),vt["ɵeld"](0,null,0,5,"ion-checkbox",[],[[2,"checkbox-disabled",null],[2,"ng-untouched",null],[2,"ng-touched",null],[2,"ng-pristine",null],[2,"ng-dirty",null],[2,"ng-valid",null],[2,"ng-invalid",null],[2,"ng-pending",null]],[[null,"ngModelChange"],[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==vt["ɵnov"](t,8)._click(l)&&n}if("ngModelChange"===e){n=!1!==(t.context.$implicit.userChecked=l)&&n}return n},le.b,le.a)),vt["ɵdid"](1228800,null,0,ne.a,[Pt.a,zt.a,[2,$t.a],vt.ElementRef,vt.Renderer],{disabled:[0,"disabled"]},null),vt["ɵprd"](1024,null,Ft.e,function(t){return[t]},[ne.a]),vt["ɵdid"](671744,null,0,Ft.h,[[8,null],[8,null],[8,null],[2,Ft.e]],{isDisabled:[0,"isDisabled"],model:[1,"model"]},{update:"ngModelChange"}),vt["ɵprd"](2048,null,Ft.f,null,[Ft.h]),vt["ɵdid"](16384,null,0,Ft.g,[Ft.f],null,null),(t()(),vt["ɵted"](2,["\n                        "])),(t()(),vt["ɵeld"](0,null,1,2,"ion-label",[["class","multi-choice-label"],["tappable",""],["text-wrap",""]],null,null,null,null,null)),vt["ɵdid"](16384,[[14,4]],0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),(t()(),vt["ɵted"](2,["\n                    "]))],function(t,e){var l=e.component;t(e,8,0,l.route&&l.route.isAnswerFeedbackEnabled()&&l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed));t(e,10,0,l.route&&l.route.isAnswerFeedbackEnabled()&&l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed),e.context.$implicit.userChecked)},function(t,e){t(e,7,0,vt["ɵnov"](e,8)._disabled,vt["ɵnov"](e,12).ngClassUntouched,vt["ɵnov"](e,12).ngClassTouched,vt["ɵnov"](e,12).ngClassPristine,vt["ɵnov"](e,12).ngClassDirty,vt["ɵnov"](e,12).ngClassValid,vt["ɵnov"](e,12).ngClassInvalid,vt["ɵnov"](e,12).ngClassPending);t(e,16,0,e.context.$implicit.value)})}function T(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,5,"ion-list",[],null,null,null,null,null)),vt["ɵdid"](16384,null,0,te.a,[Pt.a,vt.ElementRef,vt.Renderer,Kt.a,ee.l,Xt.a],null,null),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵand"](16777216,null,null,1,null,D)),vt["ɵdid"](802816,null,0,Nt.j,[vt.ViewContainerRef,vt.TemplateRef,vt.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(t()(),vt["ɵted"](null,["\n                "]))],function(t,e){t(e,4,0,e.component.multipleChoiceList)},null)}function S(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,16,"div",[["class","answer"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,h)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,p)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,m)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,b)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,T)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n            "]))],function(t,e){var l=e.component;t(e,3,0,l.task&&"gps"!=l.task.solutionType&&l.route.isAnswerValidationEnabled());t(e,6,0,l.task&&!l.isSpecialTaskType&&l.route.isAnswerValidationEnabled()&&l.taskDetails&&(!l.subTasksRequired||!l.task.subtasks||l.rootTask||l.task.subtasks.length===l.solvedSubtasks.length));t(e,9,0,l.task&&("vector_values"===l.task.solutionType||"vector_intervals"===l.task.solutionType||"set"===l.task.solutionType)&&l.taskDetails&&l.route.isAnswerValidationEnabled()&&(!l.subTasksRequired||!l.task.subtasks||l.rootTask||l.task.subtasks.length===l.solvedSubtasks.length));t(e,12,0,l.task&&"blanks"===l.task.solutionType&&(!l.subTasksRequired||!l.task.subtasks||l.rootTask||l.task.subtasks.length===l.solvedSubtasks.length));t(e,15,0,l.task&&"multiple_choice"==l.task.solutionType&&l.multipleChoiceList&&l.route.isAnswerValidationEnabled()&&(!l.subTasksRequired||!l.task.subtasks||l.rootTask||l.task.subtasks.length===l.solvedSubtasks.length))},null)}function y(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","round"],["src","./assets/icons/icon_hint-activated.svg"]],null,null,null,null,null))],null,null)}function w(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","round used"],["src","./assets/icons/icon_hint-activated-used.svg"]],null,null,null,null,null))],null,null)}function E(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,8,"button",[["class","hint"],["color","primary"],["icon-only",""],["ion-button",""],["round",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.showHint(1)&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵand"](16777216,null,0,1,null,y)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵand"](16777216,null,0,1,null,w)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](0,["\n                            "]))],function(t,e){var l=e.component;t(e,1,0,"primary","");t(e,4,0,!l.taskDetails.hint1);t(e,7,0,l.taskDetails.hint1)},function(t,e){t(e,0,0,!1)})}function R(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","round"],["src","./assets/icons/icon_hint-activated.svg"]],null,null,null,null,null))],null,null)}function M(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","round used"],["src","./assets/icons/icon_hint-activated-used.svg"]],null,null,null,null,null))],null,null)}function C(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","round"],["src","./assets/icons/icon_hint-deactivated.svg"]],null,null,null,null,null))],null,null)}function I(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,11,"button",[["class","hint"],["color","primary"],["icon-only",""],["ion-button",""],["round",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.showHint(2)&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵand"](16777216,null,0,1,null,R)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵand"](16777216,null,0,1,null,M)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵand"](16777216,null,0,1,null,C)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](0,["\n                            "]))],function(t,e){var l=e.component;t(e,1,0,"primary","");t(e,4,0,l.taskDetails.hint1&&!l.taskDetails.hint2);t(e,7,0,l.taskDetails.hint1&&l.taskDetails.hint2);t(e,10,0,!l.taskDetails.hint1)},function(t,e){t(e,0,0,!e.component.taskDetails.hint1)})}function L(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","round"],["src","./assets/icons/icon_hint-activated.svg"]],null,null,null,null,null))],null,null)}function O(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","round used"],["src","./assets/icons/icon_hint-activated-used.svg"]],null,null,null,null,null))],null,null)}function A(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","round"],["src","./assets/icons/icon_hint-deactivated.svg"]],null,null,null,null,null))],null,null)}function x(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,11,"button",[["class","hint"],["color","primary"],["icon-only",""],["ion-button",""],["round",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.showHint(3)&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵand"](16777216,null,0,1,null,L)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵand"](16777216,null,0,1,null,O)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵand"](16777216,null,0,1,null,A)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](0,["\n                            "]))],function(t,e){var l=e.component;t(e,1,0,"primary","");t(e,4,0,l.taskDetails.hint1&&l.taskDetails.hint2&&!l.taskDetails.hint3);t(e,7,0,l.taskDetails.hint1&&l.taskDetails.hint2&&l.taskDetails.hint3);t(e,10,0,!l.taskDetails.hint2)},function(t,e){t(e,0,0,!e.component.taskDetails.hint2)})}function P(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,11,"ion-col",[["class","col"]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,ae.a,[],null,null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,E)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,I)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,x)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                        "]))],function(t,e){var l=e.component;t(e,4,0,l.task.hasHintMessage(1));t(e,7,0,l.task.hasHintMessage(2));t(e,10,0,l.task.hasHintMessage(3))},null)}function U(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,3,"button",[["ion-button",""],["round",""],["small",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.checkResult()&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{small:[0,"small"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                ","\n                            "])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef])],function(t,e){t(e,1,0,"","")},function(t,e){var l=e.component;t(e,0,0,!((l.isDecimal(l.taskDetails.answer)||"range"!=l.task.solutionType&&"value"!=l.task.solutionType)&&("multiple_choice"==l.task.solutionType||l.isSpecialTypeAnswered()||l.taskDetails.answer||"gps"==l.task.solutionType&&null!=l.taskDetailMap&&l.taskDetailMap.areAllPointsSet())));t(e,2,0,vt["ɵunv"](e,2,0,vt["ɵnov"](e,3).transform("a_btn_check_answer")))})}function B(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,5,"ion-col",[["class","col"]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,ae.a,[],null,null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,U)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                        "]))],function(t,e){var l=e.component;t(e,4,0,l.task&&l.taskDetails&&!l.taskDetails.solved&&!l.taskDetails.solvedLow&&!l.taskDetails.failed&&(!l.subTasksRequired||!l.task.subtasks||l.rootTask||l.task.subtasks.length===l.solvedSubtasks.length))},null)}function K(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,3,"button",[["ion-button",""],["round",""],["small",""]],null,[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.completeTask()&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{small:[0,"small"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                ","\n                            "])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef])],function(t,e){t(e,1,0,"","")},function(t,e){t(e,2,0,vt["ɵunv"](e,2,0,vt["ɵnov"](e,3).transform("a_task_complete")))})}function N(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,5,"ion-col",[["class","col"]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,ae.a,[],null,null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,K)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                        "]))],function(t,e){var l=e.component;t(e,4,0,l.task&&l.taskDetails&&!l.taskDetails.solved&&!l.taskDetails.solvedLow&&!l.taskDetails.failed)},null)}function V(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,3,"button",[["ion-button",""],["round",""],["small",""]],[[8,"disabled",0]],[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.checkResult()&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{small:[0,"small"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                ","\n                            "])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef])],function(t,e){t(e,1,0,"","")},function(t,e){var l=e.component;t(e,0,0,!((l.isDecimal(l.taskDetails.answer)||"range"!=l.task.solutionType&&"value"!=l.task.solutionType)&&("multiple_choice"==l.task.solutionType||l.taskDetails.answer||"gps"==l.task.solutionType&&null!=l.taskDetailMap&&l.taskDetailMap.areAllPointsSet()||l.isSpecialTypeAnswered())));t(e,2,0,vt["ɵunv"](e,2,0,vt["ɵnov"](e,3).transform("p_save")))})}function G(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,5,"ion-col",[["class","col"]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,ae.a,[],null,null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,V)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                        "]))],function(t,e){var l=e.component;t(e,4,0,l.task&&l.taskDetails)},null)}function W(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","primary"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.showSolutionSample()&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/icon_show_sample_salution.svg"]],null,null,null,null,null)),(t()(),vt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"primary","")},null)}function q(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","danger"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.openSubtask()&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/subtask_icon.svg"]],null,null,null,null,null)),(t()(),vt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"danger","")},null)}function F(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","danger"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.closeDetails()&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/task_icon.svg"]],null,null,null,null,null)),(t()(),vt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"danger","")},null)}function H(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","danger"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.confirmSkippingTask()&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/icon_skip.svg"]],null,null,null,null,null)),(t()(),vt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"danger","")},null)}function z(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","danger"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.closeDetails(!1)&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/icon_skip.svg"]],null,null,null,null,null)),(t()(),vt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"danger","")},null)}function j(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,4,"button",[["class","hint"],["color","danger"],["icon-only",""],["ion-button",""],["round",""]],null,[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.goToNextSubtask()&&n}return n},se.b,se.a)),vt["ɵdid"](1097728,null,0,ie.a,[[8,""],Pt.a,vt.ElementRef,vt.Renderer],{color:[0,"color"],round:[1,"round"]},null),(t()(),vt["ɵted"](0,["\n                                "])),(t()(),vt["ɵeld"](0,null,0,0,"img",[["class","round"],["src","./assets/icons/icon_skip.svg"]],null,null,null,null,null)),(t()(),vt["ɵted"](0,["\n                            "]))],function(t,e){t(e,1,0,"danger","")},null)}function J(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,48,"div",[["class","on-the-edge-container"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵeld"](0,null,null,45,"ion-grid",[["class","grid"],["no-padding",""]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,oe.a,[],null,null),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵeld"](0,null,null,41,"ion-row",[["class","row"]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,re.a,[],null,null),(t()(),vt["ɵted"](null,["\n                        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,P)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n\n                        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,B)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n\n                        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,N)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n\n                        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,G)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n\n                        "])),(t()(),vt["ɵeld"](0,null,null,25,"ion-col",[["class","col"]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,ae.a,[],null,null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,W)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,q)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,F)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,H)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,z)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵted"](null,["\n                            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,j)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                        "])),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵted"](null,["\n\n            "]))],function(t,e){var l=e.component;t(e,9,0,l.route.isHintsEnabled()&&l.task&&(!l.subTasksRequired||!l.task.subtasks||l.rootTask||l.task.subtasks.length===l.solvedSubtasks.length));t(e,12,0,l.route&&l.route.isAnswerFeedbackEnabled()&&l.route.isAnswerValidationEnabled()&&l.task&&"info"!=l.task.solutionType);t(e,15,0,l.route&&l.route.isAnswerFeedbackEnabled()&&!l.route.isAnswerValidationEnabled()||l.task&&"info"==l.task.solutionType&&(!l.subTasksRequired||!l.task.subtasks||l.rootTask||l.task.subtasks.length===l.solvedSubtasks.length));t(e,18,0,l.route&&!l.route.isAnswerFeedbackEnabled()&&l.task&&"info"!=l.task.solutionType&&(!l.subTasksRequired||!l.task.subtasks||l.rootTask||l.task.subtasks.length===l.solvedSubtasks.length));t(e,24,0,l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed)&&l.route.isSampleSolutionEnabled()&&l.route.isAnswerFeedbackEnabled()&&"info"!==l.task.solutionType);t(e,28,0,l.task.subtasks&&l.task.subtasks.length!==l.solvedSubtasks.length&&l.task&&l.taskDetails&&!l.taskDetails.solved&&!l.taskDetails.solvedLow&&!l.taskDetails.failed);t(e,32,0,l.rootTask&&l.task);t(e,36,0,l.task&&l.taskDetails&&"info"!==l.task.solutionType&&!l.taskDetails.solved&&!l.taskDetails.solvedLow&&!l.taskDetails.failed&&(!l.rootTask||!l.subTasksRequired||l.rootTask&&l.subTasksRequired&&l.taskDetails.tries>=2));t(e,40,0,!l.rootTask&&l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed));t(e,44,0,l.rootTask&&l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||l.taskDetails.failed))},null)}function $(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,7,"ion-label",[["class","answer_container"]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef]),(t()(),vt["ɵeld"](0,null,null,3,"span",[["class","answer"]],null,null,null,null,null)),vt["ɵdid"](278528,null,0,Nt.i,[vt.IterableDiffers,vt.KeyValueDiffers,vt.ElementRef,vt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),vt["ɵpod"]({perfect:0,good:1,failed:2,saved:3}),(t()(),vt["ɵted"](null,["",""]))],function(t,e){var l=e.component;t(e,5,0,"answer",t(e,6,0,e.parent.context.$implicit.solved&&l.route.isAnswerFeedbackEnabled(),e.parent.context.$implicit.solvedLow&&l.route.isAnswerFeedbackEnabled(),e.parent.context.$implicit.failed&&l.route.isAnswerFeedbackEnabled(),!l.route.isAnswerFeedbackEnabled()))},function(t,e){t(e,2,0,vt["ɵunv"](e,2,0,vt["ɵnov"](e,3).transform("a_task_score")));t(e,7,0,e.parent.context.$implicit.score)})}function X(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,37,"div",[["class","accordion"]],null,null,null,null,null)),vt["ɵdid"](278528,null,0,Nt.i,[vt.IterableDiffers,vt.KeyValueDiffers,vt.ElementRef,vt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),vt["ɵpod"]({open:0}),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵeld"](0,null,null,10,"div",[["class","accordion_title"]],null,[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.changeSubtaskAccordionState(t.context.$implicit.taskId)&&n}return n},null,null)),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵeld"](0,null,null,1,"p",[["class","task_name"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["#"," ",""])),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵeld"](0,null,null,2,"div",[["class","rating_container"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                        "])),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","accordion_arrow"],["src","./assets/icons/subtask_arrow.svg"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵeld"](0,null,null,20,"div",[["class","accordion_content"]],null,[[null,"click"]],function(t,e,l){var n=!0;if("click"===e){n=!1!==t.component.openSubtask(t.context.index)&&n}return n},null,null)),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵeld"](0,null,null,3,"span",[["class","description"]],null,null,null,null,null)),vt["ɵdid"](278528,null,0,Nt.i,[vt.IterableDiffers,vt.KeyValueDiffers,vt.ElementRef,vt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),vt["ɵpod"]({compact:0}),(t()(),vt["ɵted"](null,["",""])),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵeld"](0,null,null,7,"ion-label",[["class","answer_container"]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef]),(t()(),vt["ɵeld"](0,null,null,3,"span",[["class","answer"]],null,null,null,null,null)),vt["ɵdid"](278528,null,0,Nt.i,[vt.IterableDiffers,vt.KeyValueDiffers,vt.ElementRef,vt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),vt["ɵpod"]({perfect:0,good:1,failed:2,saved:3}),(t()(),vt["ɵted"](null,["",""])),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵand"](16777216,null,null,1,null,$)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵeld"](0,null,null,0,"img",[["class","subtask-inner-arrow"],["src","./assets/icons/subtask_arrow.svg"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵted"](null,["\n            "]))],function(t,e){var l=e.component;t(e,1,0,"accordion",t(e,2,0,-1!=l.activeAccordions.indexOf(e.context.$implicit.taskId)));t(e,19,0,"description",t(e,20,0,l.subTasksRequired));t(e,28,0,"answer",t(e,29,0,e.context.$implicit.solved&&l.route.isAnswerFeedbackEnabled(),e.context.$implicit.solvedLow&&l.route.isAnswerFeedbackEnabled(),e.context.$implicit.failed&&l.route.isAnswerFeedbackEnabled(),!l.route.isAnswerFeedbackEnabled()));t(e,33,0,l.subTasksRequired)},function(t,e){var l=e.component;t(e,7,0,e.context.index+1,l.task.getSubtasksInOrder()[e.context.index].title);t(e,21,0,l.task.getSubtasksInOrder()[e.context.index].description);t(e,25,0,vt["ɵunv"](e,25,0,vt["ɵnov"](e,26).transform("a_task_answer")));t(e,30,0,e.context.$implicit.answer)})}function Z(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,9,"div",[["class","card subtasks"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n            "])),(t()(),vt["ɵeld"](0,null,null,3,"ion-label",[],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef]),(t()(),vt["ɵted"](null,["\n            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,X)),vt["ɵdid"](802816,null,0,Nt.j,[vt.ViewContainerRef,vt.TemplateRef,vt.IterableDiffers],{ngForOf:[0,"ngForOf"]},null),(t()(),vt["ɵted"](null,["\n        "]))],function(t,e){t(e,8,0,e.component.solvedSubtasks)},function(t,e){t(e,4,0,vt["ɵunv"](e,4,0,vt["ɵnov"](e,5).transform("a_solved_subtasks")))})}function Q(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,5,"div",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                        "])),(t()(),vt["ɵeld"](0,null,null,2,"ion-label",[["text-wrap",""]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),(t()(),vt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,4,0,e.component.route.getNarrativeString("a_alert_congrats"))})}function Y(t){return vt["ɵvid"](0,[(t()(),vt["ɵted"](null,["\n                        "])),(t()(),vt["ɵeld"](0,null,null,3,"ion-label",[["text-wrap",""]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef]),(t()(),vt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,3,0,vt["ɵunv"](e,3,0,vt["ɵnov"](e,4).transform("a_alert_congrats")))})}function tt(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,6,"div",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵand"](16777216,null,null,1,null,Q)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵand"](0,[["elseBlock",2]],null,0,null,Y)),(t()(),vt["ɵted"](null,["\n                "]))],function(t,e){var l=e.component;t(e,3,0,l.route.isNarrativeEnabled()&&l.route.hasNarrativeString("a_alert_congrats"),vt["ɵnov"](e,5))},null)}function et(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,5,"div",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                        "])),(t()(),vt["ɵeld"](0,null,null,2,"ion-label",[["text-wrap",""]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),(t()(),vt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,4,0,e.component.route.getNarrativeString("good_luck_next_time"))})}function lt(t){return vt["ɵvid"](0,[(t()(),vt["ɵted"](null,["\n                        "])),(t()(),vt["ɵeld"](0,null,null,3,"ion-label",[["text-wrap",""]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef]),(t()(),vt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,3,0,vt["ɵunv"](e,3,0,vt["ɵnov"](e,4).transform("good_luck_next_time")))})}function nt(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,6,"div",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵand"](16777216,null,null,1,null,et)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵand"](0,[["elseBlock",2]],null,0,null,lt)),(t()(),vt["ɵted"](null,["\n                "]))],function(t,e){var l=e.component;t(e,3,0,l.route.isNarrativeEnabled()&&l.route.hasNarrativeString("good_luck_next_time"),vt["ɵnov"](e,5))},null)}function st(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,5,"div",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                        "])),(t()(),vt["ɵeld"](0,null,null,2,"ion-label",[["text-wrap",""]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),(t()(),vt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,4,0,e.component.route.getNarrativeString("a_alert_congrats"))})}function it(t){return vt["ɵvid"](0,[(t()(),vt["ɵted"](null,["\n                        "])),(t()(),vt["ɵeld"](0,null,null,3,"ion-label",[["text-wrap",""]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef]),(t()(),vt["ɵted"](null,["\n                    "]))],null,function(t,e){t(e,3,0,vt["ɵunv"](e,3,0,vt["ɵnov"](e,4).transform("a_alert_congrats")))})}function at(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,6,"div",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵand"](16777216,null,null,1,null,st)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵand"](0,[["elseBlock",2]],null,0,null,it)),(t()(),vt["ɵted"](null,["\n                "]))],function(t,e){var l=e.component;t(e,3,0,l.route.isNarrativeEnabled()&&l.route.hasNarrativeString("a_alert_congrats"),vt["ɵnov"](e,5))},null)}function ot(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,2,"ion-label",[["class","tag score"]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["+ ",""]))],null,function(t,e){t(e,2,0,e.component.taskDetails.score)})}function rt(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,13,"div",[["class","head"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,tt)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,nt)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,at)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,ot)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n            "]))],function(t,e){var l=e.component;t(e,3,0,((null==l.taskDetails?null:l.taskDetails.solved)||(null==l.taskDetails?null:l.taskDetails.solvedLow))&&l.route.isAnswerFeedbackEnabled()&&l.task&&"info"!==l.task.solutionType);t(e,6,0,(null==l.taskDetails?null:l.taskDetails.failed)&&l.route.isAnswerFeedbackEnabled()&&l.task&&"info"!==l.task.solutionType);t(e,9,0,l.taskDetails.saved&&!l.route.isAnswerFeedbackEnabled()&&l.task&&"info"!==l.task.solutionType);t(e,12,0,l.route.isAnswerFeedbackEnabled()&&!l.gamificationIsDisabled&&l.taskDetails&&(l.taskDetails.score||0==l.taskDetails.score))},null)}function ut(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,6,"div",[["class","card evaluation"]],null,null,null,null,null)),vt["ɵdid"](278528,null,0,Nt.i,[vt.IterableDiffers,vt.KeyValueDiffers,vt.ElementRef,vt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),vt["ɵpod"]({saved:0,perfect:1,good:2,failed:3}),(t()(),vt["ɵted"](null,["\n            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,rt)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n        "]))],function(t,e){var l=e.component;t(e,1,0,"card evaluation",t(e,2,0,null==l.taskDetails?null:l.taskDetails.saved,(null==l.taskDetails?null:l.taskDetails.solved)&&l.route.isAnswerFeedbackEnabled(),(null==l.taskDetails?null:l.taskDetails.solvedLow)&&l.route.isAnswerFeedbackEnabled(),(null==l.taskDetails?null:l.taskDetails.failed)&&l.route.isAnswerFeedbackEnabled()));t(e,5,0,"info"!==l.task.solutionType)},null)}function ct(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"div",[["id","keyboard-anchor"]],null,null,null,null,null))],null,null)}function dt(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,0,"div",[["id","snd-keyboard-anchor"]],null,null,null,null,null))],null,null)}function ht(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,5,"div",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵeld"](0,null,null,2,"ion-label",[["text-wrap",""]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),(t()(),vt["ɵted"](null,["\n                "]))],null,function(t,e){t(e,4,0,e.component.route.getNarrativeString("a_did_you_know"))})}function _t(t){return vt["ɵvid"](0,[(t()(),vt["ɵted"](null,["\n                    "])),(t()(),vt["ɵeld"](0,null,null,3,"ion-label",[["text-wrap",""]],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef]),(t()(),vt["ɵted"](null,["\n                "]))],null,function(t,e){t(e,3,0,vt["ɵunv"](e,3,0,vt["ɵnov"](e,4).transform("a_did_you_know")))})}function kt(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,1,"p",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n\t\t\t    ","\n\t\t    "]))],null,function(t,e){t(e,1,0,e.component.task.getSideFactsText())})}function pt(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,9,"div",[["class","card secondary"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,ht)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"],ngIfElse:[1,"ngIfElse"]},null),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](0,[["elseBlock",2]],null,0,null,_t)),(t()(),vt["ɵted"](null,["\n\t\t    "])),(t()(),vt["ɵand"](16777216,null,null,1,null,kt)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n\t    "]))],function(t,e){var l=e.component;t(e,3,0,l.route.isNarrativeEnabled()&&l.route.hasNarrativeString("a_did_you_know"),vt["ɵnov"](e,5));t(e,8,0,l.task)},null)}function ft(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,11,"div",[["class","card secondary"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n            "])),(t()(),vt["ɵeld"](0,null,null,3,"ion-label",[],null,null,null,null,null)),vt["ɵdid"](16384,null,0,Vt.a,[Pt.a,vt.ElementRef,vt.Renderer,[8,null],[8,null],[8,null],[8,null]],null,null),(t()(),vt["ɵted"](null,["",""])),vt["ɵpid"](131072,Gt.a,[Wt.a,vt.ChangeDetectorRef]),(t()(),vt["ɵted"](null,["\n            "])),(t()(),vt["ɵeld"](0,null,null,3,"p",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                ",""])),(t()(),vt["ɵeld"](0,null,null,0,"br",[],null,null,null,null,null)),(t()(),vt["ɵted"](null,[" ","\n            "])),(t()(),vt["ɵted"](null,["\n        "]))],null,function(t,e){var l=e.component;t(e,4,0,vt["ɵunv"](e,4,0,vt["ɵnov"](e,5).transform("author")));t(e,8,0,l.task.author);t(e,10,0,l.task.mail)})}function gt(t){return vt["ɵvid"](0,[vt["ɵpid"](0,Nt.e,[vt.LOCALE_ID]),vt["ɵqud"](402653184,1,{content:0}),vt["ɵqud"](671088640,2,{multipleChoiceView:1}),(t()(),vt["ɵeld"](0,null,null,1,"mcm-header",[],null,null,null,ue.b,ue.a)),vt["ɵdid"](114688,null,0,ce.a,[de.a,he.a,_e.a,ke.a,pe.a,fe.a],null,null),(t()(),vt["ɵted"](null,["\n"])),(t()(),vt["ɵeld"](0,null,null,67,"ion-content",[["class","has-header padding bottom"],["no-bounce",""]],[[2,"statusbar-padding",null],[2,"has-refresher",null]],null,null,ge.b,ge.a)),vt["ɵdid"](278528,null,0,Nt.i,[vt.IterableDiffers,vt.KeyValueDiffers,vt.ElementRef,vt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),vt["ɵdid"](4374528,[[1,4]],0,Jt.a,[Pt.a,Kt.a,Xt.a,vt.ElementRef,vt.Renderer,jt.a,ve.a,vt.NgZone,[2,_e.a],[2,de.a]],null,null),(t()(),vt["ɵted"](1,["\n    "])),(t()(),vt["ɵeld"](0,null,1,12,"div",[["class","task-header"]],null,null,null,null,null)),vt["ɵdid"](278528,null,0,Nt.i,[vt.IterableDiffers,vt.KeyValueDiffers,vt.ElementRef,vt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),vt["ɵpod"]({gps:0}),(t()(),vt["ɵted"](null,["\n        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,i)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,a)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,o)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n    "])),(t()(),vt["ɵted"](1,["\n    "])),(t()(),vt["ɵeld"](0,null,1,48,"div",[["class","task-content"]],null,null,null,null,null)),vt["ɵdid"](278528,null,0,Nt.i,[vt.IterableDiffers,vt.KeyValueDiffers,vt.ElementRef,vt.Renderer],{klass:[0,"klass"],ngClass:[1,"ngClass"]},null),vt["ɵpod"]({subtask:0}),(t()(),vt["ɵted"](null,["\n        "])),(t()(),vt["ɵeld"](0,null,null,0,"div",[["class","transition"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n        "])),(t()(),vt["ɵeld"](0,null,null,22,"div",[["class","card task has-button-on-the-edge"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n\n            "])),(t()(),vt["ɵeld"](0,null,null,10,"div",[["class","head"]],null,null,null,null,null)),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,r)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,u)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n                "])),(t()(),vt["ɵand"](16777216,null,null,1,null,c)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n            "])),(t()(),vt["ɵted"](null,["\n            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,d)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,S)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n\n            "])),(t()(),vt["ɵand"](16777216,null,null,1,null,J)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n        "])),(t()(),vt["ɵted"](null,["\n\n        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,Z)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n\n       "])),(t()(),vt["ɵted"](null,["\n        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,ut)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n\n        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,ct)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,dt)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n\t    "])),(t()(),vt["ɵand"](16777216,null,null,1,null,pt)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n        "])),(t()(),vt["ɵand"](16777216,null,null,1,null,ft)),vt["ɵdid"](16384,null,0,Nt.k,[vt.ViewContainerRef,vt.TemplateRef],{ngIf:[0,"ngIf"]},null),(t()(),vt["ɵted"](null,["\n    "])),(t()(),vt["ɵted"](1,["\n\n"])),(t()(),vt["ɵted"](null,["\n"]))],function(t,e){var l=e.component;t(e,4,0);t(e,7,0,"has-header padding bottom",l.keyboardVisible()?"mcm-keyboard-open":"");t(e,11,0,"task-header",t(e,12,0,l.task&&"gps"==l.task.solutionType));t(e,15,0,l.task&&"gps"==l.task.solutionType);t(e,18,0,l.task&&"gps"!=l.task.solutionType&&l.task.image);t(e,21,0,l.task&&!l.task.image&&l.rootTask&&l.rootTask.image&&"gps"!=l.task.solutionType);t(e,25,0,"task-content",t(e,26,0,l.rootTask));t(e,35,0,!l.rootTask);t(e,38,0,l.rootTask);t(e,41,0,l.route&&l.route.isAnswerFeedbackEnabled()&&(!l.rootTask||l.subTasksRequired)&&!l.gamificationIsDisabled);t(e,45,0,l.task);t(e,48,0,l.task&&"info"!=l.task.solutionType&&(!l.subTasksRequired||!l.task.subtasks||l.rootTask||l.task.subtasks.length===l.solvedSubtasks.length));t(e,51,0,l.taskDetails);t(e,55,0,l.task&&l.task.subtasks&&l.task.subtasks.length>0&&l.solvedSubtasks&&l.solvedSubtasks.length>0);t(e,59,0,l.route&&l.taskDetails&&(l.taskDetails.solved||l.taskDetails.solvedLow||(null==l.taskDetails?null:l.taskDetails.failed)||(null==l.taskDetails?null:l.taskDetails.saved)));t(e,62,0,!l.rootTask);t(e,65,0,l.rootTask);t(e,68,0,l.taskDetails&&l.task.hasSideFacts());t(e,71,0,l.task&&l.task.author)},function(t,e){t(e,6,0,vt["ɵnov"](e,8).statusbarPadding,vt["ɵnov"](e,8)._hasRefresher)})}Object.defineProperty(e,"__esModule",{value:!0});var vt=l(1),mt=(l(0),l(17),l(38)),bt=l(959),Dt=l(188),Tt=l(77),St=function(){return function(){}}(),yt=l(619),wt=l(620),Et=l(621),Rt=l(622),Mt=l(623),Ct=l(624),It=l(625),Lt=l(626),Ot=l(627),At=l(953),xt=l(138),Pt=l(4),Ut=l(952),Bt=l(278),Kt=l(8),Nt=l(11),Vt=l(51),Gt=l(39),Wt=l(23),qt=l(302),Ft=l(25),Ht=l(112),zt=l(28),jt=l(12),Jt=l(36),$t=l(29),Xt=l(14),Zt=l(146),Qt=l(63),Yt=l(96),te=l(147),ee=l(16),le=l(639),ne=l(148),se=l(26),ie=l(19),ae=l(97),oe=l(98),re=l(99),ue=l(279),ce=l(141),de=l(24),he=l(13),_e=l(6),ke=l(43),pe=l(50),fe=l(27),ge=l(277),ve=l(56),me=l(35),be=l(78),De=l(62),Te=l(140),Se=l(49),ye=l(42),we=vt["ɵcrt"]({encapsulation:2,styles:[],data:{}}),Ee=vt["ɵccf"]("page-task-detail",bt.a,function(t){return vt["ɵvid"](0,[(t()(),vt["ɵeld"](0,null,null,1,"page-task-detail",[],null,null,null,gt,we)),vt["ɵdid"](49152,null,0,bt.a,[de.a,he.a,me.a,pe.a,fe.a,ke.a,be.a,De.a,Te.b,Tt.a,Se.a,ye.a,vt.ChangeDetectorRef],null,null)],null,null)},{},{},[]),Re=l(276),Me=l(94);l.d(e,"TaskDetailPageModuleNgFactory",function(){return Ce});var Ce=vt["ɵcmf"](St,[],function(t){return vt["ɵmod"]([vt["ɵmpd"](512,vt.ComponentFactoryResolver,vt["ɵCodegenComponentFactoryResolver"],[[8,[yt.a,wt.a,Et.a,Rt.a,Mt.a,Ct.a,It.a,Lt.a,Ot.a,Ee]],[3,vt.ComponentFactoryResolver],vt.NgModuleRef]),vt["ɵmpd"](4608,Nt.m,Nt.l,[vt.LOCALE_ID]),vt["ɵmpd"](4608,Ft.k,Ft.k,[]),vt["ɵmpd"](4608,Ft.c,Ft.c,[]),vt["ɵmpd"](4608,Tt.a,Tt.a,[]),vt["ɵmpd"](512,Nt.b,Nt.b,[]),vt["ɵmpd"](512,Ft.j,Ft.j,[]),vt["ɵmpd"](512,Ft.d,Ft.d,[]),vt["ɵmpd"](512,Ft.i,Ft.i,[]),vt["ɵmpd"](512,Re.a,Re.a,[]),vt["ɵmpd"](512,Re.b,Re.b,[]),vt["ɵmpd"](512,mt.a,mt.a,[]),vt["ɵmpd"](512,Dt.a,Dt.a,[]),vt["ɵmpd"](512,St,St,[]),vt["ɵmpd"](256,Me.a,bt.a,[])])})},952:function(t,e,l){"use strict";function n(t){return s["ɵvid"](0,[s["ɵncd"](null,0)],null,null)}l.d(e,"a",function(){return i}),e.b=n;var s=l(1),i=s["ɵcrt"]({encapsulation:2,styles:[],data:{}})},953:function(t,e,l){"use strict";function n(t){return s["ɵvid"](2,[(t()(),s["ɵeld"](0,null,null,1,"ion-icon",[["class","fab-close-icon"],["name","close"],["role","img"]],[[2,"hide",null]],null,null,null,null)),s["ɵdid"](147456,null,0,i.a,[a.a,s.ElementRef,s.Renderer],{name:[0,"name"]},null),(t()(),s["ɵeld"](0,null,null,1,"span",[["class","button-inner"]],null,null,null,null,null)),s["ɵncd"](null,0),(t()(),s["ɵeld"](0,null,null,0,"div",[["class","button-effect"]],null,null,null,null,null))],function(t,e){t(e,1,0,"close")},function(t,e){t(e,0,0,s["ɵnov"](e,1)._hidden)})}l.d(e,"a",function(){return o}),e.b=n;var s=l(1),i=l(61),a=l(4),o=s["ɵcrt"]({encapsulation:2,styles:[],data:{}})},955:function(t,e,l){"use strict";var n,s,i;!function(a){s=[l(956),l(957)],void 0===(i="function"==typeof(n=a)?n.apply(e,s):n)||(t.exports=i)}(function(t,e){})},956:function(t,e,l){"use strict";var n,s,i;!function(a,o){s=[l(139)],void 0===(i="function"==typeof(n=a)?n.apply(e,s):n)||(t.exports=i)}(function(t){t.TileLayer.Offline=t.TileLayer.extend({initialize:function(e,l,n){this._url=e,this._tilesDb=l,(n=t.Util.setOptions(this,n)).detectRetina&&t.Browser.retina&&n.maxZoom>0&&(n.tileSize=Math.floor(n.tileSize/2),n.zoomReverse?(n.zoomOffset--,n.minZoom++):(n.zoomOffset++,n.maxZoom--),n.minZoom=Math.max(0,n.minZoom)),"string"==typeof n.subdomains&&(n.subdomains=n.subdomains.split("")),t.Browser.android||this.on("tileunload",this._onTileRemove)},createTile:function(e,l){var n=document.createElement("img");return t.DomEvent.on(n,"load",t.bind(this._tileOnLoad,this,l,n)),t.DomEvent.on(n,"error",t.bind(this._tileOnError,this,l,n)),this.options.crossOrigin&&(n.crossOrigin=""),n.alt="",n.setAttribute("role","presentation"),this.getTileUrl(e).then(function(t){n.src=t}).catch(function(t){throw t}),n},getTileUrl:function(e){var l=t.TileLayer.prototype.getTileUrl.call(this,e),n=this._getStorageKey(l);return this._tilesDb.getItem(n).then(function(t){return t&&"object"==typeof t?URL.createObjectURL(t):l}).catch(function(t){throw t})},getTileUrls:function(e,l){var n=[],s=this._url;this.setUrl(this._url.replace("{z}",l),!0);for(var i=t.bounds(e.min.divideBy(this.getTileSize().x).floor(),e.max.divideBy(this.getTileSize().x).floor()),a=i.min.x;a<=i.max.x;a++)for(var o=i.min.y;o<=i.max.y;o++){var r=new t.Point(a,o),u=t.TileLayer.prototype.getTileUrl.call(this,r);n.push({key:this._getStorageKey(u),url:u})}return this.setUrl(s,!0),n},_getStorageKey:function(t){var e=null;if(t.indexOf("{s}")){var l=new RegExp("["+this.options.subdomains.join("|")+"].");e=t.replace(l,this.options.subdomains[0]+".")}return e||t}}),t.tileLayer.offline=function(e,l,n){return new t.TileLayer.Offline(e,l,n)}},window)},957:function(t,e,l){"use strict";var n,s,i;!function(a,o){s=[l(139)],void 0===(i="function"==typeof(n=a)?n.apply(e,s):n)||(t.exports=i)}(function(t){t.Control.Offline=t.Control.extend({options:{position:"topleft",saveButtonHtml:"S",saveButtonTitle:"Save tiles",removeButtonHtml:"R",removeButtonTitle:"Remove tiles",minZoom:0,maxZoom:19,confirmSavingCallback:null,confirmRemovalCallback:null},initialize:function(e,l,n){this._baseLayer=e,this._tilesDb=l,t.Util.setOptions(this,n)},onAdd:function(e){var l=t.DomUtil.create("div","leaflet-control-offline leaflet-bar");return this._createButton(this.options.saveButtonHtml,this.options.saveButtonTitle,"save-tiles-button",l,this._saveTiles),this._createButton(this.options.removeButtonHtml,this.options.removeButtonTitle,"remove-tiles-button",l,this._removeTiles),l},_createButton:function(e,l,n,s,i){var a=t.DomUtil.create("a",n,s);return a.innerHTML=e,a.href="#",a.title=l,t.DomEvent.disableClickPropagation(a),t.DomEvent.on(a,"click",t.DomEvent.stop),t.DomEvent.on(a,"click",i,this),t.DomEvent.on(a,"click",this._refocusOnMap,this),a},_saveTiles:function(){var e=this,l=null,n=[],s=[],i=this._map.getZoom(),a=this._map.getBounds();if(i<this.options.minZoom)e._baseLayer.fire("offline:below-min-zoom-error");else{for(var o=i;o<=this.options.maxZoom;o++)n.push(o);for(var r=0;r<n.length;r++)l=t.bounds(this._map.project(a.getNorthWest(),n[r]),this._map.project(a.getSouthEast(),n[r])),s=s.concat(this._baseLayer.getTileUrls(l,n[r]));var u=function(){e._baseLayer.fire("offline:save-start",{nTilesToSave:s.length}),e._tilesDb.saveTiles(s).then(function(){e._baseLayer.fire("offline:save-end")}).catch(function(t){e._baseLayer.fire("offline:save-error",{error:t})})};this.options.confirmSavingCallback?this.options.confirmSavingCallback(s.length,u):u()}},_removeTiles:function(){var t=this,e=function(){t._baseLayer.fire("offline:remove-start"),t._tilesDb.clear().then(function(){t._baseLayer.fire("offline:remove-end")}).catch(function(e){t._baseLayer.fire("offline:remove-error",{error:e})})};t.options.confirmRemovalCallback?t.options.confirmRemovalCallback(e):e()}}),t.control.offline=function(e,l,n){return new t.Control.Offline(e,l,n)}},window)},958:function(t,e){!function(){var t=L.Marker.prototype._initIcon,e=L.Marker.prototype._setPos,l="msTransform"===L.DomUtil.TRANSFORM;L.Marker.addInitHook(function(){var t=this.options.icon&&this.options.icon.options&&this.options.icon.options.iconAnchor;t&&(t=t[0]+"px "+t[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||t||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(t){t.target._applyRotation()})}),L.Marker.include({_initIcon:function(){t.call(this)},_setPos:function(t){e.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,l?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}})}()},959:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return TaskDetail});var __WEBPACK_IMPORTED_MODULE_0_tslib__=__webpack_require__(0),__WEBPACK_IMPORTED_MODULE_1__angular_core__=__webpack_require__(1),__WEBPACK_IMPORTED_MODULE_2_ionic_angular__=__webpack_require__(17),__WEBPACK_IMPORTED_MODULE_3__services_orm_service__=__webpack_require__(35),__WEBPACK_IMPORTED_MODULE_4_ionic_angular_components_modal_modal_controller__=__webpack_require__(50),__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__=__webpack_require__(280),__WEBPACK_IMPORTED_MODULE_6__app_app_component__=__webpack_require__(140),__WEBPACK_IMPORTED_MODULE_7__task_detail_map__=__webpack_require__(961),__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__=__webpack_require__(149),__WEBPACK_IMPORTED_MODULE_9_leaflet__=__webpack_require__(139),__WEBPACK_IMPORTED_MODULE_9_leaflet___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_9_leaflet__),__WEBPACK_IMPORTED_MODULE_10_leaflet_geometryutil__=__webpack_require__(633),__WEBPACK_IMPORTED_MODULE_10_leaflet_geometryutil___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_10_leaflet_geometryutil__),__WEBPACK_IMPORTED_MODULE_11__services_modals_service__=__webpack_require__(43),__WEBPACK_IMPORTED_MODULE_12__services_gps_service__=__webpack_require__(78),__WEBPACK_IMPORTED_MODULE_13_rxjs_Subscription__=__webpack_require__(30),__WEBPACK_IMPORTED_MODULE_13_rxjs_Subscription___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_13_rxjs_Subscription__),__WEBPACK_IMPORTED_MODULE_14__services_chat_and_session_service__=__webpack_require__(62),__WEBPACK_IMPORTED_MODULE_15__ionic_native_photo_viewer__=__webpack_require__(77),__WEBPACK_IMPORTED_MODULE_16__classes_Helper__=__webpack_require__(21),__WEBPACK_IMPORTED_MODULE_17__ionic_native_spinner_dialog__=__webpack_require__(49),__WEBPACK_IMPORTED_MODULE_18__services_images_service__=__webpack_require__(42),__WEBPACK_IMPORTED_MODULE_19_js_levenshtein__=__webpack_require__(962),__WEBPACK_IMPORTED_MODULE_19_js_levenshtein___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_19_js_levenshtein__),__awaiter=this&&this.__awaiter||function(t,e,l,n){return new(l||(l=Promise))(function(s,i){function a(t){try{r(n.next(t))}catch(t){i(t)}}function o(t){try{r(n.throw(t))}catch(t){i(t)}}function r(t){t.done?s(t.value):new l(function(e){e(t.value)}).then(a,o)}r((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function l(l){return function(a){return function(l){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,s&&(i=s[2&l[0]?"return":l[0]?"throw":"next"])&&!(i=i.call(s,l[1])).done)return i;switch(s=0,i&&(l=[0,i.value]),l[0]){case 0:case 1:i=l;break;case 4:return o.label++,{value:l[1],done:!1};case 5:o.label++,s=l[1],l=[0];continue;case 7:l=o.ops.pop(),o.trys.pop();continue;default:if(i=o.trys,!(i=i.length>0&&i[i.length-1])&&(6===l[0]||2===l[0])){o=0;continue}if(3===l[0]&&(!i||l[1]>i[0]&&l[1]<i[3])){o.label=l[1];break}if(6===l[0]&&o.label<i[1]){o.label=i[1],i=l;break}if(i&&o.label<i[2]){o.label=i[2],o.ops.push(l);break}i[2]&&o.ops.pop(),o.trys.pop();continue}l=e.call(t,o)}catch(t){l=[6,t],s=0}finally{n=i=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,a])}}var n,s,i,a,o={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return a={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a},trim=__WEBPACK_IMPORTED_MODULE_9_leaflet__.Util.trim,TaskDetail=function(){function TaskDetail(t,e,l,n,s,i,a,o,r,u,c,d,h){this.navCtrl=t,this.navParams=e,this.ormService=l,this.modalCtrl=n,this.deepLinker=s,this.modalsService=i,this.gpsService=a,this.chatAndSessionService=o,this.app=r,this.photoViewer=u,this.spinnerDialog=c,this.imageService=d,this.cdRef=h,this.solvedSubtasks=[],this.activeAccordions=[],this.subTaskScore=0,this.lastSubtaskBonus=0,this.gamificationIsDisabled=!1,this.answerIndex=null,this.blankRegex=/\*\*([^*]+)\*\*/g,this.multipleChoiceList=[],this.gpsTaskButtonLabels=[],this.shownHints=[],this.subTaskModalShown=!1,this.keyboardSubscriptions=new __WEBPACK_IMPORTED_MODULE_13_rxjs_Subscription__.Subscription}return TaskDetail_1=TaskDetail,TaskDetail.prototype.subscribeCKEvents=function(){var t=this;this.keyboardSubscriptions=new __WEBPACK_IMPORTED_MODULE_13_rxjs_Subscription__.Subscription,this.keyboardSubscriptions.add(__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.onCKClick.subscribe(function(e){(0!=t.taskDetails.timeSolved||t.taskDetails.failed)&&t.route.isAnswerFeedbackEnabled()||("C"===e?null!=t.answerIndex?t.taskDetails.answerMultipleChoice[t.answerIndex].answer="":t.taskDetails.answer="":"✔"===e?t.checkResult():null!=t.answerIndex?t.taskDetails.answerMultipleChoice[t.answerIndex].answer+=e:t.taskDetails.answer+=e)},function(t){console.log(t)},function(){console.log("onCKClick subscribed.")})),this.keyboardSubscriptions.add(__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.onDeleteClick.subscribe(function(){null!=t.answerIndex?t.taskDetails.answerMultipleChoice[t.answerIndex].answer=t.taskDetails.answerMultipleChoice[t.answerIndex].answer.slice(0,t.taskDetails.answerMultipleChoice[t.answerIndex].answer.length-1):t.taskDetails.answer=t.taskDetails.answer.slice(0,t.taskDetails.answer.length-1)},function(t){console.log(t)},function(){console.log("onDeleteClick subscribed.")})),this.keyboardSubscriptions.add(__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.onCKHide.subscribe(function(){t.setKeyboardOn(!1)},function(t){console.log(t)},function(){console.log("onCKHide subscribed.")}))},TaskDetail.prototype.unsubscribeCKEvents=function(){this.keyboardSubscriptions.unsubscribe()},TaskDetail.prototype.ionViewDidEnter=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(_a){return console.log("TasksMap ionViewDidEnter()"),eval('MathJax.Hub.Queue(["Typeset", MathJax.Hub])'),[2]})})},TaskDetail.prototype.ionViewWillEnter=function(){return __awaiter(this,void 0,void 0,function(){var _this=this,_a,_b,_c,_d,_e,_i,_f,task,subtaskDetails,subtaskModal_1,subtaskModal_2,blankMatch_1,blankText,placeholderCount_1,savedAnswer,blankContainer,inputs,answers,_g,_h,input,_loop_1,_j,_k,input,answerArray,i,component,answerArray,i,_l,details,scorableTaskCount,_m,_o,task,scorableTaskCount,_p,_q,task,gpsType,points,buttonCount,startCharCode,i;return __generator(this,function(_r){switch(_r.label){case 0:return console.log("TasksMap ionViewWillEnter()"),this.routeId=this.navParams.get("routeId"),_a=this,[4,this.ormService.findRouteById(this.routeId)];case 1:return _a.route=_r.sent(),this.taskId=this.navParams.get("taskId"),this.subTaskIndex=this.navParams.get("subTaskIndex"),_b=this,[4,this.ormService.findTaskById(this.taskId)];case 2:return _b.task=_r.sent(),(this.subTaskIndex||0===this.subTaskIndex)&&(this.rootTask=this.task,this.task=this.rootTask.getSubtasksInOrder()[this.subTaskIndex]),this.subTasksRequired=this.task.isSubtaskRequired()||this.route.isSubtaskRequired(),console.log("Opened Task: ",this.task),this.isSpecialTaskType="multiple_choice"===this.task.solutionType||"gps"===this.task.solutionType||"vector_values"===this.task.solutionType||"vector_intervals"===this.task.solutionType||"set"===this.task.solutionType||"blanks"===this.task.solutionType,_c=this,_e=(_d=this.route).getScoreForUser,[4,this.ormService.getActiveUser()];case 3:if(_c.score=_e.apply(_d,[_r.sent()]),this.taskDetails=this.score.getTaskStateForTask(this.task.id),this.task.subtasks&&this.task.subtasks.length>0){for(this.solvedSubtasks=[],_i=0,_f=this.task.getSubtasksInOrder();_i<_f.length;_i++)task=_f[_i],((subtaskDetails=this.score.getTaskStateForTask(task.id)).solved||subtaskDetails.failed||subtaskDetails.solvedLow||subtaskDetails.saved||subtaskDetails.skipped)&&this.solvedSubtasks.push(subtaskDetails);this.subTasksRequired&&!this.subTaskModalShown&&this.solvedSubtasks.length!==this.task.subtasks.length?((subtaskModal_1=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{type:"text",message:0==this.solvedSubtasks.length?"a_subtaskinfo_required_message":"a_subtaskinfo_required_progress_message",modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.subtask,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[{title:"a_subtaskinfo_required_letsgo",callback:function(){subtaskModal_1.dismiss()}}]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})).present(),this.subTaskModalShown=!0):0===this.taskDetails.timeFirstOpen&&(subtaskModal_2=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{title:"a_subtaskinfo_title",type:"text",message:"a_subtaskinfo_message",modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.subtask,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[{title:"a_alert_close",callback:function(){subtaskModal_2.dismiss()}}]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})).present(),this.cdRef.detectChanges()}if("blanks"===this.task.solutionType){for(this.specialSolution=this.task.getSolution(),blankText=this.specialSolution.val,placeholderCount_1=[];null!==(blankMatch_1=this.blankRegex.exec(blankText));)savedAnswer=this.taskDetails.answerMultipleChoice&&this.taskDetails.answerMultipleChoice.length>0?this.taskDetails.answerMultipleChoice.find(function(t){return t.id===blankMatch_1[1]&&t.count==(placeholderCount_1[blankMatch_1[1]]?placeholderCount_1[blankMatch_1[1]]:0)}):null,blankText=blankText.replace(blankMatch_1[0],'<span id="'+blankMatch_1[1]+'" data-count="'+(placeholderCount_1[blankMatch_1[1]]?placeholderCount_1[blankMatch_1[1]]:"0")+'" class="blankInput '+(savedAnswer&&savedAnswer.solved||this.taskDetails&&(this.taskDetails.solved||this.taskDetails.solvedLow||this.taskDetails.failed)?"disabled":"")+'" role="textbox" contenteditable>'+(savedAnswer?savedAnswer.answer:"")+"</span>"),placeholderCount_1[blankMatch_1[1]]?placeholderCount_1[blankMatch_1[1]]++:placeholderCount_1[blankMatch_1[1]]=1;if(blankContainer=document.getElementById("blankContainer_"+this.task.id)){if(blankContainer.innerHTML=blankText,inputs=blankContainer.getElementsByClassName("blankInput"),!this.taskDetails.answerMultipleChoice||0==this.taskDetails.answerMultipleChoice.length){for(answers=[],_g=0,_h=Array.from(inputs);_g<_h.length;_g++)(input=_h[_g])instanceof HTMLElement&&answers.push({id:input.id,answer:"",solved:null,count:input.dataset.count});this.taskDetails.answerMultipleChoice=answers}for(_loop_1=function(t){t.addEventListener("input",function(e){_this.taskDetails.answerMultipleChoice.find(function(e){if(t instanceof HTMLElement)return e.id===t.id&&e.count==t.dataset.count}).answer=e.currentTarget.innerText})},_j=0,_k=Array.from(inputs);_j<_k.length;_j++)input=_k[_j],_loop_1(input)}}if("vector_values"===this.task.solutionType||"vector_intervals"===this.task.solutionType){if(this.specialSolution=this.task.getSolution(),!this.taskDetails.answerMultipleChoice||0==this.taskDetails.answerMultipleChoice.length){for(answerArray=[],i=0;i<this.specialSolution.components.length;i++)component=this.specialSolution.components[i],answerArray.push({name:component.name,answer:"",solved:null});this.taskDetails.answerMultipleChoice=answerArray}}else if("set"===this.task.solutionType&&(this.specialSolution=this.task.getSolution(),!this.taskDetails.answerMultipleChoice||0==this.taskDetails.answerMultipleChoice.length)){for(answerArray=[],i=0;i<this.specialSolution.length;i++)answerArray.push({answer:"",solved:null});this.taskDetails.answerMultipleChoice=answerArray}return _l=this,[4,this.chatAndSessionService.getActiveSession()];case 4:if(_l.sessionInfo=_r.sent(),null==this.sessionInfo||this.task||(details=JSON.stringify({title:this.task.title}),this.chatAndSessionService.addUserEvent("event_task_opened",details,this.task.id.toString())),0!=this.taskDetails.timeSolved||this.taskDetails.failed||(this.taskDetails.answer=""),this.gamificationIsDisabled=this.route.isGamificationDisabled(),!this.rootTask&&this.route.isAnswerFeedbackEnabled()&&"info"!=this.task.solutionType?(this.maxScore=100,this.orangeScore=this.maxScore/2,this.penalty=.15*Math.floor(this.maxScore),this.minScore=Math.floor(this.maxScore)/10):(this.maxScore=0,this.orangeScore=0,this.penalty=0,this.minScore=0),this.task.subtasks&&this.subTasksRequired){for(scorableTaskCount="info"===this.task.solutionType?0:1,_m=0,_o=this.task.subtasks;_m<_o.length;_m++)"info"!=(task=_o[_m]).solutionType&&scorableTaskCount++;this.subTaskScore=Math.floor(100/scorableTaskCount),"info"===this.task.solutionType?(this.maxScore=0,this.maxScore-this.subTaskScore*scorableTaskCount>0&&(this.lastSubtaskBonus=this.maxScore-this.subTaskScore*scorableTaskCount)):this.maxScore=this.subTaskScore+(this.maxScore-this.subTaskScore*scorableTaskCount),this.penalty=.15*Math.floor(this.maxScore),this.minScore=Math.floor(this.maxScore)/10}if(this.rootTask&&this.subTasksRequired&&"info"!==this.task.solutionType){for(scorableTaskCount="info"===this.rootTask.solutionType?0:1,_p=0,_q=this.rootTask.subtasks;_p<_q.length;_p++)"info"!=(task=_q[_p]).solutionType&&scorableTaskCount++;this.subTaskScore=Math.floor(100/scorableTaskCount),"info"===this.task.solutionType?this.maxScore=0:("info"===this.rootTask.solutionType&&100-this.subTaskScore*scorableTaskCount>0&&(this.lastSubtaskBonus=100-this.subTaskScore*scorableTaskCount),this.maxScore=this.subTaskScore+(this.subTaskIndex===this.rootTask.subtasks.length-1?this.lastSubtaskBonus:0)),this.orangeScore=this.maxScore/2,this.penalty=.15*Math.floor(this.maxScore),this.minScore=Math.floor(this.maxScore)/10}if(null==this.score.score&&(this.score.score=0),0==this.taskDetails.timeFirstOpen&&(this.taskDetails.timeFirstOpen=(new Date).getTime(),this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails)),"multiple_choice"==this.task.solutionType&&(this.multipleChoiceView.changes.subscribe(function(data){console.log("MultipleChoiceChildData",data),eval('MathJax.Hub.Queue(["Typeset", MathJax.Hub])')}),this.multipleChoiceList=this.taskDetails.solved||this.taskDetails.solvedLow?this.taskDetails.answerMultipleChoice:this.task.getSolutionOptionList()),"gps"==this.task.solutionType)for(this.taskDetailMap=new __WEBPACK_IMPORTED_MODULE_7__task_detail_map__.a(this.task,this.route,this.gpsService,this.app,this.ormService,this.imageService),this.taskDetailMap.loadMap(),null!=(gpsType=this.task.getSolutionGpsValue("task"))&&(points=[],"centerTwo"==gpsType&&(points=[this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2")]),"centerThree"==gpsType&&(points=[this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2"),this.task.getSolutionGpsValue("point3")]),points.length>0&&this.taskDetailMap.insertPreDefinedPoints(points),"linearFx"==gpsType&&this.taskDetailMap.insertAxis(this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2"))),buttonCount=this.task.getSolutionGpsValue("points"),buttonCount=null!=buttonCount?parseInt(buttonCount):0,startCharCode="A".charCodeAt(0),i=0;i<buttonCount;i++)this.gpsTaskButtonLabels[i]=String.fromCharCode(startCharCode+i);return this.taskDetails.skipped&&(this.taskDetails.newTries=0),"range"!=this.task.solutionType&&"value"!=this.task.solutionType&&"vector_values"!=this.task.solutionType&&"vector_intervals"!=this.task.solutionType&&"set"!==this.task.solutionType||this.subscribeCKEvents(),eval('MathJax.Hub.Queue(["Typeset", MathJax.Hub])'),[2]}})})},TaskDetail.prototype.ionViewWillLeave=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return __WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.isVisible()&&__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.hide(),"range"!=this.task.solutionType&&"value"!=this.task.solutionType&&"vector_values"!=this.task.solutionType&&"vector_intervals"!=this.task.solutionType&&"set"!==this.task.solutionType||this.unsubscribeCKEvents(),(this.taskDetails.solved||this.taskDetails.solvedLow||this.taskDetails.failed)&&this.navParams.get("goToNextTaskById")&&this.navParams.get("goToNextTaskById")(this.task.id,!1),[2]})})},TaskDetail.prototype.setKeyboardOn=function(t,e){void 0===e&&(e=null);var l=this;this.answerIndex=e,t&&"gps"!=this.task.solutionType&&__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.show(function(){l.content.scrollTo(0,l.rootTask?document.getElementById("snd-keyboard-anchor").offsetTop:document.getElementById("keyboard-anchor").offsetTop)})},TaskDetail.prototype.hideKeyboard=function(){__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.isVisible()&&__WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.hide()},TaskDetail.prototype.keyboardVisible=function(){return __WEBPACK_IMPORTED_MODULE_8__components_customKeyBoard_custom_keyboard__.a.isVisible()},TaskDetail.prototype.isDecimal=function(t){var e=t.match(/^-?(0(([.,])[0-9]+)?|[1-9]{1}[0-9]*(([.,])[0-9]+)?)/g);return null!==e&&e[0]===t},TaskDetail.prototype.showHint=function(t){return __awaiter(this,void 0,void 0,function(){var e,l,n,s,i,a,o=this;return __generator(this,function(r){switch(e=!1,l="",n=this.task.getHint(t).type,s=this.task.getHint(t).value,-1==this.shownHints.indexOf(t)&&this.shownHints.push(t),t){case 1:this.taskDetails.solved||this.taskDetails.solvedLow||this.taskDetails.failed||(this.taskDetails.hint1=!0,e=!0),l="a_btn_hint1",null!=this.sessionInfo&&(i=JSON.stringify({}),this.chatAndSessionService.addUserEvent("event_took_hint1",i,this.task.id.toString()));break;case 2:this.taskDetails.solved||this.taskDetails.solvedLow||this.taskDetails.failed||(this.taskDetails.hint2=!0,e=!0),l="a_btn_hint2",null!=this.sessionInfo&&(i=JSON.stringify({}),this.chatAndSessionService.addUserEvent("event_took_hint2",i,this.task.id.toString()));break;case 3:this.taskDetails.solved||this.taskDetails.solvedLow||this.taskDetails.failed||(this.taskDetails.hint3=!0,null!=this.sessionInfo&&(i=JSON.stringify({}),this.chatAndSessionService.addUserEvent("event_took_hint3",i,this.task.id.toString())),e=!0),l="a_btn_hint3"}return e&&this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails),(a=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{title:l,type:n,message:s,modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.hint,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[{title:"a_alert_close",callback:function(){a.dismiss()}}]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})).onDidDismiss(function(t){if(null!=o.sessionInfo){var e=JSON.stringify({});o.chatAndSessionService.addUserEvent("event_hint_closed",e,o.task.id.toString())}}),a.present(),[2]})})},TaskDetail.prototype.checkResult=function(){return __awaiter(this,void 0,void 0,function(){var t,e,l,n,s,i,a,o,r,u,c,d,h,_,k,p,f,g,v,m,b,D,T,S,y,w,E,R,M,C,I,L,O,A,x,P,U,B;return __generator(this,function(K){if(("range"==this.task.solutionType||"value"==this.task.solutionType)&&!this.isDecimal(this.taskDetails.answer)||!this.isSpecialTypeAnswered())return[2];if(console.log(this.task.solutionType),t=[this.taskDetails.answer],e=this.taskDetails.answer.replace(",","."),l=JSON.stringify({solution:t,solutionType:this.task.solutionType}),"value"==this.task.solutionType)n=parseFloat(e),s=parseFloat(this.task.getSolution()),n.toString()==s.toString()?(this.CalculateScore("value","solved"),this.taskSolved("solved",t)):(null!=this.sessionInfo&&this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",l,this.task.id.toString()),this.taskSolved("",t));else if("multiple_choice"==this.task.solutionType){for(console.log(this.multipleChoiceList),i=!0,a=(a=this.multipleChoiceList.filter(function(t){return 1==t.userChecked})).map(function(t){return t.value}),w=0;w<this.multipleChoiceList.length;w++)if(o=this.multipleChoiceList[w],console.log(o),console.log(o.userChecked!=o.rightAnswer),o.userChecked!=o.rightAnswer){i=!1,console.log("found wrong answer");break}this.taskDetails.answerMultipleChoice=this.multipleChoiceList,console.log(i),r=[this.task.getSolution()],i?(this.CalculateScore("multiple_choice","solved"),this.taskSolved("solved",r)):(null!=this.sessionInfo&&(l=JSON.stringify({solution:a,solutionType:this.task.solutionType}),this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",l,this.task.id.toString())),this.taskSolved("",[""]))}else if("range"==this.task.solutionType)u=this.task.getSolutionList(),c=u[0],d=u[1],h=+this.taskDetails.answer.replace(",","."),_=[this.taskDetails.answer],h>=c&&h<=d?(this.CalculateScore("range","solved"),this.taskSolved("solved",_)):4==u.length?(k=u[3],p=[this.taskDetails.answer],h>=u[2]&&h<=k?(this.CalculateScore("range","solved_low"),this.taskSolved("solved_low",p)):(null!=this.sessionInfo&&this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",l,this.task.id.toString()),this.taskSolved("",[""]))):(null!=this.sessionInfo&&this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",l,this.task.id.toString()),this.taskSolved("",[""]));else if("gps"==this.task.solutionType)switch(f=this.task.getSolutionGpsValue("task"),console.log(f),f){case"lineNoDirection":this.CalculateLine(this.taskDetailMap.pointMarkers[0],this.taskDetailMap.pointMarkers[1],+this.task.getSolutionGpsValue("length"));break;case"line":this.CalculateLineDirection(this.taskDetailMap.pointMarkers[0],this.taskDetailMap.pointMarkers[1],+this.task.getSolutionGpsValue("length"),+this.task.getSolutionGpsValue("direction"));break;case"triangle":this.CalculateTriangle(this.taskDetailMap.pointMarkers[0],this.taskDetailMap.pointMarkers[1],this.taskDetailMap.pointMarkers[2],+this.task.getSolutionGpsValue("length"));break;case"square":this.CalculateSquare(this.taskDetailMap.pointMarkers[0],this.taskDetailMap.pointMarkers[1],this.taskDetailMap.pointMarkers[2],this.taskDetailMap.pointMarkers[3],+this.task.getSolutionGpsValue("length"));break;case"centerTwo":this.CalculateCenterTwoP(this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2"),this.taskDetailMap.pointMarkers[0]);break;case"centerThree":this.CalculateCenterThreeP(this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2"),this.task.getSolutionGpsValue("point3"),this.taskDetailMap.pointMarkers[0]);break;case"linearFx":this.CalculateLinearFx(this.task.getSolutionGpsValue("point1"),this.task.getSolutionGpsValue("point2"),this.taskDetailMap.pointMarkers[0].getLatLng(),this.taskDetailMap.pointMarkers[1].getLatLng(),this.task.getSolutionGpsValue("slope"),this.task.getSolutionGpsValue("y"))}else if("vector_values"==this.task.solutionType){for(D=this.taskDetails.answerMultipleChoice,I=this.specialSolution.components,O=!0,A=[],S="<table class='solutionTable'>",w=0;w<D.length;w++)g=D[w],R=parseFloat(g.answer.replace(",",".")),A.push({name:(v=I[w]).name,answer:g.answer}),g.solved=R>+v.val-1e-4&&R<+v.val+1e-4,g.solved||(O=!1),S+="<tr><td>"+g.name+':</td> <td class="'+(g.solved?"correct":"false")+'">'+g.answer+"</td></tr>";S+="</table>",O?(this.CalculateScore("vector_values","solved"),this.taskSolved("solved",[S])):(null!=this.sessionInfo&&(l=JSON.stringify({solution:A,solutionType:this.task.solutionType}),this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",l,this.task.id.toString())),this.taskSolved("",[S]))}else if("vector_intervals"==this.task.solutionType){for(D=this.taskDetails.answerMultipleChoice,I=this.specialSolution.components,O=!0,A=[],S="<table class='solutionTable'>",w=0;w<D.length;w++)m=D[w],R=parseFloat(m.answer.replace(",",".")),A.push({name:(b=I[w]).name,answer:m.answer}),m.solved=R>=+b.low&&R<=+b.high,m.solved||(O=!1),S+="<tr><td>"+m.name+':</td> <td class="'+(m.solved?"correct":"false")+'">'+m.answer+"</td></tr>";S+="</table>",O?(this.CalculateScore("vector_intervals","solved"),this.taskSolved("solved",[S])):(null!=this.sessionInfo&&(l=JSON.stringify({solution:A,solutionType:this.task.solutionType}),this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",l,this.task.id.toString())),this.taskSolved("",[S]))}else if("set"===this.task.solutionType){D=[];for(T in this.taskDetails.answerMultipleChoice)D.push({answer:this.taskDetails.answerMultipleChoice[T].answer,originalIndex:T});for(D.sort(function(t,e){return parseFloat(t.answer)>parseFloat(e.answer)?1:parseFloat(t.answer)===parseFloat(e.answer)?0:-1}),I=this.specialSolution.sort(function(t,e){return parseFloat(t)>parseFloat(e)?1:parseFloat(t)===parseFloat(e)?0:-1}),O=!0,A=[],S="<table class='solutionTable'>",y=[],w=0;w<D.length;w++){E=D[w],R=parseFloat(E.answer.replace(",",".")),M=this.taskDetails.answerMultipleChoice[E.originalIndex];for(C in I)if(-1===y.indexOf(C)){if(t=I[C],R>+t-1e-4&&R<+t+1e-4){y.push(C),M.solved=!0;break}M.solved=!1}A.push(E.answer),M.solved||(O=!1),S+='<tr><td class="'+(M.solved?"correct":"false")+'">'+E.answer+"</td></tr>"}S+="</table>",O?(this.CalculateScore("set","solved"),this.taskSolved("solved",[S])):(null!=this.sessionInfo&&(l=JSON.stringify({solution:A,solutionType:this.task.solutionType}),this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",l,this.task.id.toString())),this.taskSolved("",[S]))}else if("blanks"===this.task.solutionType){for(I=this.specialSolution.features,L="strict"===this.specialSolution.settings.check_type?0:"normal"===this.specialSolution.settings.check_type?.2:.4,O=!0,A=[],x=this.specialSolution.val,P=function(t){for(var e=1,l=0,n=I.find(function(e){return e.blank==="**"+t.id+"**"}).answers;l<n.length;l++){var s=n[l];t.answer=trim(t.answer);var i=__WEBPACK_IMPORTED_MODULE_19_js_levenshtein__(s.toLowerCase(),t.answer.toLowerCase())/s.length;i<e&&(e=i)}if(t.solved=e<=L,t.solved){document.getElementById(t.id).classList.add("disabled")}else O=!1;var a=new RegExp("\\*\\*"+t.id.replace(/\//g,"\\/")+"\\*\\*").exec(x);x=x.replace(a[0],'<span class="blank '+(t.solved?"correct":"false")+'">'+t.answer+"</span>"),A.push(t.answer)},U=0,B=this.taskDetails.answerMultipleChoice;U<B.length;U++)P(B[U]);O?(this.CalculateScore("blanks","solved"),this.taskSolved("solved",[x])):(null!=this.sessionInfo&&(l=JSON.stringify({solution:A,solutionType:this.task.solutionType}),this.chatAndSessionService.addUserEvent("event_entered_wrong_answer",l,this.task.id.toString())),this.taskSolved("",[x]))}return[2]})})},TaskDetail.prototype.completeTask=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){return"info"===this.task.solutionType&&this.task.subtasks&&this.task.subtasks.length>0?this.CalculateScore("info","solved"):(this.taskDetails.score=this.maxScore,this.rootTask||(this.score.score+=this.taskDetails.score)),this.taskSolved("solved",[""]),[2]})})},TaskDetail.prototype.showSolutionSample=function(t){var e=this;void 0===t&&(t=!1),this.taskDetails.solved||this.taskDetails.solvedLow||(this.rootTask||this.score.addFailedTask(this.task.id),this.taskDetails.score=0,this.taskDetails.failed=!0,this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails));var l=this.task.getSolutionSample(),n=this.task.getSolutionSampleImgSrc(),s=[];l&&0!=l.length||n&&0!=n.length?s.push(l):s=["a_msg_no_solutionsample","p_t_solution",this.task.getSolution()];var i=this,a=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{title:"t_samplesolution",imageUrl:this.task.getSolutionSampleImgSrc(),messages:s,modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.sampleSolution,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[{title:"a_alert_close",callback:function(){a.dismiss(),i.rootTask&&t&&i.goToNextSubtask()}}]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative});a.onDidDismiss(function(t){if(null!=e.sessionInfo){var l=JSON.stringify({});e.chatAndSessionService.addUserEvent("event_viewed_sample_solution",l,e.task.id.toString())}}),a.present()},TaskDetail.prototype.closeDetails=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(l){switch(l.label){case 0:return this.rootTask&&t?(this.taskDetails.skipped=!0,[4,this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails)]):[3,2];case 1:return l.sent(),[2,this.goToNextSubtask()];case 2:return this.navParams.get("goToNextTaskById")?(e=this.navParams.get("goToNextTaskById"),t?(this.taskDetails.skipped=!0,[4,this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails)]):[3,4]):[3,4];case 3:l.sent(),e(this.task.id,t),l.label=4;case 4:return this.deepLinker.navChange("back"),this.navCtrl.pop({},function(){}),[2]}})})},TaskDetail.prototype.confirmSkippingTask=function(){var t=this,e="a_skipTask_confirm";this.route.isNarrativeEnabled()&&(e=this.route.getNarrativeString(e)),this.modalsService.showDialog("a_skipTask",e,"no",function(){},"yes",function(){return __awaiter(t,void 0,void 0,function(){var t;return __generator(this,function(e){return null!=this.sessionInfo&&(t=JSON.stringify({}),this.chatAndSessionService.addUserEvent("event_task_skipped",t,this.task.id.toString())),this.closeDetails(!0),[2]})})},this.app.activeNarrative)},TaskDetail.prototype.getNextAvailableHint=function(){return-1==this.shownHints.indexOf(1)&&this.task.hasHintMessage(1)||!this.task.hasHintMessage(2)?1:-1==this.shownHints.indexOf(2)&&this.task.hasHintMessage(2)||!this.task.hasHintMessage(3)?2:-1==this.shownHints.indexOf(3)&&this.task.hasHintMessage(3)?3:4},TaskDetail.prototype.taskSolved=function(t,e){return __awaiter(this,void 0,void 0,function(){var l,n,s,i,a,o,r,u,c,d,h,_,k,p,f,g,v,m,b,D=this;return __generator(this,function(T){switch(T.label){case 0:if(l=this,this.route.isAnswerFeedbackEnabled()||(this.taskDetails.saved=!0,this.rootTask||this.score.addSavedTask(this.task.id)),"solved"==t||"solved_low"==t){if(this.taskDetails.skipped=!1,o="",g="","solved"==t)if(g="a_alert_right_answer_title",this.taskDetails.solved=!0,this.rootTask||this.score.addSolvedTask(this.task.id),this.rootTask&&!this.subTasksRequired)o=0==this.taskDetails.tries?"gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"info"==this.task.solutionType?"a_info_task_finished_message":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_1":"a_alert_subtask_right_answer_flawless":"a_alert_subtask_right_answer";else switch(this.taskDetails.tries){case 0:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"info"==this.task.solutionType?"a_info_task_finished_message":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_1":"a_alert_right_answer_1";break;case 1:case 2:case 3:case 4:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"info"==this.task.solutionType?"":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_2":"a_alert_right_answer_2";break;case 5:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"info"==this.task.solutionType?"":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_3":"a_alert_right_answer_3"}if("solved_low"==t)if(g="a_alert_right_answer_title_low",this.taskDetails.solvedLow=!0,this.rootTask||this.score.addSolvedTaskLow(this.task.id),this.rootTask&&!this.subTasksRequired)o=0==this.taskDetails.tries?"gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_1_low":"a_alert_right_answer_1_low":"a_alert_subtask_right_answer_low";else switch(this.taskDetails.tries){case 0:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_1_low":"a_alert_right_answer_1_low";break;case 1:case 2:case 3:case 4:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_2_low":"a_alert_right_answer_2_low";break;case 5:o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_right_answer_3_low":"a_alert_right_answer_3_low"}n=this,k={title:"t_samplesolution",callback:function(){i.dismiss().then(function(){n.showSolutionSample(!0)})}},s={title:"okay",callback:function(){i.dismiss().then(function(){n.goToNextSubtask()})}},b={title:"pdf_next_task",callback:function(){i.dismiss().then(function(){n.closeDetails(!1)})}},this.route.isNarrativeEnabled()&&(g=this.route.getNarrativeString(g),o=this.route.getNarrativeString(o)),this.route.isAnswerFeedbackEnabled()?(m={title:"info"===this.task.solutionType?"hide":g,message:o,solution:"info"===this.task.solutionType?void 0:e,modalType:"solved_low"==t?__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.solvedLow:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.solved,gamificationEnabled:!this.gamificationIsDisabled,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,param:{tries:this.taskDetails.tries+1},buttons:this.rootTask?[s]:this.route.isSampleSolutionEnabled()&&"info"!==this.task.solutionType?[k,b]:[b]},"info"===this.task.solutionType||this.task.subtasks&&this.task.subtasks.length>0||!(!this.rootTask||this.rootTask&&this.subTasksRequired)||(m.score="+"+this.taskDetails.score+"MP/"+this.bestPossibleScore()+'MP<span class="subscore">'+this.generateSubtaskScoreCalculationString(t)+"</span>"),console.log(m),i=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,m,{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})):i=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{title:"a_alert_saved_answer_title",message:"a_alert_saved_answer_message",modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.saved,gamificationEnabled:!this.gamificationIsDisabled,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:this.rootTask?[s]:[b]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative}),i.onDidDismiss(function(t){console.log(t),t&&t.showMap&&D.navCtrl.pop()}),i.present(),null!=this.sessionInfo&&(a=JSON.stringify({score:this.taskDetails.score,solution:e,quality:t}),this.chatAndSessionService.addUserEvent("event_task_completed",a,this.task.id.toString())),this.taskDetails.timeSolved=(new Date).getTime()}else{switch(o="",r=void 0,u=this.taskDetails.tries,this.taskDetails.skipped&&(u=this.taskDetails.newTries),u){case 0:case 1:if("multiple_choice"!==this.task.solutionType||this.multipleChoiceList.length-2!==u){o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"blanks"==this.task.solutionType?"a_alert_blanks_false_answer_1":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_false_answer_1":"a_alert_false_answer_1",r=[{title:"a_alert_close",callback:function(){v.dismiss()}}];break}case 2:case 3:case 4:case 5:case 6:if("multiple_choice"!==this.task.solutionType||this.multipleChoiceList.length-2!==u){o="gps"==this.task.solutionType?this.SetMessage(this.task.getSolutionGpsValue("task")):"blanks"==this.task.solutionType?"a_alert_blanks_false_answer_2":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_false_answer_2":"a_alert_false_answer_2",this.route.isHintsEnabled()&&!this.rootTask||(o="blanks"==this.task.solutionType?"a_alert_blanks_false_answer_1":"set"==this.task.solutionType||"vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType?"a_alert_set_false_answer_1":"a_alert_false_answer_1"),c={title:"a_t_show_hint",callback:function(){v.dismiss().then(function(){var t=1;if(3==u){t=(e=l.getNextAvailableHint())<2?e:2}else if(4==u){var e;t=(e=l.getNextAvailableHint())<3?e:3}l.showHint(t)})}},d=this,h={title:"a_t_show_subtask",callback:function(){v.dismiss().then(function(){d.openSubtask()})}},_={title:"a_alert_close",callback:function(){v.dismiss()}},r=this.route.isHintsEnabled()&&this.task.subtasks&&this.task.subtasks.length>0&&this.task.subtasks.length!==this.solvedSubtasks.length?[h,c,_]:this.route.isHintsEnabled()&&!this.rootTask?[c,_]:this.task.subtasks&&this.task.subtasks.length>0&&this.task.subtasks.length!==this.solvedSubtasks.length?[h,_]:[_];break}default:o="a_t_skip_msg",k={title:"t_samplesolution",callback:function(){v.dismiss().then(function(){if(null!=l.sessionInfo){var t=JSON.stringify({});l.chatAndSessionService.addUserEvent("event_task_failed",t,l.task.id.toString())}l.showSolutionSample(!0)})}},p={title:"a_skipTask",callback:function(){v.dismiss().then(function(){if(null!=l.sessionInfo){var t=JSON.stringify({});l.chatAndSessionService.addUserEvent("event_task_skipped",t,l.task.id.toString())}l.closeDetails(!0)})}},f={title:"okay",callback:function(){v.dismiss().then(function(){if(null!=l.sessionInfo){var t=JSON.stringify({});l.chatAndSessionService.addUserEvent("event_task_failed",t,l.task.id.toString())}l.taskDetails.failed=!0,l.ormService.insertOrUpdateTaskState(l.score,l.taskDetails).then(function(){l.rootTask?l.goToNextSubtask():l.closeDetails()})})}},r=this.rootTask&&this.route.isSampleSolutionEnabled()?[k,f]:this.rootTask?[f]:this.route.isSampleSolutionEnabled()?[k,p]:[p]}this.taskDetails.tries++,this.taskDetails.skipped&&this.taskDetails.newTries++,g="a_alert_false_answer_title",this.route.isNarrativeEnabled()&&(g=this.route.getNarrativeString(g),o=this.route.getNarrativeString(o)),this.route.isAnswerFeedbackEnabled()?(m={title:g,message:o,solution:e,modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.error,gamificationEnabled:!this.gamificationIsDisabled,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:r},(!this.rootTask||this.rootTask&&this.subTasksRequired&&("multiple_choice"!==this.task.solutionType||this.multipleChoiceList.length-1!==u))&&(m.score=this.taskDetails.tries>1?"-"+this.penalty:"0"),v=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,m,{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})):(b={title:"pdf_next_task",callback:function(){v.dismiss().then(function(){l.closeDetails(!1)})}},v=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{title:"a_alert_saved_answer_title",message:"a_alert_saved_answer_message",modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.saved,gamificationEnabled:!this.gamificationIsDisabled,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[b]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative})),v.present()}return[4,this.ormService.insertOrUpdateTaskState(this.score,this.taskDetails)];case 1:return T.sent(),[2]}})})},TaskDetail.prototype.CalculateScore=function(t,e){if("value"==t)if(this.taskDetails.tries>0){this.taskDetails.score=(s=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?s:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.maxScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score);if("multiple_choice"==t)if(this.taskDetails.tries>0){this.taskDetails.score=(s=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?s:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.maxScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score);if("range"==t)if("solved"==e)if(this.taskDetails.tries>0){this.taskDetails.score=(s=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?s:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.maxScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score);else if("solved_low"==e){var l=this.task.getSolutionList(),n=parseFloat(this.taskDetails.answer.replace(",","."));if(n<l[0])if(this.taskDetails.tries>0){var s=this.CalculateOrangeScore(l[2],l[0],n,this.maxScore-(this.taskDetails.tries-1)*this.penalty);this.taskDetails.score=s>this.minScore?s:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.CalculateOrangeScore(l[2],l[0],n,this.maxScore),this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score);else if(this.taskDetails.tries>0){s=this.CalculateOrangeScore(l[3],l[1],n,this.maxScore-(this.taskDetails.tries-1)*this.penalty);this.taskDetails.score=s>this.minScore?s:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.CalculateOrangeScore(l[3],l[1],n,this.maxScore),this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}if("vector_values"==t||"vector_intervals"==t||"set"==t||"blanks"===t)if(this.taskDetails.tries>0){this.taskDetails.score=(s=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?s:this.minScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score)}else this.taskDetails.score=this.maxScore,this.rootTask||this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0||(this.score.score+=this.taskDetails.score);if("info"===t&&(this.taskDetails.score=0),this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0){s=this.taskDetails.score;for(var i=0,a=this.solvedSubtasks;i<a.length;i++){s+=a[i].score}this.taskDetails.score=s>this.minScore?s:this.minScore,this.rootTask||(this.score.score+=this.taskDetails.score)}console.log("FinalScore: "+this.score.score)},TaskDetail.prototype.CalculateOrangeScore=function(t,e,l,n){var s=Math.abs(e-t);console.log("borderRight "+e+"  BorderLeft "+t);var i=Math.abs(l-t)/s*n,a=Math.round(i);return a<this.minScore?this.minScore:a},TaskDetail.prototype.bestPossibleScore=function(){return this.rootTask&&this.subTasksRequired?this.maxScore:100},TaskDetail.prototype.possibleScore=function(){if(this.taskDetails){if(this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0){for(var t=0,e=0,l=this.solvedSubtasks;e<l.length;e++){t+=l[e].score}if(t+=0==this.taskDetails.tries?this.maxScore:this.maxScore-(this.taskDetails.tries-1)*this.penalty>this.minScore?this.maxScore-(this.taskDetails.tries-1)*this.penalty:this.minScore,this.solvedSubtasks.length<this.task.subtasks.length){for(var n=0,s=0,i=this.task.subtasks;s<i.length;s++){"info"!==i[s].solutionType&&n++}for(var a=0,o=function(t){"info"!==r.task.subtasks.find(function(e){return e.id===t.taskId}).solutionType&&a++},r=this,u=0,c=this.solvedSubtasks;u<c.length;u++){o(c[u])}for(var d=0;d<n-a;d++)t+=this.subTaskScore}return t}return 0==this.taskDetails.tries?this.maxScore:this.maxScore-(this.taskDetails.tries-1)*this.penalty>this.minScore?this.maxScore-(this.taskDetails.tries-1)*this.penalty:this.minScore}return this.maxScore},TaskDetail.prototype.CalculateLine=function(t,e,l){var n=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t.getLatLng(),e.getLatLng()]),s=[Math.round(n).toString()];if(n>l-10&&n<l+10){if(this.taskDetails.tries>0){this.taskDetails.score=(i=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?i:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",s)}else if(n>l-20&&n<l+20){if(this.taskDetails.tries>0){var i;this.taskDetails.score=(i=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?i:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",s)}else this.taskSolved("",s)},TaskDetail.prototype.CalculateLineDirection=function(t,e,l,n){var s=0,i=0,a=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t.getLatLng(),e.getLatLng()]),o=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.bearing(t.getLatLng(),e.getLatLng());o<0&&(o+=360),s=a>l-10&&a<l+10?2:a>l-20&&a<l+20?1:0;var r=!1,u=n-10,c=n-20;u<0&&(u+=360,r=!0),c&&(c+=360,r=!0),i=r?o>u||o<n+10?2:o>c||o<n+20?1:0:o>u&&o<n+10?2:o>c&&o<n+20?1:0;var d=[Math.round(a).toString(),Math.round(o-n).toString()];if(2==i&&2==s){if(this.taskDetails.tries>0){this.taskDetails.score=(h=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?h:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",d)}else if(i>0&&s>0){if(this.taskDetails.tries>0){var h;this.taskDetails.score=(h=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?h:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",d)}else this.taskSolved("",d)},TaskDetail.prototype.CalculateTriangle=function(t,e,l,n){for(var s=[__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t.getLatLng(),e.getLatLng()]),__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([e.getLatLng(),l.getLatLng()]),__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([l.getLatLng(),t.getLatLng()])],i=!0,a=!0,o=0;o<s.length;o++){var r=s[o];r>n-10&&r<n+10||(r>n-20&&r<20?i=!1:(a=!1,i=!1))}var u=[Math.round(s[0]).toString(),Math.round(s[1]).toString(),Math.round(s[2]).toString()];if(i){if(this.taskDetails.tries>0){this.taskDetails.score=(c=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?c:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",u)}else if(a){if(this.taskDetails.tries>0){var c;this.taskDetails.score=(c=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?c:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",u)}else this.taskSolved("",u)},TaskDetail.prototype.CalculateSquare=function(t,e,l,n,s){for(var i=[__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t.getLatLng(),e.getLatLng()]),__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([e.getLatLng(),l.getLatLng()]),__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([l.getLatLng(),n.getLatLng()]),__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([n.getLatLng(),t.getLatLng()])],a=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t.getLatLng(),l.getLatLng()]),o=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([e.getLatLng(),n.getLatLng()]),r=!0,u=!0,c=0,d=0;d<i.length;d++){var h=i[d];h>s-10&&h<s+10||(h>s-20&&h<20?r=!1:(u=!1,r=!1))}c=Math.abs(a-o)<10?2:Math.abs(a-o)<20?1:0;var _=[Math.round(i[0]).toString(),Math.round(i[1]).toString(),Math.round(i[2]).toString(),Math.round(i[3]).toString()];if(r&&2==c){if(this.taskDetails.tries>0){this.taskDetails.score=(k=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?k:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",_)}else if(u&&c>0){if(this.taskDetails.tries>0){var k;this.taskDetails.score=(k=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?k:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",_)}else this.taskSolved("",_)},TaskDetail.prototype.CalculateCenterTwoP=function(t,e,l){t=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(t[0],t[1]),e=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(e[0],e[1]),console.log(l.getLatLng());var n=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t,l.getLatLng()]),s=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([e,l.getLatLng()]),i=Math.abs(n-s),a=[Math.round(n).toString(),Math.round(s).toString()];if(i<5){if(this.taskDetails.tries>0){this.taskDetails.score=(o=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?o:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",a)}else if(i<10){if(this.taskDetails.tries>0){var o;this.taskDetails.score=(o=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?o:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",a)}else this.taskSolved("",a)},TaskDetail.prototype.CalculateCenterThreeP=function(t,e,l,n){t=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(t[0],t[1]),e=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(e[0],e[1]),l=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(l[0],l[1]);var s=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t,n.getLatLng()]),i=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([e,n.getLatLng()]),a=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([l,n.getLatLng()]),o=Math.abs(s-i),r=Math.abs(i-a),u=[Math.round(s).toString(),Math.round(i).toString(),Math.round(a).toString()];if(o<5&&r<5){if(this.taskDetails.tries>0){this.taskDetails.score=(c=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?c:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",u)}else if(o<10&&r<10){if(this.taskDetails.tries>0){var c;this.taskDetails.score=(c=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?c:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",u)}else this.taskSolved("",u)},TaskDetail.prototype.CalculateLinearFx=function(t,e,l,n,s,i){t=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(t[0],t[1]),e=__WEBPACK_IMPORTED_MODULE_9_leaflet__.latLng(e[0],e[1]);__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t,e])<100&&(e=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.destination(t,__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.bearing(t,e),100));var a=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.bearing(t,e)-90;a<0&&(a+=360);var o=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.destination(t,a,100),r=this.getDistanceToLine(l,t,o),u=this.getDistanceToLine(n,t,o);if(r>u){var c=l;l=n,n=c}var d=this.getDistanceToLine(l,t,e),h=(this.getDistanceToLine(n,t,e)-d)/(u-r),_=d-h*r,k=0,p=0,f=[Math.round(h).toString(),Math.round(i).toString()],g=[h.toFixed(2).toString(),Math.round(_).toString()];if(h>s-5&&h<s+5?k=2:h>s-10&&h<s+10&&(k=1),_>i-5&&_<i+5?p=2:_>i-10&&_<i+10&&(p=1),2==k&&2==p){if(this.taskDetails.tries>0){this.taskDetails.score=(v=this.maxScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?v:this.minScore}else this.taskDetails.score=this.maxScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved",f)}else if(k>0&&p>0){if(this.taskDetails.tries>0){var v;this.taskDetails.score=(v=this.orangeScore-(this.taskDetails.tries-1)*this.penalty)>this.minScore?v:this.minScore}else this.taskDetails.score=this.orangeScore;this.rootTask||(this.score.score+=this.taskDetails.score),this.taskSolved("solved_low",f)}else this.taskSolved("",g)},TaskDetail.prototype.getDistanceToLine=function(t,e,l){var n=this.taskDetailMap.getMap();if(null!=n){var s=__WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.closestOnSegment(n,t,e,l);return __WEBPACK_IMPORTED_MODULE_9_leaflet__.GeometryUtil.length([t,s])}return 0},TaskDetail.prototype.setFabColor=function(t){return"fab-color-"+(t+1)},TaskDetail.prototype.SetMessage=function(t){var e="";switch(t){case"lineNoDirection":e="a_line_no_direction_distance";break;case"line":e="a_line_direction_distance";break;case"triangle":e="a_triangle_distances";break;case"square":e="a_square_distances";break;case"centerTwo":e="a_center_two_distances";break;case"centerThree":e="a_center_three_distances";break;case"linearFx":e="a_linearFx_info"}return e},TaskDetail.prototype.openInPhotoviewer=function(t){var e=this;void 0===t&&(t=!1),__WEBPACK_IMPORTED_MODULE_16__classes_Helper__.b.isPluginAvailable(__WEBPACK_IMPORTED_MODULE_15__ionic_native_photo_viewer__.a)&&(this.spinnerDialog.show(),setTimeout(function(){e.photoViewer.show(t?e.rootTask.getImageURL(!0):e.task.getImageURL(!0)),setTimeout(function(){e.spinnerDialog.hide()},1e3)},100))},TaskDetail.prototype.openSubtask=function(t){console.log("we opening a subtask");var e=this.rootTask?this.rootTask:this.task;if(t||0===t||this.solvedSubtasks.length!==e.subtasks.length)return t||0===t||(t=this.solvedSubtasks.length),this.navCtrl.push(TaskDetail_1,{taskId:this.taskId,routeId:this.routeId,headerTitle:e.getSubtasksInOrder()[t].title,subTaskIndex:t})},TaskDetail.prototype.changeSubtaskAccordionState=function(t){this.activeAccordions.find(function(e){return e===t})?this.activeAccordions=this.activeAccordions.filter(function(e){return e!=t}):this.activeAccordions.push(t),console.log("New Accordion State",this.activeAccordions)},TaskDetail.prototype.goToNextSubtask=function(){var t=this,e=this.navCtrl.getActive().index;this.subTaskIndex+1!==this.rootTask.subtasks.length?this.openSubtask(this.subTaskIndex+1).then(function(){t.navCtrl.remove(e)}):this.closeDetails()},TaskDetail.prototype.goToPreviousSubtask=function(){var t=this,e=this.navCtrl.getActive().index;this.subTaskIndex-1>=0?this.openSubtask(this.subTaskIndex-1).then(function(){t.navCtrl.remove(e)}):this.closeDetails()},TaskDetail.prototype.isSpecialTypeAnswered=function(){var t=!0;if(!this.isSpecialTaskType)return t;if("vector_values"==this.task.solutionType||"vector_intervals"==this.task.solutionType||"set"==this.task.solutionType||"blanks"==this.task.solutionType)for(var e=0,l=this.taskDetails.answerMultipleChoice;e<l.length;e++){""===l[e].answer&&(t=!1)}return t},TaskDetail.prototype.generateSubtaskScoreCalculationString=function(t){var e,l=this.task.solutionType;if("value"!=l&&"multiple_choice"!=l&&"vector_values"!=l&&"vector_intervals"!=l&&"set"!=l&&"blanks"!==l||(e=this.maxScore),"info"==l&&(e=0),"range"==l)if("solved"==t)e=this.maxScore;else if("solved_low"==t){var n=this.task.getSolutionList(),s=parseFloat(this.taskDetails.answer.replace(",","."));e=s<n[0]?this.CalculateOrangeScore(n[2],n[0],s,this.taskDetails.tries>0?this.maxScore-(this.taskDetails.tries-1)*this.penalty:this.maxScore):this.CalculateOrangeScore(n[3],n[1],s,this.taskDetails.tries>0?this.maxScore-(this.taskDetails.tries-1)*this.penalty:this.maxScore)}var i="";if(this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0){for(var a=[],o=0,r=this.solvedSubtasks;o<r.length;o++){var u=r[o];a[u.score]?a[u.score]++:a[u.score]=1}if(this.taskDetails.tries<=1)a[e]?a[e]++:a[e]=1;else{var c=e-(this.taskDetails.tries-1)*this.penalty>this.minScore?this.maxScore-(this.taskDetails.tries-1)*this.penalty:this.minScore;a[c]?a[c]++:a[c]=1}for(var d in a)""!=i&&(i+=" + "),1==a[d]&&"0"!=d?i+=d+"MP":"0"!=d&&(i+=a[d]+" x "+(d?d+"MP":""))}else{var h=0;h=this.taskDetails.tries>1?this.maxScore-(this.taskDetails.tries-1)*this.penalty-e:this.maxScore-e,this.taskDetails.tries>1?(i=this.taskDetails.tries>2?this.maxScore+"MP - "+(this.taskDetails.tries-1)+" x "+this.penalty+"MP":this.maxScore+"MP - "+this.penalty+"MP",h>0&&(i+=" -"+h+"MP")):h>0&&(i=this.maxScore+"MP - "+h+"MP")}return i},TaskDetail.prototype.displayScoreCalculation=function(){if(this.subTasksRequired&&this.task.subtasks&&this.task.subtasks.length>0){var t=this.modalCtrl.create(__WEBPACK_IMPORTED_MODULE_5__modals_MCMIconModal_MCMIconModal__.a,{type:"text",score:"("+this.generateSubtaskScoreCalculationString("solved")+")",gamificationEnabled:!this.gamificationIsDisabled,modalType:__WEBPACK_IMPORTED_MODULE_6__app_app_component__.a.calculation,narrativeEnabled:this.route.isNarrativeEnabled(),narrative:this.app.activeNarrative,buttons:[{title:"a_alert_close",callback:function(){t.dismiss()}}]},{showBackdrop:!0,enableBackdropDismiss:!0,cssClass:this.app.activeNarrative});t.present()}},TaskDetail.prototype.goBack=function(){console.log("We goin back boys"),this.rootTask?this.goToPreviousSubtask():this.closeDetails()},TaskDetail;var TaskDetail_1,_a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q}()},961:function(t,e,l){"use strict";l.d(e,"a",function(){return d});l(0);var n=l(139),s=(l.n(n),l(635)),i=(l.n(s),l(955)),a=(l.n(i),l(633)),o=(l.n(a),l(21)),r=l(632),u=l(297),c=(l.n(u),l(958)),d=(l.n(c),function(){function t(t,e,l,n,s,i){this.task=t,this.route=e,this.gpsService=l,this.app=n,this.ormService=s,this.imagesService=i,this.pointsIcons=[],this.pointMarkers=[],this.ALLOWED_DISTANCE_TO_TASK=300,this.AXIS_LENGTH=110,this.ARROW_LENGTH=6,this.ARROW_DEGREE=25,this.MARK_DISTANCE=10,this.MARK_LENGTH=1.5,this.LINEAR_FX_EXTEND=100,this.axisPoints={origin:null,x:null,y:null},this.linearFxGraph=null,this.markerGroup=null,this.updateIcons(),this.taskDetails=t,this.routeDetails=e;for(var a=0;a<parseInt(this.task.getSolutionGpsValue("points"));a++)this.pointMarkers[a]=null}return t.prototype.ngOnDestroy=function(){this.watchSubscription&&(this.watchSubscription.unsubscribe(),this.watchSubscription=null)},t.prototype.updateIcons=function(){switch(this.app.activeNarrative){case"pirates":this.userPositionIcon=n.icon({iconUrl:"./assets/icons/pirates/mapposition.png",iconSize:[100,100],iconAnchor:[50,50],className:"marker userPosition"}),this.preDefinedPointIcon=n.icon({iconUrl:"assets/icons/pirates/marker-task-gps-0.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.pointsIcons[0]=n.icon({iconUrl:"./assets/icons/pirates/marker-task-gps-1.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.pointsIcons[1]=n.icon({iconUrl:"./assets/icons/pirates/marker-task-gps-2.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.pointsIcons[2]=n.icon({iconUrl:"./assets/icons/pirates/marker-task-gps-3.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"}),this.pointsIcons[3]=n.icon({iconUrl:"./assets/icons/pirates/marker-task-gps-4.png",iconSize:[50,50],iconAnchor:[25,25],className:"marker"});break;default:this.userPositionIcon=n.icon({iconUrl:"./assets/icons/mapposition.png",iconSize:[100,100],className:"marker"}),this.preDefinedPointIcon=n.icon({iconUrl:"./assets/icons/marker-task-gps-0.png",iconSize:[50,50],iconAnchor:[25,50],className:"marker"}),this.pointsIcons[0]=n.icon({iconUrl:"./assets/icons/marker-task-gps-1.png",iconSize:[50,50],iconAnchor:[25,50],className:"marker"}),this.pointsIcons[1]=n.icon({iconUrl:"./assets/icons/marker-task-gps-2.png",iconSize:[50,50],iconAnchor:[25,50],className:"marker"}),this.pointsIcons[2]=n.icon({iconUrl:"./assets/icons/marker-task-gps-3.png",iconSize:[50,50],iconAnchor:[25,50],className:"marker"}),this.pointsIcons[3]=n.icon({iconUrl:"./assets/icons/marker-task-gps-4.png",iconSize:[50,50],iconAnchor:[25,50],className:"marker"})}},t.prototype.setMarker=function(t){var e;if(null!=(e=this.gpsService.getLastPosition())){var l=new n.LatLng(e.coords.latitude,e.coords.longitude);if(!this.markerCanBeSet(l))return;if(null==this.pointMarkers[t]){String.fromCharCode("A".charCodeAt(0)+t);var s=n.marker(l,{icon:this.pointsIcons[t]});s.addTo(this.map),this.pointMarkers[t]=s}else this.pointMarkers[t].setLatLng(l);"linearFx"==this.taskDetails.getSolutionGpsValue("task")&&this.insertLinearFxGraph(),console.log("Marker placed")}},t.prototype.markerCanBeSet=function(t){if(n.GeometryUtil.length([new n.LatLng(this.taskDetails.lat,this.taskDetails.lon),t])>this.ALLOWED_DISTANCE_TO_TASK)return console.log("Marker cannot be placed: Out of range."),!1;if("linearFx"==this.taskDetails.getSolutionGpsValue("task")){var e=n.GeometryUtil.destination(this.axisPoints.x,n.GeometryUtil.bearing(this.axisPoints.origin,this.axisPoints.y),this.AXIS_LENGTH),l=n.GeometryUtil.closestOnSegment(this.map,t,this.axisPoints.origin,this.axisPoints.x),s=n.GeometryUtil.closestOnSegment(this.map,t,this.axisPoints.origin,this.axisPoints.y),i=n.GeometryUtil.closestOnSegment(this.map,t,this.axisPoints.x,e),a=n.GeometryUtil.closestOnSegment(this.map,t,this.axisPoints.y,e),o=n.GeometryUtil.length([l,t]),r=n.GeometryUtil.length([s,t]),u=n.GeometryUtil.length([i,t]),c=n.GeometryUtil.length([a,t]);return o<=this.AXIS_LENGTH&&r<=this.AXIS_LENGTH&&u<=this.AXIS_LENGTH&&c<=this.AXIS_LENGTH||(console.log("Marker cannot be placed: Not in axis"),!1)}return!0},t.prototype.areAllPointsSet=function(){for(var t=!0,e=0;e<this.pointMarkers.length;e++)if(null==this.pointMarkers[e]){t=!1;break}return t},t.prototype.getPoints=function(){if(this.areAllPointsSet()){for(var t=[],e=0;e<this.pointMarkers.length;e++){t[e]=this.pointMarkers[e].getLatLng()}return t}return null},t.prototype.insertPreDefinedPoints=function(t){for(var e=0;e<t.length;e++){n.marker(new n.LatLng(t[e][0],t[e][1]),{icon:this.preDefinedPointIcon}).addTo(this.map)}},t.prototype.insertAxis=function(t,e){var l=new n.LatLng(t[0],t[1]),s=new n.LatLng(e[0],e[1]),i=n.GeometryUtil.bearing(l,s);s=n.GeometryUtil.destination(l,i,this.AXIS_LENGTH);var a=n.GeometryUtil.destination(l,i-90,this.AXIS_LENGTH),o=n.GeometryUtil.destination(s,i-180+this.ARROW_DEGREE,this.ARROW_LENGTH),r=n.GeometryUtil.destination(s,i+180-this.ARROW_DEGREE,this.ARROW_LENGTH),u=n.GeometryUtil.destination(a,i-90-180+this.ARROW_DEGREE,this.ARROW_LENGTH),c=n.GeometryUtil.destination(a,i-90+180-this.ARROW_DEGREE,this.ARROW_LENGTH);n.polyline([u,a,c,a,l,s,o,s,r],{color:"red",opacity:.7}).addTo(this.map),this.axisPoints.origin=l,this.axisPoints.x=s,this.axisPoints.y=a,n.marker(n.GeometryUtil.destination(s,i,3*this.MARK_LENGTH),{rotationAngle:i-90,icon:this.getLabeledIcon("X","axis-label","x")}).addTo(this.map),n.marker(n.GeometryUtil.destination(a,i-90,3*this.MARK_LENGTH),{rotationAngle:i-90,icon:this.getLabeledIcon("Y","axis-label","y")}).addTo(this.map),n.polyline([n.GeometryUtil.destination(l,i+135,this.MARK_LENGTH),n.GeometryUtil.destination(l,i-45,1.5*this.MARK_LENGTH)],{color:"red",weight:2,opacity:.7}).addTo(this.map),n.marker(n.GeometryUtil.destination(l,i+135,2*this.MARK_LENGTH),{icon:this.getLabeledIcon("0 m","axis-label","y"),rotationAngle:i-90}).addTo(this.map);for(var d=1;d<this.AXIS_LENGTH/this.MARK_DISTANCE;d++){var h=2;5!=d&&10!=d||(h=4);var _=n.GeometryUtil.destination(l,i,this.MARK_DISTANCE*d),k=n.GeometryUtil.destination(l,i-90,this.MARK_DISTANCE*d),p=n.GeometryUtil.destination(_,i-90,this.MARK_LENGTH),f=n.GeometryUtil.destination(_,i-90,-this.MARK_LENGTH),g=n.GeometryUtil.destination(k,i,this.MARK_LENGTH),v=n.GeometryUtil.destination(k,i,-this.MARK_LENGTH);if(n.polyline([f,p],{color:"red",weight:h,opacity:.7}).addTo(this.map),n.polyline([v,g],{color:"red",weight:h,opacity:.7}).addTo(this.map),5==d||10==d){var m=n.GeometryUtil.destination(_,i+90,3*this.MARK_LENGTH),b=n.GeometryUtil.destination(k,-i,3*this.MARK_LENGTH);n.marker(m,{icon:this.getLabeledIcon(10*d+" m","axis-label","x"),rotationAngle:i-90}).addTo(this.map),n.marker(b,{icon:this.getLabeledIcon(10*d+" m","axis-label","y"),rotationAngle:i-90}).addTo(this.map)}}},t.prototype.getLabeledIcon=function(t,e,l){var s;return s=[40,20],n.divIcon({className:e,html:t,iconSize:s})},t.prototype.insertLinearFxGraph=function(){if(this.areAllPointsSet()){var t=this.getPoints();null!=this.linearFxGraph&&this.map.removeLayer(this.linearFxGraph);var e=n.GeometryUtil.bearing(t[0],t[1]),l=n.GeometryUtil.destination(t[0],e,-1*this.LINEAR_FX_EXTEND),s=n.GeometryUtil.destination(t[1],e,this.LINEAR_FX_EXTEND);this.linearFxGraph=n.polyline([l,s],{color:"blue"}).addTo(this.map)}},t.prototype.loadMap=function(){var t=this;this.center=[this.taskDetails.lat,this.taskDetails.lon];var e=this.route.getTilesMap(this.app.activeNarrative),l=this.route.getTilesServerSubdomains(this.app.activeNarrative);if(null==this.map){this.map=n.map("gpsTaskMap",{center:this.center,zoom:18,zoomControl:!0,tileSize:256,maxBounds:this.routeDetails.getBoundingBoxLatLng(),trackResize:!1}),this.map.on("click",function(t){null==o.b.testLocation&&(o.b.testLocation={coords:{latitude:null,longitude:null}}),o.b.testLocation.coords.latitude=t.latlng.lat,o.b.testLocation.coords.longitude=t.latlng.lng});var s=o.b.calculateZoom(this.route.getViewBoundingBoxLatLng());r.a.initialize().then(function(){console.log("Tiles DB Initialized");var i=n.tileLayer.offline(e,r.a,{attribution:"&copy; mapbox.com",subdomains:l,minZoom:s.min_zoom,maxZoom:s.max_zoom,tileSize:256,crossOrigin:!0,detectRetina:!0,bounds:t.route.getBoundingBoxLatLng()}),a=t.ormService.getTileURLsAsObject(t.route),o=!t.route.isNarrativeEnabled(),u=t;i.getTileUrl=function(t){var e=n.TileLayer.prototype.getTileUrl.call(this,t),l=this._getStorageKey(e);return a[l]?Promise.resolve(u.imagesService.getOfflineURL(l,!1,o)):Promise.resolve(e)},t.map.fitBounds(t.route.getViewBoundingBoxLatLng()),i.on("offline:below-min-zoom-error",function(){alert("Can not save tiles below minimum zoom level.")}),i.on("offline:save-start",function(t){console.debug(t),console.debug("Saving "+t.nTilesToSave+" tiles.")}),i.on("offline:save-end",function(){alert("All the tiles were saved.")}),i.on("offline:save-error",function(t){console.error("Error when saving tiles: "+t)}),i.on("offline:remove-start",function(){console.debug("Removing tiles.")}),i.on("offline:remove-end",function(){alert("All the tiles were removed.")}),i.on("offline:remove-error",function(t){console.error("Error when removing tiles: "+t)}),i.addTo(t.map)}),this.gpsService.getCurrentPosition().then(function(e){e&&e.coords&&(console.warn("found you"),t.userMarker=n.marker([e.coords.latitude,e.coords.longitude],{icon:t.userPositionIcon}).on("click",function(){}),t.userMarker.setRotationOrigin("center center"),t.userMarker.addTo(t.map),t.watchSubscription&&t.watchSubscription.unsubscribe(),t.watchSubscription=t.gpsService.watchPosition().subscribe(function(e){if(e&&e.coords){var l=new n.LatLng(e.coords.latitude,e.coords.longitude);if(t.userMarker.setLatLng(l),null!=t.prevPos){var s=o.b.getAngle(t.prevPos,e.coords);t.userMarker.setRotationAngle(s)}t.prevPos=e.coords}}))}).catch(function(t){console.error("Location error: "+JSON.stringify(t))})}},t.prototype.getMap=function(){return this.map},t}())},962:function(t,e,l){"use strict";t.exports=function(){function t(t,e,l,n,s){return t<e||l<e?t>l?l+1:t+1:n===s?e:e+1}return function(e,l){if(e===l)return 0;if(e.length>l.length){var n=e;e=l,l=n}for(var s=e.length,i=l.length;s>0&&e.charCodeAt(s-1)===l.charCodeAt(i-1);)s--,i--;for(var a=0;a<s&&e.charCodeAt(a)===l.charCodeAt(a);)a++;if(s-=a,i-=a,0===s||i<3)return i;var o,r,u,c,d,h,_,k,p,f,g,v,m=0,b=[];for(o=0;o<s;o++)b.push(o+1),b.push(e.charCodeAt(a+o));for(var D=b.length-1;m<i-3;)for(p=l.charCodeAt(a+(r=m)),f=l.charCodeAt(a+(u=m+1)),g=l.charCodeAt(a+(c=m+2)),v=l.charCodeAt(a+(d=m+3)),h=m+=4,o=0;o<D;o+=2)h=t(c=t(u=t(r=t(_=b[o],r,u,p,k=b[o+1]),u,c,f,k),c,d,g,k),d,h,v,k),b[o]=h,d=c,c=u,u=r,r=_;for(;m<i;)for(p=l.charCodeAt(a+(r=m)),h=++m,o=0;o<D;o+=2)b[o]=h=t(_=b[o],r,h,p,b[o+1]),r=_;return h}}()}});